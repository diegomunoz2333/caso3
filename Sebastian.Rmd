---
title: "Pruebas de texto"
author: "Joan Aguirre"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output: 
  html_document:
    theme: flatly
    highlight: textmate
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: true
    fig_width: 10
    fig_height: 6    
    css: styles.css
    code_folding: hide
---

```{=html}
<style type="text/css">
/* Estilos personalizados con texto justificado como Word */
body {
    font-family: 'Times New Roman', Times, serif;
    font-size: 16px;
    line-height: 1.6;
    color: #2c3e50;
    background-color: #fafafa;
    text-align: justify;
    hyphens: auto;
}

.main-container {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    box-shadow: 0 0 25px rgba(0,0,0,0.08);
    border-radius: 5px;
    overflow: hidden;
    padding: 20px;
}

.header-section {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 50px 0;
    margin: -20px -20px 30px -20px;
    text-align: center;
    border-bottom: 5px solid #bdc3c7;
}

.title {
    font-size: 2.8em;
    font-weight: 400;
    margin-bottom: 15px;
    color: white;
    font-family: 'Times New Roman', Times, serif;
    letter-spacing: 1px;
    text-align: center;
}

.subtitle {
    font-size: 1.3em;
    font-weight: 300;
    opacity: 0.95;
    font-style: italic;
    text-align: center;
}

.section {
    padding: 30px 40px;
    border-bottom: 1px solid #ecf0f1;
    text-align: justify;
}

.section:last-child {
    border-bottom: none;
}

h1, h2, h3, h4 {
    color: #2c3e50;
    font-weight: 400;
    text-align: center;
    font-family: 'Times New Roman', Times, serif;
    margin-bottom: 25px;
}

h1 {
    font-size: 2.2em;
    border-bottom: 2px solid #bdc3c7;
    padding-bottom: 15px;
    margin-top: 40px;
    margin-bottom: 30px;
    text-align: center;
}

h2 {
    font-size: 1.8em;
    color: #34495e;
    margin-top: 35px;
    text-align: center;
}

h3 {
    font-size: 1.4em;
    color: #7f8c8d;
    margin-top: 30px;
    text-align: center;
}

p {
    text-align: justify;
    margin: 15px 0;
    line-height: 1.7;
    text-justify: inter-word;
}

.content-block {
    text-align: justify;
    margin: 20px 0;
    line-height: 1.7;
}

.table-container {
    margin: 20px auto;
    text-align: center;
}

.table {
    border-collapse: collapse;
    margin: 25px auto;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
    font-size: 0.95em;
}

.table th {
    background-color: #34495e;
    color: white;
    padding: 14px 18px;
    text-align: center;
    font-weight: 500;
    border: 1px solid #2c3e50;
}

.table td {
    padding: 12px 16px;
    border: 1px solid #ecf0f1;
    text-align: center;
}

.table tr:nth-child(even) {
    background-color: #f8f9fa;
}

.table tr:hover {
    background-color: #e8f4f8;
}

pre {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    padding: 20px;
    font-size: 0.9em;
    text-align: left;
    margin: 25px auto;
    max-width: 90%;
}

.code {
    background-color: #f8f9fa;
    padding: 3px 8px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    border: 1px solid #e9ecef;
}

.blockquote {
    border-left: 4px solid #bdc3c7;
    padding: 20px 30px;
    margin: 30px 0;
    font-style: italic;
    color: #7f8c8d;
    background-color: #f8f9fa;
    text-align: justify;
    border-radius: 0 5px 5px 0;
    border-left: 5px solid #3498db;
}

.footer {
    text-align: center;
    padding: 40px;
    background-color: #2c3e50;
    color: white;
    margin-top: 40px;
    margin: 30px -20px -20px -20px;
    font-size: 0.95em;
}

.footer p {
    text-align: center;
    margin: 8px 0;
}

/* Estilos para gráficos y figuras */
.figure {
    text-align: center;
    margin: 35px auto;
    display: block;
}

.caption {
    font-style: italic;
    color: #7f8c8d;
    margin-top: 12px;
    text-align: center;
    font-size: 0.95em;
}

/* Listas justificadas */
ul, ol {
    text-align: justify;
    margin: 20px 0;
    padding-left: 40px;
}

li {
    margin: 12px 0;
    line-height: 1.7;
    text-align: justify;
}

li p {
    text-align: justify;
}

/* Mejoras para la tabla de contenidos */
#TOC {
    text-align: left;
    margin: 20px auto;
    display: inline-block;
}

.toc-content {
    text-align: justify;
}

.highlight-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-left: 5px solid #3498db;
    padding: 25px;
    margin: 25px 0;
    text-align: justify;
    border-radius: 5px;
}

/* Estilo para párrafos con sangría como en Word */
.indented {
    text-indent: 2em;
    text-align: justify;
}

/* Justificación mejorada */
.justified-text {
    text-align: justify;
    text-justify: inter-word;
    line-height: 1.7;
}
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.width = 10,
  fig.height = 6,
  out.width = "90%"
)
library(gt)
library(ggplot2)
library(dplyr)
library(knitr)
library(DT)
library(tidyverse)
```

# Introducción

En el corazón de la economía global existe una paradoja fundamental: mientras que algunos indicadores sugieren una relación lineal y predecible entre el desarrollo económico y el bienestar social, la realidad es mucho más compleja y matizada. Tomemos un ejemplo: Costa Rica tiene una esperanza de vida comparable a la de países europeos desarrollados, pero con un PIB per cápita significativamente menor; Qatar, por su parte, lidera en PIB per cápita pero no encabeza necesariamente en todos los indicadores de bienestar social (Shkolnikov et al., 2019). Estas "anomalías" no son excepciones sino revelaciones de una verdad fundamental: el desarrollo no es unidimensional.

El problema central que motiva este trabajo es fundamental: ¿Cuáles son realmente los "tipos" de desarrollo que caracterizan la economía mundial cuando se analiza simultáneamente un conjunto amplio de 17 indicadores económicos, sociales, tecnológicos y ambientales? No se trata de responder cuál país es más "rico", sino algo más profundo: descubrir si existen estructuras ocultas en los datos que agrupen países con perfiles similares más allá de la geografía o las clasificaciones convencionales. Específicamente, la pregunta es: ¿Colombia y Uruguay podrían compartir más similitudes con algunos países asiáticos que con sus propios vecinos latinoamericanos? ¿Existe realmente un "grupo de países con baja renta pero alto acceso tecnológico"? ¿Las características ambientales y demográficas se alinean con la riqueza económica o presentan patrones independientes?

Históricamente, el desarrollo internacional se ha medido mediante indicadores aislados. El PIB per cápita domina los rankings; la esperanza de vida se analiza independientemente; la conectividad digital se observa separadamente. Este enfoque fragmentado es problemático porque el desarrollo no es unidimensional: un país puede ser económicamente exitoso pero frágil en salud pública, o tener excelente conectividad digital pero vulnerabilidad ambiental crítica (Jolliffe, 2002; World Bank, 2023). Los datos del año 2022 capturan un momento único en la historia económica global: post-pandemia de COVID-19, con efectos heterogéneos según país. Algunos recuperaron rápidamente su dinamismo; otros enfrentaron cicatrices estructurales persistentes en empleo, salud y finanzas públicas (World Bank, 2023).

El Banco Mundial proporciona 17 indicadores reconocidos internacionalmente que miden dimensiones distintas: factores económicos (PIB per cápita, crecimiento del PIB, inversión extranjera, remesas, industria, comercio), indicadores de salud y bienestar (esperanza de vida, mortalidad infantil, gasto en salud), variables de conectividad tecnológica (acceso a electricidad, uso de internet, suscripciones móviles) y aspectos ambientales y demográficos (área boscosa, tierra cultivable, crecimiento poblacional) (World Bank, 2023). Analizar estas 17 variables de forma independiente genera ruido; analizarlas de manera integrada puede revelar patrones coherentes que informan políticas públicas, estrategias de cooperación internacional y decisiones de inversión.

El desafío es modelar una pregunta sin respuesta predefinida: ¿Qué agrupamientos naturales de países emergen cuando se analiza simultáneamente esta multiplicidad de indicadores? Este es precisamente el rol del aprendizaje no supervisado—un conjunto de técnicas que descubren patrones en datos sin etiquetas previas, sin clasificaciones arbitrarias impuestas externamente (Charrad et al., 2014; Jolliffe, 2002).

Lo que sigue es una cartografía multidimensional de la economía global en el contexto post-pandemia: no solo se responde "¿en qué grupos se dividen los países?", sino, más profundamente, "¿qué revelan estos grupos sobre mecanismos reales del desarrollo, oportunidades compartidas, restricciones comunes y trayectorias viables para diferentes sociedades?" Los resultados no serán una clasificación administrativa sino un descubrimiento empírico basado en lo que los datos de 180 países en 2022 efectivamente revelan.

# Metodologia

## Base de datos

La base de datos utilizada en este análisis proviene de la compilación World Development Indicators (WDI) del Banco Mundial, considerada la principal fuente internacional de estadísticas comparables sobre desarrollo económico y social (World Bank, 2023). Los WDI representan el esfuerzo más comprehensivo del Banco Mundial para consolidar indicadores de desarrollo de fuentes oficialmente reconocidas, incluyendo oficinas nacionales de estadística, bancos centrales, agencias de las Naciones Unidas, instituciones de investigación y contribuyentes del sector privado (World Bank, 2023; Jeanty, 2010).

La base WDI contiene aproximadamente 1,600 indicadores de series temporales para 217 economías y más de 40 grupos de países, con datos para muchos indicadores que se remontan más de 50 años (World Bank, 2023). Los datos son compilados mediante metodologías estandarizadas que garantizan comparabilidad internacional, transparencia metodológica y robustez estadística (World Bank, 2019). El proceso de selección de indicadores del WDI sigue cuatro criterios fundamentales: facilidad de uso (accesibilidad y claridad para usuarios diversos), confiabilidad (reputación y credibilidad de la fuente), cobertura (amplitud geográfica y temporal), y calidad (rigor metodológico y precisión) (Behar & Mok, 2024).

Para este análisis, se filtro información exclusivamente para países individuales (eliminando bloques regionales o agrupaciones económicas) del año 2022. El dataset resultante contiene aproximadamente 180-200 países, según la disponibilidad de datos completos, donde cada observación representa una unidad soberana comparable en un único punto temporal.

El año 2022 marca un punto de inflexión crítico en la economía global, representa el momento post-pandemia en que las trayectorias de recuperación de cada país se hacen visibles y diferenciadas. Mientras algunos países desarrollados con capacidad fiscal recuperaron o superaron niveles pre-COVID-19, economías emergentes enfrentaban cicatrices estructurales persistentes en empleo, inflación descontrolada, y aumento de deuda pública (Banco Mundial, 2022; FMI, 2023; CEPAL, 2023). La desigualdad global se amplió drásticamente: el crecimiento proyectado para América Latina en 2022 era apenas 2.6%, mientras la desigualdad de ingresos aumentó significativamente después de dos décadas de mejoras (BID, 2022).

En este contexto, 2022 funciona como un "revelador" excepcional de vulnerabilidades y fortalezas estructurales subyacentes de los países: aquellos con sistemas de salud robustos, infraestructura tecnológica consolidada y economías diversificadas mostraron resiliencia; los que enfrentaban fragilidades estructurales experimentaron impactos persistentes (Banco Mundial, 2022; CIDOB, 2022). Por tanto, 2022 es un año extraordinariamente informativo para identificar perfiles reales de desarrollo, ya que las diferencias entre países se magnificaron visiblemente, permitiendo observar no clasificaciones arbitrarias sino estructuras auténticas de capacidad nacional.

## Descripción de las variables

El dataset construido para este análisis integra 17 variables cuantitativas que capturan las múltiples dimensiones del desarrollo contemporáneo. Estas variables se organizan en cinco áreas temáticas que, en conjunto, ofrecen una perspectiva comprehensiva del desempeño socioeconómico, tecnológico y ambiental de cada país. A continuación, se presenta una descripción detallada de cada variable según su área temática.

### Dimensión economica

La inclusión de variables económicas es fundamental porque el desarrollo ha sido históricamente conceptualizado como un proceso de transformación estructural impulsado por el crecimiento económico (World Bank, 2023; Piketty, 2022). Sin embargo, el crecimiento económico no es unidimensional: requiere tanto un nivel absoluto de riqueza (PIB per cápita) como dinamismo y expansión (crecimiento del PIB), diversificación productiva (industria), y capacidad de atracción de inversión internacional (IED) que transfiera conocimiento y capital (ECB, 2018). Además, las economías contemporáneas están integradas globalmente, por lo que exportaciones, importaciones y remesas son transmisores clave de oportunidades y vulnerabilidades económicas (World Bank, 2023)., en la tabla 1 las observamos.

```{r Variables economicas}
variables_economicas <- data.frame(
  Variable = c(
    "PIB per cápita (US$)",
    "Crecimiento del PIB (% anual)",
    "Inversión extranjera directa (% PIB)",
    "Remesas recibidas (% PIB)",
    "Industria (% PIB)",
    "Exportaciones (% PIB)",
    "Importaciones (% PIB)"
  ),
  
  Descripción = c(
    "PIB dividido por población, en dólares corrientes. Indicador principal del nivel de ingreso y producción económica por persona.",
    "Tasa de variación anual del PIB en precios constantes. Refleja la expansión o contracción económica de un país.",
    "Flujos netos de inversión con interés gerencial duradero. Fuente crucial de financiamiento externo y transferencia tecnológica.",
    "Transferencias personales de migrantes que trabajan en el extranjero. Flujo financiero clave para muchas economías en desarrollo.",
    "Valor agregado del sector industrial. Refleja el grado de industrialización y la estructura productiva de una economía.",
    "Valor de bienes y servicios vendidos al exterior. Mide el grado de apertura comercial y oportunidades de crecimiento.",
    "Valor de bienes y servicios comprados al exterior. Indica la dependencia de la economía respecto al comercio internacional."
  ),
  
  Interpretación = c(
    ">20,000 USD: economía desarrollada\n5,000-20,000 USD: economía emergente\n<5,000 USD: economía en desarrollo",
    ">3%: crecimiento robusto\n0-3%: crecimiento moderado\n<0%: recesión económica",
    ">5%: alta atracción de IED\n2-5%: nivel moderado\n<2%: baja atracción de inversión",
    ">10%: alta dependencia\n2-10%: contribución significativa\n<2%: impacto limitado",
    ">30%: economía industrializada\n20-30%: sector industrial sólido\n<20%: base industrial reducida", 
    ">50%: economía muy abierta\n30-50%: apertura moderada\n<30%: economía relativamente cerrada",
    ">40%: alta dependencia importaciones\n25-40%: nivel moderado\n<25%: autosuficiencia relativa"
  )
)

tabla_1 <- variables_economicas %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 1**"),
    subtitle = "Variables Macroeconómicas y su Interpretación"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripción = md("**Descripción**"),
    Interpretación = md("**Interpretación**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripción))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Descripción, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en World Bank (2023), UN (2015), ECB (2018)")
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretación son referenciales y pueden variar según el contexto regional y temporal",
    locations = cells_title(groups = "subtitle")
  )

tabla_1
```

### Dimension de salud y bienestar

La inclusión de variables sanitarias responde a que el desarrollo no es puramente económico sino que debe reflejarse en mejoras sustantivas en la calidad de vida, particularmente en indicadores de salud poblacional (Sachs et al., 2022; World Bank, 2023). La esperanza de vida es considerada por organismos internacionales como el indicador sintético más robusto de desarrollo humano, capturando tanto el acceso a servicios de salud como condiciones generales de vida (OECD, 2024). La mortalidad infantil es particularmente sensible a la calidad del sistema sanitario, y el gasto en salud refleja el esfuerzo institucional de un país por asegurar bienestar poblacional (World Bank, 2023)., en la tabla 2 las observamos.

```{r Variables bienestar}

variables_salud <- data.frame(
  Variable = c(
    "Esperanza de vida al nacer (años)",
    "Mortalidad infantil (por cada 1,000 nacidos vivos)",
    "Gasto en salud (% del PIB)"
  ),
  
  Descripción = c(
    "Número promedio de años que se espera que viva un recién nacido si los patrones de mortalidad prevalecientes al momento de su nacimiento permanecen constantes a lo largo de su vida. Es uno de los indicadores más robustos para medir el estado de salud poblacional, reflejando la calidad del sistema sanitario, acceso a servicios médicos, condiciones de vida, nutrición y factores ambientales.",
    "Número de muertes de niños menores de un año por cada 1,000 nacimientos vivos. Es un indicador sensible de la calidad de atención sanitaria materno-infantil, condiciones sanitarias, acceso a agua potable y nutrición adecuada, funcionando como proxy de desarrollo social y capacidad institucional del sistema de salud.",
    "Gasto corriente en salud expresado como porcentaje del PIB, incluyendo tanto gasto público como privado. Refleja la prioridad presupuestaria que un país asigna al sector salud y su capacidad de financiar infraestructura sanitaria, siendo un determinante clave de resultados de salud poblacional."
  ),
  
  Interpretación = c(
    ">75 años: salud poblacional avanzada\n70-75 años: nivel medio de desarrollo sanitario\n<70 años: desafíos significativos en salud pública",
    "<10: excelentes condiciones sanitarias\n10-25: condiciones moderadas\n>25: necesidades críticas en salud infantil",
    ">8%: alta prioridad en salud\n5-8%: compromiso moderado\n<5%: recursos sanitarios limitados"
  )
)

tabla_2 <- variables_salud %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 2**"),
    subtitle = "Indicadores de Salud Pública y su Interpretación"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripción = md("**Descripción**"),
    Interpretación = md("**Interpretación**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripción))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Descripción, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en WHO (2020), OECD (2024), World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretación son referenciales y pueden variar según el contexto regional y nivel de desarrollo",
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_style(
    style = cell_text(whitespace = "normal"),
    locations = cells_body()
  )

tabla_2

```

### Dimension tecnologica y de conectividad

La inclusión de variables tecnológicas es justificada por la importancia creciente de la transformación digital en el desarrollo contemporáneo (UNCTAD, 2021; World Bank, 2023). La acceso a electricidad, internet y telefonía móvil no son lujos sino infraestructuras esenciales que habilitan participación en la economía del conocimiento, acceso a información, servicios financieros y oportunidades económicas (UNCTAD, 2021). La brecha digital ha emergido como una nueva dimensión de desigualdad internacional, donde países con penetración digital menor enfrentan desventajas competitivas significativas (World Bank, 2023)., en la tabla 3 las observamos.

```{r Variables tecnologicas}
variables_tecnologia <- data.frame(
  Variable = c(
    "Acceso a electricidad (% de la población)",
    "Uso de internet (% de la población)",
    "Suscripciones móviles (por cada 100 personas)"
  ),
  
  Descripción = c(
    "Porcentaje de la población con acceso a electricidad. Indicador fundamental de infraestructura energética básica, condición necesaria para actividad económica moderna, educación, salud y conectividad digital.",
    "Porcentaje de individuos que han utilizado internet en los últimos 3 meses. Proxy de conectividad digital, acceso a información, y participación en la economía del conocimiento, siendo cada vez más relevante para productividad económica y reducción de brechas informativas.",
    "Número de suscripciones a servicios de telefonía celular móvil por cada 100 habitantes. Refleja la penetración de tecnología móvil, que ha sido un vector fundamental de inclusión digital y acceso a servicios financieros en economías en desarrollo."
  ),
  
  Interpretación = c(
    ">95%: cobertura eléctrica universal\n80-95%: acceso extendido\n<80%: déficit significativo de infraestructura",
    ">70%: sociedad digitalmente integrada\n30-70%: adopción media de internet\n<30%: brecha digital significativa",
    ">100: alta penetración móvil\n80-100: cobertura adecuada\n<80: oportunidades de expansión del mercado"
  )
)

tabla_3 <- variables_tecnologia %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 3**"),
    subtitle = "Indicadores de Infraestructura y Tecnología"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripción = md("**Descripción**"),
    Interpretación = md("**Interpretación**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripción))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Descripción, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los valores superiores a 100 en suscripciones móviles indican múltiples suscripciones por persona",
    locations = cells_body(
      rows = 3,
      columns = Interpretación
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretación son referenciales y pueden variar según el nivel de desarrollo regional",
    locations = cells_title(groups = "subtitle")
  )

tabla_3

```

### Dimension ambiental y de recursos

La inclusión de variables ambientales responde al creciente reconocimiento de que el desarrollo sostenible debe integrar consideraciones ecológicas (PNUD, 2023; World Bank, 2023). Aunque el crecimiento económico tradicional ha sido alcanzado frecuentemente mediante degradación ambiental, la sostenibilidad del desarrollo requiere preservación de capital natural, particularmente bosques (para captura de carbono y biodiversidad) y tierra cultivable (para seguridad alimentaria) (PNUD, 2023; World Bank, 2023), en la tabla 4 las vemos.

```{r Variables ambiental}
variables_ambientales <- data.frame(
  Variable = c(
    "Área boscosa (% del área terrestre)",
    "Tierra cultivable (% del área terrestre)"
  ),
  
  Descripción = c(
    "Porcentaje del territorio nacional cubierto por bosques. Es un indicador de conservación ambiental, biodiversidad y sostenibilidad, siendo relevante tanto para mitigación del cambio climático como para servicios ecosistémicos.",
    "Porcentaje de tierra apta para cultivos agrícolas. Refleja el potencial agrícola y la base de recursos naturales para producción de alimentos, siendo particularmente relevante para economías con sectores agrícolas significativos."
  ),
  
  Interpretación = c(
    ">30%: alta cobertura forestal\n15-30%: cobertura media\n<15%: deforestación significativa",
    ">20%: alta disponibilidad agrícola\n10-20%: capacidad moderada\n<10%: limitaciones para agricultura"
  )
)

tabla_4 <- variables_ambientales %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 4**"),
    subtitle = "Indicadores Ambientales y de Uso de la Tierra"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripción = md("**Descripción**"),
    Interpretación = md("**Interpretación**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripción))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Descripción, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los servicios ecosistémicos incluyen regulación hídrica, conservación de biodiversidad y secuestro de carbono",
    locations = cells_body(
      rows = 1,
      columns = Descripción
    )
  ) %>%
  tab_footnote(
    footnote = "La tierra cultivable incluye tierras arables, cultivos permanentes y pastos permanentes",
    locations = cells_body(
      rows = 2,
      columns = Descripción
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretación pueden variar según las características geográficas y ecológicas de cada región",
    locations = cells_title(groups = "subtitle")
  )

tabla_4


```

### Dimension demografica

La inclusión de variables demográficas es justificada porque la dinámica poblacional condiciona fundamentalmente los desafíos y oportunidades de desarrollo: presión sobre recursos, mercado laboral, demanda por servicios públicos, y sostenibilidad fiscal (CEPAL, 2023; World Bank, 2023). Países con crecimiento poblacional acelerado enfrentan distintos desafíos que aquellos con envejecimiento poblacional, impactando tasas de ahorro, inversión, y provisión de servicios (CEPAL, 2023), vemos las variables en la tabla 5.

```{r Variables demograficas}
variables_demograficas <- data.frame(
  Variable = c(
    "Población total",
    "Crecimiento poblacional (% anual)"
  ),
  
  Descripción = c(
    "Número total de habitantes de un país a mitad de año. El tamaño poblacional determina tanto el mercado interno como la escala de demanda por servicios públicos y recursos naturales.",
    "Tasa de variación porcentual anual de la población. Refleja la presión demográfica y sus implicaciones para sostenibilidad, mercados laborales, y provisión de servicios públicos."
  ),
  
  Interpretación = c(
    ">100M: país muy poblado\n10-100M: población media\n<10M: país poco poblado",
    ">2%: crecimiento rápido\n0.5-2%: crecimiento moderado\n<0.5%: crecimiento lento"
  )
)

tabla_5 <- variables_demograficas %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 5**"),
    subtitle = "Indicadores Demográficos Básicos"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripción = md("**Descripción**"),
    Interpretación = md("**Interpretación**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripción))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Descripción, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "La población se refiere a residentes totales independientemente de su estatus legal o ciudadanía",
    locations = cells_body(
      rows = 1,
      columns = Descripción
    )
  ) %>%
  tab_footnote(
    footnote = "El crecimiento poblacional incluye nacimientos, muertes y migración neta",
    locations = cells_body(
      rows = 2,
      columns = Descripción
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretación son referenciales y pueden variar según el contexto regional y nivel de desarrollo",
    locations = cells_title(groups = "subtitle")
  )

tabla_5
```

## Base de datos del modelo

A continuacion, se muestra la base de datos que se usara para el modelo de aprendizaje no supervisado.

```{r Base de datos, warning=FALSE,message=FALSE}
Base_2022 <- read_csv("f36a5086-3311-4b1a-9f0c-bda5cd4718df_Series - Metadata.csv",
                 show_col_types = FALSE) %>%
  select(
    Pais = `Country Name`,
    Codigo = `Country Code`,
    PIB_per = `GDP per capita (current US$) [NY.GDP.PCAP.CD]`,
    Poblacion = `Population, total [SP.POP.TOTL]`,
    `Esperanza vida` = `Life expectancy at birth, total (years) [SP.DYN.LE00.IN]`,
    `Acceso electricidad` = `Access to electricity (% of population) [EG.ELC.ACCS.ZS]`,
    `Area boscosa` = `Forest area (% of land area) [AG.LND.FRST.ZS]`,
    `Suscripciones movil` = `Mobile cellular subscriptions (per 100 people) [IT.CEL.SETS.P2]`,
    `Crecimiento PIB` = `GDP growth (annual %) [NY.GDP.MKTP.KD.ZG]`,
    `Mortalidad infantil` = `Mortality rate, infant (per 1,000 live births) [SP.DYN.IMRT.IN]`,
    `Inversion extranjera` = `Foreign direct investment, net inflows (% of GDP) [BX.KLT.DINV.WD.GD.ZS]`,
    `Gasto salud` = `Current health expenditure (% of GDP) [SH.XPD.CHEX.GD.ZS]`,
    `Uso internet` = `Individuals using the Internet (% of population) [IT.NET.USER.ZS]`,
    Importaciones = `Imports of goods and services (% of GDP) [NE.IMP.GNFS.ZS]`,
    Exportaciones = `Exports of goods and services (% of GDP) [NE.EXP.GNFS.ZS]`,
    `Tierra cultivable` = `Arable land (% of land area) [AG.LND.ARBL.ZS]`,
    `Crecimiento poblacion` = `Population growth (annual %) [SP.POP.GROW]`,
    Industria = `Industry (including construction), value added (% of GDP) [NV.IND.TOTL.ZS]`,
    Remesas = `Personal remittances, received (% of GDP) [BX.TRF.PWKR.DT.GD.ZS]`
  )%>%
  filter(!Pais %in% c("World", "High income", "Low income", "European Union",
                      "Latin America & Caribbean", "Middle income", "OECD members",
                      "East Asia & Pacific", "Sub-Saharan Africa", "South Asia",
                      "North America", "Euro area", "Arab World", "West Bank and Gaza",
                      "Lower middle income", "Upper middle income", 
                      "Least developed countries: UN classification",
                      "Fragile and conflict affected situations", 
                      "Heavily indebted poor countries (HIPC)",
                      "IDA total", "Low & middle income", "Middle East & North Africa",
                      "Pacific island small states", "Small states", 
                      "Caribbean small states", "Other small states", 
                      "IDA & IBRD total", "IDA only", "IBRD only",
                      "Pre-demographic dividend", "Post-demographic dividend", 
                      "Early-demographic dividend", "Late-demographic dividend")) %>% 
  mutate(across(3:19, as.numeric)) %>% drop_na()%>% 
  filter(Pais != c( "Luxembourg","	Uruguay", "Angola","Jordan","Belize")) %>% 
  filter(Codigo != "BLZ",Codigo!="JOR",Codigo!="URY")


tabla_inicial <- datatable(
  Base_2022,
  extensions = c('Buttons', 'Scroller', 'Responsive', 'FixedHeader'),
  options = list(
    dom = '<"top"lBf>rt<"bottom"ip><"clear">',
    buttons = list(
      list(extend = 'copy', text = 'Copiar', className = 'btn-outline-primary'),
      list(extend = 'csv', text = 'CSV', className = 'btn-outline-secondary'),
      list(extend = 'excel', text = 'Excel', className = 'btn-outline-success'),
      list(extend = 'pdf', text = 'PDF', className = 'btn-outline-danger'),
      list(extend = 'print', text = 'Imprimir', className = 'btn-outline-warning')
    ),
    pageLength = 12,
    lengthMenu = list(c(8, 12, 20, 50, -1), 
                     c('8', '12', '20', '50', 'Todos')),
    scrollX = TRUE,
    scrollY = "550px",
    scroller = TRUE,
    deferRender = TRUE,
    language = list(
      url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json',
      search = "Buscar:",
      lengthMenu = "Mostrar _MENU_ registros",
      info = "_START_ - _END_ de _TOTAL_",
      paginate = list(
        first = "Primero",
        last = "Último",
        `next` = "Siguiente",
        previous = "Anterior"
      )
    ),
    autoWidth = TRUE,
    fixedHeader = TRUE,
    searchHighlight = TRUE
  ),
  rownames = FALSE,
  filter = 'top',
  class = c('display', 'compact', 'hover'),
  caption = 'Indicadores Económicos y Sociales Globales 2022'
) %>%
  formatCurrency(
    columns = 'PIB_per', 
    currency = "$", 
    digits = 0,
    before = TRUE
  ) %>%
  formatRound(
    columns = 'Poblacion', 
    digits = 0,
    mark = ","
  ) %>%
  formatRound(
    columns = c('Esperanza vida', 'Acceso electricidad', 'Area boscosa',
               'Suscripciones movil', 'Crecimiento PIB', 'Inversion extranjera', 
               'Gasto salud', 'Uso internet', 'Importaciones', 'Exportaciones', 
               'Tierra cultivable', 'Crecimiento poblacion', 'Industria', 'Remesas'), 
    digits = 2
  ) %>%
  formatRound(
    columns = 'Mortalidad infantil',
    digits = 1
  ) %>%
  formatStyle(
    columns = names(Base_2022),
    fontSize = '12px',
    fontFamily = 'Arial, sans-serif'
  ) %>%
  formatStyle(
    columns = names(Base_2022),
    target = 'cell',
    fontWeight = 'bold'
  )  


tabla_inicial

```

## Descripción del modelo

La implementación del análisis se estructura en cuatro etapas secuenciales, cada una construida sobre los resultados de la anterior, garantizando que la información y patrones descubiertos se preserven y amplifiquen a través del pipeline de análisis.

### Preparación y Estandarización de Datos

Previo a cualquier análisis multivariado, es fundamental estandarizar las variables originales para garantizar que todas contribuyan en igualdad de condiciones al cálculo de componentes principales (KeepCoding, 2025). La estandarización se realizó mediante la transformación z-score: $Z_i = \frac{X_i - \mu_i}{\sigma_i}$ donde $Z_i$ es la variable estandarizada, $X_i$ la variable original, $\mu_i$ la media y $\sigma_i$ la desviación estándar.

Esta estandarización es crítica porque el análisis de componentes principales se fundamenta en la varianza de los datos: sin estandarizar, variables con escalas numéricas mayores (como población total en millones) dominarían el cálculo de componentes, distorsionando la interpretación y otorgando influencia desproporcionada a magnitudes en lugar de patrones (LinkedIn, 2023; Ciencia de Datos, 2016). Adicionalmente, la estandarización garantiza que el análisis capture relaciones entre variables y no simplemente diferencias en escala.

### Análisis de Componentes Principales (ACP)

Con las 17 variables estandarizadas, se aplica el Análisis de Componentes Principales para transformar el conjunto de variables originales, potencialmente correlacionadas, en un conjunto menor de componentes principales ortogonales (Jolliffe, 2002; OpenWebinars, 2025). El ACP identifica las direcciones en el espacio de datos donde la varianza es máxima, creando nuevas dimensiones (componentes) que son combinaciones lineales ponderadas de las variables originales (Jolliffe, 2002; KeepCoding, 2025).

Matemáticamente, el ACP comienza construyendo la matriz de covarianza $C$ de las variables estandarizadas, cuyas entradas representan cómo varían conjuntamente pares de variables (KeepCoding, 2025). Los vectores propios de esta matriz de covarianza definen las direcciones principales (componentes), ordenados según sus correspondientes valores propios, que representan la cantidad de varianza explicada en cada dirección (Jolliffe, 2002). El primer componente principal captura la máxima varianza; el segundo, la máxima varianza restante sujeto a ortogonalidad respecto al primero; y así sucesivamente (Jolliffe, 2002).

El criterio para determinar el número óptimo de componentes se basó en el principio de parsimonia, buscando maximizar la reducción dimensional manteniendo una representación significativa de la estructura original de los datos.

### Cálculo de Distancias Euclidianas

Una vez obtenidos los componentes principales, se utiliza la distancia euclidiana como métrica de disimilaridad entre países. Para cada par de países, la distancia euclidiana se calcula como:

$$ d_{ij} = \sqrt{\sum_{k=1}^{p} (PC_{ik} - PC_{jk})^2} $$ Donde:

-   $d_{ij}$ = Distancia euclidiana entre los países $i$ y $j$
-   $p$ = Número de componentes principales utilizados
-   $PC_{ik}$ = Valor del $k$-ésimo componente principal para el país $i$
-   $PC_{jk}$ = Valor del $k$-ésimo componente principal para el país $j$

Esta distancia mide la proximidad multidimensional entre países: distancias pequeñas indican perfiles similares, distancias grandes indican disimilaridad (Universidad de Granada, 2016; ArcGIS, 2024).

La distancia euclidiana es particularmente apropiada para el método de Ward porque, en su implementación aglomerativa, se utiliza el cuadrado de la distancia euclidiana—formalmente conocida como "distancia euclidiana semicuadrada"—como medida de disimilaridad (Ward, 1963; Wikipedia, 2013; TIBCO, 2024).

### Clusterización Jerárquica Aglomerativa con Método de Ward

Tras la reducción dimensional mediante Análisis de Componentes Principales, se aplicó una clusterización jerárquica aglomerativa mediante el método de Ward sobre las coordenadas de los países en el espacio reducido de k componentes principales. Esta estrategia metodológica aplicar clustering sobre componentes principales en lugar de variables originales estándar en análisis multivariado porque ofrece ventajas técnicas significativas: elimina multicolinealidad entre variables, asegurando que cada componente captura variabilidad independiente; reduce ruido estadístico al descartar componentes posteriores que explican varianza residual mínima; mejora la estabilidad numérica del algoritmo de clustering al trabajar con matrices de dimensionalidad reducida.

El método de Ward es un algoritmo jerárquico aglomerativo que opera iterativamente sobre el conjunto de observaciones para formar una jerarquía de clusters. El procedimiento inicia considerando cada país como un cluster individual independiente, creando aproximadamente 180 grupos iniciales. En cada iteración subsecuente, el algoritmo identifica el par de clusters más próximos y los fusiona en un único cluster más grande.

El método de Ward minimiza específicamente la suma total de cuadrados dentro de los clusters (WCSS). Formalmente, en cada paso Ward selecciona el par de clusters cuya fusión produce el incremento mínimo en la varianza total intra-cluster. El algoritmo se ejecuta recursivamente hasta que todos los países quedan englobados en un único cluster jerárquico global.

El resultado del método de Ward es un dendrograma—diagrama en forma de árbol invertido—que visualiza el proceso completo de fusión jerárquica. En el dendrograma, el eje horizontal representa la serie de países como hojas basales del árbol, el eje vertical representa la altura de fusión medida en unidades de distancia de Ward, las ramas internas conectan países o sub-clusters que se fusionan, y la altura de cada nodo indica el nivel de disimilaridad en el cual ocurrió esa fusión específica.

### Prediccion

Con el objetivo de validar la robustez del modelo de clusterización y demostrar su capacidad predictiva, se procedió a proyectar cinco países adicionales no incluidos en el conjunto de entrenamiento original sobre el espacio factorial de componentes principales. Estos países fueron: Luxemburgo, Uruguay, Belice, Jordania y Angola. La proyección de nuevas observaciones sobre el espacio factorial permite evaluar cómo cada país se posiciona relativamente respecto a los clusters identificados, prediciendo su asignación más probable basada en similitud multidimensional (Hastie et al., 2009; Jolliffe, 2002).

# Analisis descriptivo de los indicadores

# Resultados del modelo

## Analisis de componentes principales (ACP)

### Matriz de correlaciones

Antes de aplicar el Análisis de Componentes Principales, es fundamental examinar la estructura de correlaciones entre las 17 variables para identificar redundancias potenciales y validar la pertinencia de la reducción de dimensionalidad. La matriz de correlación de Pearson revela las asociaciones lineales entre pares de variables, proporcionando una visión exploratoria de cómo las dimensiones del desarrollo se interrelacionan. (Jolliffe, 2002).

```{r Matriz de correlaciones}
library(tidyverse)     
library(FactoClass)    
library(ade4)          
library(factoextra)    
library(cluster)       
library(dendextend)    
library(ggrepel)      
library(kableExtra)    
library(ggforce)    
library(dendextend)
library(plotly)        
library(sf)            
library(leaflet)       
library(rnaturalearth)
library(RColorBrewer)  
library(ellipse)

datos_analisis <- Base_2022 %>%
  select(-Codigo) %>%
  column_to_rownames("Pais")

library(ggcorrplot)

matriz_cor <- cor(datos_analisis, use = "complete.obs")

# Nombres completos para mejor legibilidad
nombres_completos <- c(
  "PIB_per" = "PIB per cápita",
  "Poblacion" = "Población total",
  "Esperanza vida" = "Esperanza de vida",
  "Acceso electricidad" = "Acceso electricidad",
  "Area boscosa" = "Área boscosa",
  "Suscripciones movil" = "Suscripciones móviles",
  "Crecimiento PIB" = "Crecimiento PIB",
  "Mortalidad infantil" = "Mortalidad infantil",
  "Inversion extranjera" = "Inversión extranjera",
  "Gasto salud" = "Gasto en salud",
  "Uso internet" = "Uso de internet",
  "Importaciones" = "Importaciones",
  "Exportaciones" = "Exportaciones",
  "Tierra cultivable" = "Tierra cultivable",
  "Crecimiento poblacion" = "Crecimiento población",
  "Industria" = "Industria",
  "Remesas" = "Remesas"
)

# Aplicar nombres completos
rownames(matriz_cor) <- nombres_completos[rownames(matriz_cor)]
colnames(matriz_cor) <- nombres_completos[colnames(matriz_cor)]

# Crear heatmap interactivo
heatmap_interactivo <- plot_ly(
  x = colnames(matriz_cor),
  y = rownames(matriz_cor),
  z = matriz_cor,
  type = "heatmap",
  colors = colorRamp(c("#6D9EC1", "white", "#E46726")),
  hoverinfo = "text",
  text = matrix(
    paste(
      "Variable X:", rep(colnames(matriz_cor), each = nrow(matriz_cor)),
      "<br>Variable Y:", rep(rownames(matriz_cor), times = ncol(matriz_cor)),
      "<br>Correlación:", round(c(matriz_cor), 3)
    ),
    nrow = nrow(matriz_cor),
    ncol = ncol(matriz_cor)
  ),
  colorbar = list(
    title = "Correlación",
    titleside = "right"
  )
) %>%
  layout(
    title = list(
      text = "<b>Matriz de Correlaciones Interactiva - 17 Variables de Desarrollo</b>",
      x = 0.05,
      font = list(size = 16)
    ),
    xaxis = list(
      title = "",
      tickangle = -45,
      tickfont = list(size = 10),
      showgrid = FALSE
    ),
    yaxis = list(
      title = "",
      tickfont = list(size = 10),
      showgrid = FALSE
    ),
    margin = list(l = 150, r = 50, b = 150, t = 80),
    annotations = list(
      list(
        x = 0.5,
        y = -0.15,
        text = "Haz clic y arrastra para zoom • Pasa el cursor para ver valores",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        font = list(size = 10, color = "gray")
      )
    )
  )

heatmap_interactivo
matriz_cor <- cor(datos_analisis, use = "complete.obs")

matriz_cor_long <- matriz_cor %>%
  as.data.frame() %>%
  rownames_to_column("Variable1") %>%
  pivot_longer(
    cols = -Variable1,
    names_to = "Variable2",
    values_to = "Correlacion"
  ) %>%
  filter(Variable1 != Variable2) %>%
  mutate(Correlacion = round(Correlacion, 3))

nombres_abreviados <- c(
  "PIB_per" = "PIB pc",
  "Poblacion" = "Población",
  "Esperanza vida" = "Esp. vida",
  "Acceso electricidad" = "Electricidad",
  "Area boscosa" = "Bosques",
  "Suscripciones movil" = "Móvil",
  "Crecimiento PIB" = "Crec. PIB",
  "Mortalidad infantil" = "Mort. inf.",
  "Inversion extranjera" = "IED",
  "Gasto salud" = "Salud",
  "Uso internet" = "Internet",
  "Importaciones" = "Import.",
  "Exportaciones" = "Export.",
  "Tierra cultivable" = "Cultivable",
  "Crecimiento poblacion" = "Crec. pob.",
  "Industria" = "Industria",
  "Remesas" = "Remesas"
)

cor_significativas <- matriz_cor_long %>%
  mutate(
    Variable1_abr = nombres_abreviados[Variable1],
    Variable2_abr = nombres_abreviados[Variable2]
  ) %>%
  filter(abs(Correlacion) > 0.5) %>%
  arrange(desc(abs(Correlacion))) %>%
  select(Variable1_abr, Variable2_abr, Correlacion) %>%
  distinct()

tabla_cor <- cor_significativas %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 12**"),
    subtitle = "Matriz de Correlaciones - Correlaciones Significativas (|r| > 0.5)"
  ) %>%
  cols_label(
    Variable1_abr = md("**Variable 1**"),
    Variable2_abr = md("**Variable 2**"),
    Correlacion = md("**Correlación (r)**")
  ) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  fmt_number(
    columns = Correlacion,
    decimals = 3
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable1_abr, Variable2_abr))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = c(Variable1_abr, Variable2_abr))
  ) %>%
  tab_style(
    style = cell_fill(color = "#E8F5E8"),
    locations = cells_body(
      rows = Correlacion > 0.7
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "#FFE6E6"),
    locations = cells_body(
      rows = Correlacion < -0.7
    )
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(80),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(6),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Correlaciones positivas fuertes (r > 0.7) en verde claro",
    locations = cells_body(
      rows = 1
    )
  ) %>%
  tab_footnote(
    footnote = "Correlaciones negativas fuertes (r < -0.7) en rojo claro",
    locations = cells_body(
      rows = nrow(cor_significativas)
    )
  )

tabla_cor



```

La matriz de correlación entre todas las variables de desarrollo es fundamental porque exhibe patrones predecibles: variables económicas tienden a correlacionarse positivamente entre sí (PIB per cápita, crecimiento del PIB, inversión extranjera), variables de bienestar social correlacionan positivamente (esperanza de vida, acceso a electricidad, uso de internet), y existe una correlación positiva sustancial entre estas dos dimensiones generales (Hastie et al., 2009). Adicionalmente, se observan correlaciones negativas entre indicadores de rezago (mortalidad infantil, tierra cultivable) y variables de desarrollo avanzado, reflejando que países con mayor riqueza y bienestar exhiben menores tasas de mortalidad y menor dependencia agrícola. La presencia de correlaciones altas (superiores a 0.7) entre múltiples pares de variables justifica plenamente la aplicación del ACP: la reducción dimensional elimina redundancia sin perder información esencial (Jolliffe, 2002; Hastie et al., 2009).

### ACP

El Análisis de Componentes Principales fue aplicado al conjunto de 17 variables estandarizadas para identificar las dimensiones latentes subyacentes de variabilidad en el desarrollo internacional. El procedimiento consiste en la descomposición espectral de la matriz de covarianza estandarizada, identificando vectores propios (componentes) ordenados según sus valores propios (autovalores) en orden descendente. Cada componente principal es una combinación lineal ortogonal de las variables originales, diseñada para capturar la máxima varianza posible de manera sucesiva (Jolliffe, 2002; Hastie et al., 2009).

```{r ACP}
res.pca <- prcomp(datos_analisis, scale = TRUE)
acp_temp <- dudi.pca(datos_analisis, center = TRUE, scale = TRUE, scannf = FALSE, nf = ncol(datos_analisis))
varianza_acum <- cumsum(acp_temp$eig) / sum(acp_temp$eig) * 100
factores <- acp_temp$li
```

```{r Tabla varianza}

varianza_df <- data.frame(
  Componente = factor(1:length(acp_temp$eig)),
  Varianza = acp_temp$eig / sum(acp_temp$eig) * 100,
  VarianzaAcum = varianza_acum
) %>%  gt() %>%
  tab_header(
    title = md("**Tabla 5**"),
    subtitle = "Varianza Explicada por Componentes Principales"
  ) %>%
  cols_label(
    Componente = md("**Componente**"),
    Varianza = md("**Varianza (%)**"),
    VarianzaAcum = md("**Varianza Acumulada (%)**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  fmt_number(
    columns = c(Varianza, VarianzaAcum),
    decimals = 2
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Componente, Varianza))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Componente)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Varianza, VarianzaAcum))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboración propia con base en los resultados del ACP")
  ) %>%
  tab_footnote(
    footnote = "Porcentaje de varianza explicada individualmente por cada componente principal",
    locations = cells_body(
      rows = 1,
      columns = Varianza
    )
  ) %>%
  tab_footnote(
    footnote = "Porcentaje acumulado de varianza explicada por los componentes hasta el actual",
    locations = cells_body(
      rows = 1,
      columns = VarianzaAcum
    )
  ) %>%
  tab_footnote(
    footnote = "Los componentes principales se ordenan de mayor a menor varianza explicada",
    locations = cells_title(groups = "subtitle")
  )

varianza_df 

varianza_df <- data.frame(
  Componente = paste0("PC", 1:length(acp_temp$eig)),
  Varianza = acp_temp$eig / sum(acp_temp$eig) * 100,
  VarianzaAcum = varianza_acum
)

pc1_var <- round(varianza_df$Varianza[1], 1)
pc2_var <- round(varianza_df$Varianza[2], 1)
pc3_var <- round(varianza_df$Varianza[3], 1)
pc4_var <- round(varianza_df$Varianza[4], 1)


pc1_acum <- round(varianza_df$VarianzaAcum[1], 1)
pc2_acum <- round(varianza_df$VarianzaAcum[2], 1)
pc3_acum <- round(varianza_df$VarianzaAcum[3], 1)
pc4_acum <- round(varianza_df$VarianzaAcum[4], 1)



```

En este análisis, el primer componente (**PC1**) capturó un **`r pc1_var`%** de la varianza total, lo que indica que existe una dimensión principal que diferencia fundamentalmente a los países. Los componentes posteriores capturan variabilidad subsidiaria: el segundo componente (**PC2**) explica **`r pc2_var`%** (acumulando **`r pc2_acum`%**), el tercero (**PC3**) **`r pc3_var`%** (acumulando **`r pc3_acum`%**), el cuarto (**PC4**) **`r pc4_var`%** (acumulando **`r pc4_acum`%**).

### Grafico de sedimentacion

El gráfico de sedimentación visualiza el concepto del "codo" (elbow) introducido por Kaiser (1960). La curva de los eigenvalores (representada como barras) exhibe un descenso pronunciado en los primeros componentes, indicando que capturan varianza sustancial. A partir de cierto componente, la pendiente se aplana significativamente, entrando en un régimen donde componentes posteriores explican proporciones cada vez menores de varianza residual (Hastie et al., 2009).

```{r sedimentacion, message =FALSE}
res.pca <- prcomp(datos_analisis, scale = TRUE)


eig.val <- get_eigenvalue(res.pca)
fviz_eig(res.pca,
         addlabels = TRUE,
         ylim = c(0, max(get_eigenvalue(res.pca)[, 2]) + 5),
         choice = "variance") +
  labs(
    title = "Varianza Explicada por Componente Principal",
    subtitle = "Autovalores del análisis de componentes principales",
    x = "Componentes Principales",
    y = "Porcentaje de Varianza Explicada (%)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5, color = "#2C5F8D"),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40"),
    axis.title = element_text(face = "bold", size = 12, color = "#2C5F8D"),
    axis.text = element_text(size = 10, color = "gray30"),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "gray92", size = 0.3),
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white")
  ) +
  scale_fill_manual(values = "#2C5F8D") +
  scale_color_manual(values = "#2C5F8D")
```

```{r, include=FALSE}
res.var <- get_pca_var(res.pca)
res.var$coord          
res.var$contrib        
res.var$cos2  
```

El punto donde esta curvatura cambia de pronunciada a plana (el "codo") indica aproximadamente el número de componentes que retienen información relevante; componentes posteriores al codo tienden a capturar principalmente ruido estadístico (Jolliffe, 2002).

### Contribución de Variables a Componentes Principales

La comprensión de cómo cada variable original contribuye a la definición de los componentes principales es esencial para interpretar las dimensiones latentes descubiertas. La contribución de una variable a un componente cuantifica el grado en el cual esa variable particular "explica" o "define" la dirección de ese componente en el espacio multidimensional original. Matemáticamente, la contribución se expresa como porcentaje de la varianza del componente que puede atribuirse a cada variable (Hastie et al., 2009; Jolliffe, 2002).

Adicionalmente, la calidad de representación (cos²) de una variable en un componente indica qué proporción de la variabilidad total de esa variable es capturada por el componente. Un cos² cercano a 1 significa que la variable está casi completamente explicada por ese componente; un cos² cercano a 0 significa que la variable requiere componentes posteriores para ser bien representada (Jolliffe, 2002). Estas dos medidas—contribución y $cos^2$—son complementarias: la primera explica la importancia relativa de una variable en definir un componente; la segunda explica qué tan bien ese componente explica la variable (Hastie et al., 2009).

```{r contribucion, message=FALSE}
contribuciones <- as.data.frame(res.pca$rotation)  
contribuciones$Variable <- rownames(contribuciones)

cos2_df <- as.data.frame(res.pca$rotation^2)  
cos2_df$Variable <- rownames(cos2_df)

crear_tabla_contribucion <- function(componente_num, contrib_df, cos2_df, titulo, tabla_num) {
  comp_col <- paste0("PC", componente_num)
  
  comp_data <- contrib_df %>%
    select(Variable, all_of(comp_col)) %>%
    rename(Loading = all_of(comp_col))
  
  cos2_data <- cos2_df %>%
    select(Variable, all_of(comp_col)) %>%
    rename(Cos2 = all_of(comp_col))
  
  comp_data <- comp_data %>%
    left_join(cos2_data, by = "Variable") %>%
    mutate(LoadingAbs = abs(Loading)) %>%
    arrange(desc(LoadingAbs)) %>%
    select(-LoadingAbs) %>%
    mutate(
      Loading = round(Loading, 4),
      Cos2 = round(Cos2, 4)
    )
  descripciones <- c(
    "PIB_per" = "PIB per cápita (US$)",
    "Poblacion" = "Población total",
    "Esperanza.vida" = "Esperanza de vida al nacer (años)",  # Posiblemente con punto
    "Esperanza vida" = "Esperanza de vida al nacer (años)",  # O con espacio
    "Acceso.electricidad" = "Acceso a electricidad (% población)",
    "Acceso electricidad" = "Acceso a electricidad (% población)",
    "Area.boscosa" = "Área boscosa (% territorio)",
    "Area boscosa" = "Área boscosa (% territorio)",
    "Suscripciones.movil" = "Suscripciones móviles (cada 100 hab.)",
    "Suscripciones movil" = "Suscripciones móviles (cada 100 hab.)",
    "Crecimiento.PIB" = "Crecimiento del PIB (% anual)",
    "Crecimiento PIB" = "Crecimiento del PIB (% anual)",
    "Mortalidad.infantil" = "Mortalidad infantil (cada 1,000 nac.)",
    "Mortalidad infantil" = "Mortalidad infantil (cada 1,000 nac.)",
    "Inversion.extranjera" = "Inversión extranjera (% PIB)",
    "Inversion extranjera" = "Inversión extranjera (% PIB)",
    "Gasto.salud" = "Gasto en salud (% PIB)",
    "Gasto salud" = "Gasto en salud (% PIB)",
    "Uso.internet" = "Uso de internet (% población)",
    "Uso internet" = "Uso de internet (% población)",
    "Importaciones" = "Importaciones (% PIB)",
    "Exportaciones" = "Exportaciones (% PIB)",
    "Tierra.cultivable" = "Tierra cultivable (% territorio)",
    "Tierra cultivable" = "Tierra cultivable (% territorio)",
    "Crecimiento.poblacion" = "Crecimiento poblacional (% anual)",
    "Crecimiento poblacion" = "Crecimiento poblacional (% anual)",
    "Industria" = "Industria (% PIB)",
    "Remesas" = "Remesas recibidas (% PIB)"
  )
  
  comp_data <- comp_data %>%
    mutate(
      Descripcion = ifelse(
        Variable %in% names(descripciones), 
        descripciones[Variable], 
        Variable  
      ),
      Interpretacion = paste0(
        "Loading: ", Loading, 
        " | Cos²: ", Cos2,
        case_when(
          abs(Loading) >= 0.8 ~ " (Contribución muy fuerte)",
          abs(Loading) >= 0.6 ~ " (Contribución fuerte)", 
          abs(Loading) >= 0.4 ~ " (Contribución moderada)",
          abs(Loading) >= 0.2 ~ " (Contribución débil)",
          TRUE ~ " (Contribución muy débil)"
        )
      )
    ) %>%
    select(Variable, Descripcion, Interpretacion)
  
  tabla <- comp_data %>%
    gt() %>%
    tab_header(
      title = md(paste0("**Tabla ", tabla_num, "**")),
      subtitle = titulo
    ) %>%
    cols_label(
      Variable = md("**Variable**"),
      Descripcion = md("**Descripción**"),
      Interpretacion = md("**Interpretación**")
    ) %>%
    cols_align(
      align = "left",
      columns = everything()
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold", size = "medium"),
        cell_fill(color = "white")
      ),
      locations = cells_column_labels()
    ) %>%
    tab_style(
      style = cell_borders(
        sides = c("top", "bottom"),
        color = "black",
        weight = px(1)
      ),
      locations = list(
        cells_column_labels(),
        cells_body()
      )
    ) %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "gray80",
        weight = px(1)
      ),
      locations = cells_body(columns = c(Variable, Descripcion))
    ) %>%
    tab_style(
      style = cell_text(weight = "bold"),
      locations = cells_body(columns = Variable)
    ) %>%
    tab_style(
      style = cell_text(size = "small"),
      locations = cells_body(columns = c(Descripcion, Interpretacion))
    ) %>%
    tab_options(
      table.font.names = "Times New Roman",
      table.width = pct(100),
      table.border.top.style = "none",
      table.border.bottom.style = "none",
      column_labels.border.top.style = "none",
      column_labels.border.bottom.width = px(2),
      column_labels.border.bottom.color = "black",
      table_body.border.bottom.style = "none",
      table_body.border.top.style = "none",
      data_row.padding = px(8),
      heading.title.font.size = 14,
      heading.subtitle.font.size = 12,
      heading.padding = px(4),
      footnotes.padding = px(4)
    ) %>%
    tab_source_note(
      source_note = md("**Fuentes:** Elaboración propia con base en los resultados del ACP (prcomp)")
    ) %>%
    tab_footnote(
      footnote = "Loading: contribución de la variable al componente (valores absolutos >0.6 indican contribución fuerte)",
      locations = cells_title(groups = "subtitle")
    ) %>%
    tab_footnote(
      footnote = "Cos²: calidad de representación de la variable en el componente (valores cercanos a 1 indican mejor representación)",
      locations = cells_body(
        rows = 1,
        columns = Interpretacion
      )
    )
  
  return(tabla)
}

tabla_pc1 <- crear_tabla_contribucion(1, contribuciones, cos2_df,
                                     "Contribución de Variables al Componente Principal 1 (24.3% de varianza)",
                                     6)

tabla_pc2 <- crear_tabla_contribucion(2, contribuciones, cos2_df,
                                     "Contribución de Variables al Componente Principal 2 (13.5% de varianza)", 
                                     7)

tabla_pc3 <- crear_tabla_contribucion(3, contribuciones, cos2_df,
                                     "Contribución de Variables al Componente Principal 3 (9.1% de varianza)",
                                     8)

tabla_pc4 <- crear_tabla_contribucion(4, contribuciones, cos2_df,
                                     "Contribución de Variables al Componente Principal 4 (7.5% de varianza)",
                                     9)
tabla_pc1
tabla_pc2
tabla_pc3
tabla_pc4
```

### Análisis Multivariado: Interpretación de Componentes y Países

Una vez identificados los componentes principales y cuantificadas las contribuciones de cada variable, es fundamental realizar un análisis multivariado que permita interpretar simultáneamente las relaciones entre países y variables en el espacio reducido de componentes principales. Este análisis se fundamenta en visualizaciones bidimensionales que proyectan tanto países (individuos) como variables sobre los planos definidos por pares de componentes principales, revelando patrones de similitud, agrupamientos naturales y características diferenciadoras entre grupos de países (Jolliffe, 2002; Hastie et al., 2009).

```{r individuos DIM 1 Y DIM 2}
ind_data <- get_pca_ind(res.pca)


ind_df <- data.frame(
  Pais = rownames(ind_data$coord),
  Dim1 = ind_data$coord[, 1],
  Dim2 = ind_data$coord[, 2],
  Dim3 = ind_data$coord[, 3],
  Dim4 = ind_data$coord[, 4],
  Contrib1 = ind_data$contrib[, 1],
  Contrib2 = ind_data$contrib[, 2],
  Contrib3 = ind_data$contrib[, 3],
  Contrib4 = ind_data$contrib[, 4],
  Cos2_1 = ind_data$cos2[, 1],
  Cos2_2 = ind_data$cos2[, 2],
  Cos2_3 = ind_data$cos2[, 3],
  Cos2_4 = ind_data$cos2[, 4]
)

p1 <- plot_ly(ind_df,
              x = ~Dim1, 
              y = ~Dim2,
              color = ~Contrib1,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Pais, "</b><br>",
                            "Dim 1:", round(Dim1, 3), "<br>",
                            "Dim 2:", round(Dim2, 3), "<br>",
                            "<b>Contribución Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                            "<b>Contribución Dim 2:</b> ", round(Contrib2, 2), "%<br>",
                            "Cos2 Dim 1:", round(Cos2_1, 3), "<br>",
                            "Cos2 Dim 2:", round(Cos2_2, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 10, opacity = 0.8, line = list(width = 1, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  layout(
    title = list(
      text = "Individuos: Dimensión 1 vs Dimensión 2<br><sub>Coloreado por Contribución Dim 1</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 1", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 2", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p1


```

Se puede observar que Qatar tiene una contribución alta en la dimension 2, la cual es de 11.66%, es algo esperable sabiendo que el país árabe tiene un gran comercio. Mientras que San Marino contribuye en la dimensión 2 con un 0.3%, contrariamente de su aporte en la dimensión 1 el cual es 3.14%, lo cual refiere a qué este país, tiene una baja tasa económica mientras que en factores como esperanza de vida es muy fuerte.

Al contrario podemos ver países como Niger el cual la dimensión 2 tiene un aporte de 0,64%, lo cual nos da a pensar que este país tiene deficiencia en lo económico

```{r individuos DIM 3 Y DIM 4}

p2 <- plot_ly(ind_df,
              x = ~Dim3, 
              y = ~Dim4,
              color = ~Contrib3,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Pais, "</b><br>",
                            "Dim 3:", round(Dim3, 3), "<br>",
                            "Dim 4:", round(Dim4, 3), "<br>",
                            "<b>Contribución Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                            "<b>Contribución Dim 4:</b> ", round(Contrib4, 2), "%<br>",
                            "Cos2 Dim 3:", round(Cos2_3, 3), "<br>",
                            "Cos2 Dim 4:", round(Cos2_4, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 10, opacity = 0.8, line = list(width = 1, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  layout(
    title = list(
      text = "Individuos: Dimensión 3 vs Dimensión 4<br><sub>Coloreado por Contribución Dim 3</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 3", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 4", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p2
```

Al observar el grafico podemos identificar algunos datos, casos como la India donde su aporte en la dimensión 4 es de 18,65% lo cual nos demuestra su gran tasa poblacional y de tierra cultivable. Timor-leste tiene un aporte en la dimensión 4 de un 8.49% el cual refiere que tiene poca tendencia de uso de internet y un alta área boscosa. Otro caso a referir Djibouti tiene dos valores importantes en la dimensión 3 tiene un aporte de 10.69% y en la 4 de 0,28%, lo cual refiere que es uno de los paises que menos exporta y más importa.

```{r Contrubuciones paises}
coordenadas_paises <- as.data.frame(ind_data$coord)
coordenadas_paises$Pais <- rownames(coordenadas_paises)

crear_tabla_bidireccional <- function(componente_num, titulo, tabla_num) {
  col_coord <- paste0("Dim.", componente_num)
  top_positivo <- coordenadas_paises %>%
    select(Pais, Coordenada = all_of(col_coord)) %>%
    arrange(desc(Coordenada)) %>%
    slice(1:5) %>%
    mutate(
      Coordenada = round(Coordenada, 3),
      Direccion = "Positiva",
      Posicion = 1:5
    )
  top_negativo <- coordenadas_paises %>%
    select(Pais, Coordenada = all_of(col_coord)) %>%
    arrange(Coordenada) %>%
    slice(1:5) %>%
    mutate(
      Coordenada = round(Coordenada, 3),
      Direccion = "Negativa",
      Posicion = 1:5
    )
  tabla_combinada <- bind_rows(top_positivo, top_negativo) %>%
    select(Posicion, Pais, Coordenada, Direccion)
  tabla <- tabla_combinada %>%
    gt(groupname_col = "Direccion") %>%
    tab_header(
      title = md(paste0("**Tabla ", tabla_num, "**")),
      subtitle = titulo
    ) %>%
    cols_label(
      Posicion = md("**Posición**"),
      Pais = md("**País**"),
      Coordenada = md("**Coordenada**")
    ) %>%
    cols_align(
      align = "center",
      columns = everything()
    ) %>%
    fmt_number(
      columns = Coordenada,
      decimals = 3
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold", size = "medium"),
        cell_fill(color = "white")
      ),
      locations = cells_column_labels()
    ) %>%
    tab_style(
      style = cell_borders(
        sides = c("top", "bottom"),
        color = "black",
        weight = px(1)
      ),
      locations = list(
        cells_column_labels(),
        cells_body()
      )
    ) %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "gray80",
        weight = px(1)
      ),
      locations = cells_body(columns = c(Posicion, Pais))
    ) %>%
    tab_style(
      style = cell_text(weight = "bold"),
      locations = cells_body(columns = c(Posicion, Pais))
    ) %>%
    tab_style(
      style = cell_fill(color = "#E8F5E8"),
      locations = cells_body(
        rows = Direccion == "Positiva"
      )
    ) %>%
    tab_style(
      style = cell_fill(color = "#FFE6E6"),
      locations = cells_body(
        rows = Direccion == "Negativa"
      )
    ) %>%
    tab_options(
      table.font.names = "Times New Roman",
      table.width = pct(80),
      table.border.top.style = "none",
      table.border.bottom.style = "none",
      column_labels.border.top.style = "none",
      column_labels.border.bottom.width = px(2),
      column_labels.border.bottom.color = "black",
      table_body.border.bottom.style = "none",
      table_body.border.top.style = "none",
      data_row.padding = px(8),
      heading.title.font.size = 14,
      heading.subtitle.font.size = 12,
      heading.padding = px(4),
      footnotes.padding = px(4)
    ) %>%
    tab_source_note(
      source_note = md("**Fuentes:** Elaboración propia con base en los resultados del ACP")
    ) %>%
    tab_footnote(
      footnote = "Coordenadas positivas indican valores altos en las variables que definen este componente",
      locations = cells_row_groups(groups = "Positiva")
    ) %>%
    tab_footnote(
      footnote = "Coordenadas negativas indican valores bajos en las variables que definen este componente",
      locations = cells_row_groups(groups = "Negativa")
    )
  
  return(tabla)
}


tabla_pc1_bidireccional <- crear_tabla_bidireccional(1, 
  "Países con Mayor Influencia en el Componente Principal 1 (24.3% de varianza)", 
  "13")

tabla_pc2_bidireccional <- crear_tabla_bidireccional(2, 
  "Países con Mayor Influencia en el Componente Principal 2 (13.5% de varianza)", 
  "14")

tabla_pc3_bidireccional <- crear_tabla_bidireccional(3, 
  "Países con Mayor Influencia en el Componente Principal 3 (9.1% de varianza)", 
  "15")

tabla_pc4_bidireccional <- crear_tabla_bidireccional(4, 
  "Países con Mayor Influencia en el Componente Principal 4 (7.5% de varianza)", 
  "16")


tabla_pc1_bidireccional
tabla_pc2_bidireccional
tabla_pc3_bidireccional
tabla_pc4_bidireccional
```

### Representación de Variables en el Plano de Componentes Principales

El círculo de correlaciones es una herramienta fundamental para interpretar las dimensiones latentes capturadas por PC1 y PC2. Cada una de las 17 variables originales se representa como un vector (flecha) proyectado desde el origen hacia el plano bidimensional definido por los dos primeros componentes principales. La longitud de cada flecha indica la calidad de representación de esa variable: flechas largas (próximas al círculo unitario de referencia) indican variables bien representadas en PC1-PC2, mientras que flechas cortas indican que la variable requiere componentes posteriores para ser completamente explicada (Jolliffe, 2002; Hastie et al., 2009).

La dirección de cada flecha—es decir, el ángulo que forma con los ejes PC1 y PC2—indica cómo esa variable se correlaciona con los componentes. Las variables posicionadas en la dirección positiva del eje PC1 (hacia la derecha del gráfico) son aquellas que correlacionan positivamente con PC1 y, por lo tanto, caracterizan el polo derecho del eje.

```{r Variables DIM 1 Y DIM 2}

var_data <- get_pca_var(res.pca)

var_df <- data.frame(
  Variable = rownames(var_data$coord),
  Dim1 = var_data$coord[, 1],
  Dim2 = var_data$coord[, 2],
  Dim3 = var_data$coord[, 3],
  Dim4 = var_data$coord[, 4],
  Contrib1 = var_data$contrib[, 1],
  Contrib2 = var_data$contrib[, 2],
  Contrib3 = var_data$contrib[, 3],
  Contrib4 = var_data$contrib[, 4],
  Cos2_1 = var_data$cos2[, 1],
  Cos2_2 = var_data$cos2[, 2],
  Cos2_3 = var_data$cos2[, 3],
  Cos2_4 = var_data$cos2[, 4]
)


p1 <- plot_ly(var_df,
              x = ~Dim1, 
              y = ~Dim2,
              color = ~Contrib1,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Variable, "</b><br>",
                            "Dim 1:", round(Dim1, 3), "<br>",
                            "Dim 2:", round(Dim2, 3), "<br>",
                            "<b>Contribución Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                            "<b>Contribución Dim 2:</b> ", round(Contrib2, 2), "%<br>",
                            "Cos2 Dim 1:", round(Cos2_1, 3), "<br>",
                            "Cos2 Dim 2:", round(Cos2_2, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 12, opacity = 0.8, line = list(width = 2, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  add_segments(x = 0, xend = ~Dim1, y = 0, yend = ~Dim2,
               line = list(color = "rgba(100, 100, 100, 0.3)", width = 1),
               showlegend = FALSE, hoverinfo = "skip") %>%
  
  layout(
    title = list(
      text = "Variables: Dimensión 1 vs Dimensión 2<br><sub>Coloreado por Contribución Dim 1</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 1", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 2", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p1
```

Observamos en el gráfico que las variables que más contribuyen a la dimensión 1 son esperanza de vida positivamente (17.03%), uso de internet positivamente (16.88%) y mortalidad infantil negativamente (16.63%) A la dimensión 2 son la indutria negativamente (27.37%), el crecimiento poblacional negativamente (18.23%) y las remesas positivamente (13.15%)

```{r Variables DIM 3 Y DIM 4}
p2 <- plot_ly(var_df,
              x = ~Dim3, 
              y = ~Dim4,
              color = ~Contrib3,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Variable, "</b><br>",
                            "Dim 3:", round(Dim3, 3), "<br>",
                            "Dim 4:", round(Dim4, 3), "<br>",
                            "<b>Contribución Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                            "<b>Contribución Dim 4:</b> ", round(Contrib4, 2), "%<br>",
                            "Cos2 Dim 3:", round(Cos2_3, 3), "<br>",
                            "Cos2 Dim 4:", round(Cos2_4, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 12, opacity = 0.8, line = list(width = 2, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  add_segments(x = 0, xend = ~Dim3, y = 0, yend = ~Dim4,
               line = list(color = "rgba(100, 100, 100, 0.3)", width = 1),
               showlegend = FALSE, hoverinfo = "skip") %>%
  
  layout(
    title = list(
      text = "Variables: Dimensión 3 vs Dimensión 4<br><sub>Coloreado por Contribución Dim 3</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 3", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 4", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p2
```

A la dimensión 3 las variables que más contribuyen son las importaciones negativamente (26.78%), las exportaciones negativamente (26.43%) y la inversión extranjera negativamente (13.2%). En la dimensión 4 las variables que más contribuyen son el area boscosa negativamente (29.47%), la tierra cultivable positivamente (26.32%)y la población positivamente (19.51%).

### Análisis Integrado de Variables y Países

El análisis combinado de las variables y los países en el espacio reducido de los componentes principales permite identificar patrones de asociación estructural que trascienden el análisis univariable. La metodología del biplot permite vincular directamente las posiciones espaciales de los países con las magnitudes observadas en las variables originales, estableciendo relaciones interpretativas que evidencian cómo las características multidimensionales de desarrollo se manifiestan diferencialmente en distintos grupos de países (Jolliffe, 2002; Hastie et al., 2009).

Para comprender la lógica interpretativa del biplot, es fundamental reconocer que la posición de un país en relación a la dirección de una flecha de variable indica el valor relativo de ese país en esa variable específica. Países ubicados en la misma dirección que una flecha exhiben valores altos en esa variable; países ubicados en dirección opuesta exhiben valores bajos; países ubicados perpendicularmente (formando ángulos de \~$90°$) exhiben valores cercanos a la media global. Esta propiedad geométrica del biplot permite realizar diagnósticos cuantitativos directamente desde la visualización gráfica, sin necesidad de consultar la base de datos original, siempre que la calidad de representación ($cos²$) sea suficientemente alta (Jolliffe, 2002).

```{r Paises y variables DIM 1 Y DIM 2}
ind_data <- get_pca_ind(res.pca)
var_data <- get_pca_var(res.pca)


ind_df <- data.frame(
  Pais = rownames(ind_data$coord),
  Dim1 = ind_data$coord[, 1],
  Dim2 = ind_data$coord[, 2],
  Dim3 = ind_data$coord[, 3],
  Dim4 = ind_data$coord[, 4],
  Contrib1 = ind_data$contrib[, 1],
  Contrib2 = ind_data$contrib[, 2],
  Contrib3 = ind_data$contrib[, 3],
  Contrib4 = ind_data$contrib[, 4]
)

var_df <- data.frame(
  Variable = rownames(var_data$coord),
  Dim1 = var_data$coord[, 1] * 3,
  Dim2 = var_data$coord[, 2] * 3,
  Dim3 = var_data$coord[, 3] * 3,
  Dim4 = var_data$coord[, 4] * 3,
  Contrib1 = var_data$contrib[, 1],
  Contrib2 = var_data$contrib[, 2],
  Contrib3 = var_data$contrib[, 3],
  Contrib4 = var_data$contrib[, 4]
)

p1 <- plot_ly() %>%
  
  add_segments(
    data = var_df,
    x = 0, xend = ~Dim1, y = 0, yend = ~Dim2,
    line = list(color = "#2E9FDF", width = 2),
    showlegend = FALSE, hoverinfo = "skip"
  ) %>%
  
  add_trace(
    data = var_df,
    x = ~Dim1, y = ~Dim2,
    text = ~paste("<b>VARIABLE: ", Variable, "</b><br>",
                  "Dim 1:", round(Dim1/3, 3), "<br>",
                  "Dim 2:", round(Dim2/3, 3), "<br>",
                  "<b>Contribución Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                  "<b>Contribución Dim 2:</b> ", round(Contrib2, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 10, color = "#2E9FDF", opacity = 0.8, line = list(width = 2, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Variables"
  ) %>%
  
  add_trace(
    data = ind_df,
    x = ~Dim1, y = ~Dim2,
    text = ~paste("<b>PAÍS: ", Pais, "</b><br>",
                  "Dim 1:", round(Dim1, 3), "<br>",
                  "Dim 2:", round(Dim2, 3), "<br>",
                  "<b>Contribución Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                  "<b>Contribución Dim 2:</b> ", round(Contrib2, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 8, color = "#696969", opacity = 0.6, line = list(width = 1, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Países"
  ) %>%
  
  layout(
    title = list(
      text = "Biplot: Dimensión 1 vs Dimensión 2<br><sub>Azul = Variables | Gris = Países</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 1", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 2", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    legend = list(x = 0.02, y = 0.98)
  )

p1

```

Senegal y Burkina Faso se alinean con la flecha de mortalidad infantil, confirmando valores altos en esa variable. Egipto se alinea con crecimiento poblacional, indicando tasa de crecimiento demográfico elevada. Corea del Sur y Nueva Zelanda se alinean con exportaciones, indicando economías muy orientadas a comercio externo. Suiza se alinea con esperanza de vida, confirmando longevidad excepcional.

En dirección opuesta: países desarrollados europeos se oponen a flechas de mortalidad y rezago, reflejando valores bajos en estos indicadores negativos. Honduras y República Kirguisa se alinean con remesas, indicando dependencia crítica de transferencias de migrantes.

```{r Paises y variables DIM 3 Y DIM 4}
p2 <- plot_ly() %>%
  
  add_segments(
    data = var_df,
    x = 0, xend = ~Dim3, y = 0, yend = ~Dim4,
    line = list(color = "#2E9FDF", width = 2),
    showlegend = FALSE, hoverinfo = "skip"
  ) %>%
  
  add_trace(
    data = var_df,
    x = ~Dim3, y = ~Dim4,
    text = ~paste("<b>VARIABLE: ", Variable, "</b><br>",
                  "Dim 3:", round(Dim3/3, 3), "<br>",
                  "Dim 4:", round(Dim4/3, 3), "<br>",
                  "<b>Contribución Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                  "<b>Contribución Dim 4:</b> ", round(Contrib4, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 10, color = "#2E9FDF", opacity = 0.8, line = list(width = 2, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Variables"
  ) %>%
  
  add_trace(
    data = ind_df,
    x = ~Dim3, y = ~Dim4,
    text = ~paste("<b>PAÍS: ", Pais, "</b><br>",
                  "Dim 3:", round(Dim3, 3), "<br>",
                  "Dim 4:", round(Dim4, 3), "<br>",
                  "<b>Contribución Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                  "<b>Contribución Dim 4:</b> ", round(Contrib4, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 8, color = "#696969", opacity = 0.6, line = list(width = 1, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Países"
  ) %>%
  
  layout(
    title = list(
      text = "Biplot: Dimensión 3 vs Dimensión 4<br><sub>Azul = Variables | Gris = Países</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 3", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensión 4", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    legend = list(x = 0.02, y = 0.98)
  )

p2
```

Guinea se posiciona en la dirección de crecimiento poblacional, indicando valores altos en esta variable. Kuwait y Djibouti se alinean con importaciones, indicando ratios elevados. Senegal e Irlanda se alinean con exportaciones, indicando orientación exportadora. Burkina Faso y Qatar se alinean con mortalidad infantil, indicando valores en esta variable. Macedonia del Norte se alinea con PIB per cápita, indicando ingreso por habitante en esa dirección.



## Segmentación: Clusterización

Sobre la base de los 4 componentes principales retenidos del Análisis de Componentes Principales, se aplicó el método de Ward para clusterización jerárquica aglomerativa. Este algoritmo organiza los datos con el objetivo de determinar clusters de países mediante un enfoque que se basa en la distancia entre los puntos para mostrar posibles agrupamientos. El procedimiento iterativo de fusión permite identificar estructuras naturales de similitud que trascienden clasificaciones geográficas o económicas convencionales, revelando en cambio grupos de países que comparten perfiles multidimensionales coherentes de desarrollo (Ward, 1963; Hastie et al., 2009).

El método de Ward minimiza específicamente la suma total de cuadrados dentro de clusters (*within-cluster sum of squares*, WCSS), definida matemáticamente como:

$$WCSS = \sum_{c=1}^{C} \sum_{i \in c} ||x_i - \bar{c}||^2$$

donde: - $C$ es el número de clusters, - $x_i$ es la posición de la observación $i$ en el espacio de componentes principales, - $\bar{c}$ es el centroide (promedio) del cluster $c$.

En cada paso del algoritmo, se identifican los dos clusters cuya fusión produce el incremento mínimo en WCSS total, maximizando así la homogeneidad interna de cada cluster mientras se maximiza la disimilaridad entre clusters (Ward, 1963; Hastie et al., 2009).

```{r clusters, message=FALSE,warning=FALSE}
library(FactoClass)
library(ade4)

resultado_ACP <- FactoClass(
  datos_analisis,  
  dudi.pca,       
  nf = 4,           
  k.clust = 3,      
  scan = FALSE     
)

clusters_asignados <- resultado_ACP$cluster

NuevaBase <- data.frame(Cluster = clusters_asignados, datos_analisis)
```

### Numero optimo de clusters

La selección del número óptimo de clusters k se realizó mediante la evaluación conjunta de tres criterios complementarios: análisis del dendrograma, método del codo, y coherencia interpretativa. El dendrograma revela visualmente la estructura jerárquica de fusiones: se identifican alturas donde las fusiones producen incrementos dramáticos en disimilaridad, sugiriendo que clusters diferenciados se están uniendo. Un corte horizontal del dendrograma a altura intermedia permite definir el número de clusters finales.

El método del codo examina cómo disminuye WCSS (suma de cuadrados dentro de clusters) conforme aumenta el número de clusters desde $k=2$ hasta $k=10$ Inicialmente, incrementar $k$ reduce WCSS rápidamente porque se reduce heterogeneidad interna; sin embargo, a partir de cierto $k$ (el "codo"), la reducción adicional se vuelve marginal, sugiriendo que clusters posteriores no capturan estructura genuina sino que simplemente subdividen artificialmente. Típicamente, el codo se identifica en $k=3$ a $k=4$ para análisis de desarrollo internacional.

```{r dendograma-corregido, message=FALSE, warning=FALSE}
library(plotly)
library(factoextra)
library(FactoMineR)
library(cluster)
library(ggplot2)
library(dendextend)
library(plotly)
library(ggdendro)

acp_result <- resultado_ACP$dudi

p1 <- fviz_eig(acp_result, 
               addlabels = TRUE, 
               ylim = c(0, 30),
               barfill = "#2E9FDF",
               barcolor = "#2E9FDF",
               linecolor = "#FC4E07",
               main = "Varianza Explicada por Componentes Principales",
               xlab = "Componentes Principales",
               ylab = "Porcentaje de Varianza Explicada") +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14, hjust = 0.5),
    axis.title = element_text(face = "bold")
  )

p1_interactive <- ggplotly(p1) %>%
  layout(
    title = list(
      text = "<b>Varianza Explicada por Componentes Principales</b>",
      x = 0.05
    )
  )
p1_interactive


coordenadas_pca <- as.data.frame(resultado_ACP$dudi$li[, 1:4])
distancias <- dist(coordenadas_pca)
hc <- hclust(distancias, method = "ward.D2")


par(mar = c(5, 4, 4, 8)) 
plot(hc, 
     main = "Dendrograma - Clustering Jerárquico",
     xlab = "Países", 
     ylab = "Distancia",
     cex = 0.6,
     hang = -1)
dend <- as.dendrogram(hc)
dend_colored <- color_branches(dend, k = 3, col = c("#2E9FDF", "#00AFBB", "#E7B800"))




dend_data <- dendro_data(dend_colored)
rect.hclust(hc, k = 3, border = c("#2E9FDF", "#00AFBB", "#E7B800"))










```

La coherencia interpretativa valida que los clusters identificados tienen significado económico y social claro. En este análisis, se seleccionó $k=3$ clusters porque esta segmentación produce tres grupos conceptualmente diferenciados.

### Graficos clusters




### Gráficas Interactivas Profesionales con Centroides y Elipses
### Gráficas Interactivas Profesionales Corregidas
### Gráficas Animadas Interactivas - Dimensiones 1-2 y 1-3
```{r graficas-animadas-mejoradas, message=FALSE, warning=FALSE}
library(plotly)
library(dplyr)

# Preparar datos base
coordenadas_paises <- as.data.frame(resultado_ACP$dudi$li)
coordenadas_paises$Pais <- rownames(coordenadas_paises)
coordenadas_paises$Cluster <- as.factor(NuevaBase$Cluster)

# Definir colores y nombres de clusters
colores_clusters <- c("1" = "#2C5F8D", "2" = "#27AE60", "3" = "#8E44AD")
nombres_clusters <- c("1" = "Desarrollado", "2" = "Emergente", "3" = "En Desarrollo")

# ========== GRÁFICA 1: DIMENSIONES 1-2 ==========

# Preparar datos para 1-2
datos_12 <- data.frame(
  Pais = coordenadas_paises$Pais,
  Comp1 = coordenadas_paises$Axis1,
  Comp2 = coordenadas_paises$Axis2,
  Cluster = coordenadas_paises$Cluster
)

# Calcular centroides para 1-2
centroides_12 <- datos_12 %>%
  group_by(Cluster) %>%
  summarise(
    Centroid1 = mean(Comp1),
    Centroid2 = mean(Comp2),
    .groups = 'drop'
  )

# Crear gráfica animada para 1-2
p_12_animado <- plot_ly() %>%
  
  # Añadir países con animación
  add_trace(
    data = datos_12,
    x = ~Comp1,
    y = ~Comp2,
    color = ~Cluster,
    colors = colores_clusters,
    text = ~paste("<b>", Pais, "</b><br>",
                  "<b>Cluster:</b> ", nombres_clusters[as.character(Cluster)], "<br>",
                  "<b>Dimensión 1:</b> ", round(Comp1, 3), "<br>",
                  "<b>Dimensión 2:</b> ", round(Comp2, 3)),
    type = "scatter",
    mode = "markers",
    marker = list(
      size = 12,
      opacity = 0.8,
      line = list(width = 2, color = "white")
    ),
    hovertemplate = '%{text}<extra></extra>',
    name = ~nombres_clusters[as.character(Cluster)],
    showlegend = TRUE,
    # Efectos de animación
    hoverlabel = list(bgcolor = "white", font = list(color = "black")),
    hoveron = "points"
  ) %>%
  
  # Añadir centroides con símbolos especiales
  add_trace(
    data = centroides_12,
    x = ~Centroid1,
    y = ~Centroid2,
    color = ~Cluster,
    colors = colores_clusters,
    type = "scatter",
    mode = "markers",
    marker = list(
      size = 25,
      symbol = "star",
      line = list(width = 3, color = "white"),
      opacity = 1
    ),
    text = ~paste("<b>Centroide Cluster ", Cluster, "</b><br>",
                  nombres_clusters[as.character(Cluster)], "<br>",
                  "<b>Posición promedio del grupo</b>"),
    hovertemplate = '%{text}<extra></extra>',
    name = ~paste("Centroide ", nombres_clusters[as.character(Cluster)]),
    showlegend = TRUE
  ) %>%
  
  # Layout profesional para 1-2
  layout(
    title = list(
      text = "<b>ANÁLISIS DE CLUSTERS - DIMENSIONES 1 Y 2</b><br>",
      font = list(size = 20, color = "#2C5F8D", family = "Arial"),
      x = 0.05
    ),
    xaxis = list(
      title = paste0("<b>DIMENSIÓN 1</b><br>",
                    "Desarrollo Humano y Tecnológico<br>",
                    "(", round(resultado_ACP$dudi$eig[1]/sum(resultado_ACP$dudi$eig)*100, 1), "% varianza)"),
      zeroline = TRUE,
      zerolinecolor = "lightgray",
      gridcolor = "lightgray",
      showgrid = TRUE,
      titlefont = list(size = 14)
    ),
    yaxis = list(
      title = paste0("<b>DIMENSIÓN 2</b><br>",
                    "Modelo Económico-Institucional<br>",
                    "(", round(resultado_ACP$dudi$eig[2]/sum(resultado_ACP$dudi$eig)*100, 1), "% varianza)"),
      zeroline = TRUE,
      zerolinecolor = "lightgray",
      gridcolor = "lightgray",
      showgrid = TRUE,
      titlefont = list(size = 14)
    ),
    legend = list(
      title = list(text = "<b>CLUSTERS IDENTIFICADOS</b>", 
                  font = list(size = 14, color = "#2C5F8D")),
      bgcolor = "rgba(255,255,255,0.95)",
      bordercolor = "#2C5F8D",
      borderwidth = 2,
      x = 1.05,
      y = 0.5,
      xanchor = "left",
      yanchor = "middle",
      font = list(size = 12)
    ),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    margin = list(l = 80, r = 200, b = 80, t = 100),
    # Añadir anotaciones explicativas
    annotations = list(
      list(
        x = 0.02, y = 0.98, xref = "paper", yref = "paper",
        text = "💡 Pasa el cursor sobre los puntos para ver detalles",
        showarrow = FALSE,
        font = list(size = 12, color = "gray"),
        bgcolor = "rgba(255,255,255,0.8)",
        bordercolor = "gray"
      )
    )
  ) %>%
  
  # Añadir botones de animación
  layout(
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.1,
        y = 1.15,
        buttons = list(
          list(
            method = "restyle",
            args = list("marker.size", 8),
            label = "Tamaño Pequeño"
          ),
          list(
            method = "restyle",
            args = list("marker.size", 12),
            label = "Tamaño Normal"
          ),
          list(
            method = "restyle",
            args = list("marker.size", 16),
            label = "Tamaño Grande"
          )
        )
      )
    )
  )

# ========== GRÁFICA 2: DIMENSIONES 1-3 ==========

# Preparar datos para 1-3
datos_13 <- data.frame(
  Pais = coordenadas_paises$Pais,
  Comp1 = coordenadas_paises$Axis1,
  Comp2 = coordenadas_paises$Axis3,  # Cambiar a dimensión 3
  Cluster = coordenadas_paises$Cluster
)

# Calcular centroides para 1-3
centroides_13 <- datos_13 %>%
  group_by(Cluster) %>%
  summarise(
    Centroid1 = mean(Comp1),
    Centroid2 = mean(Comp2),
    .groups = 'drop'
  )

# Crear gráfica animada para 1-3
p_13_animado <- plot_ly() %>%
  
  # Añadir países con animación
  add_trace(
    data = datos_13,
    x = ~Comp1,
    y = ~Comp2,
    color = ~Cluster,
    colors = colores_clusters,
    text = ~paste("<b>", Pais, "</b><br>",
                  "<b>Cluster:</b> ", nombres_clusters[as.character(Cluster)], "<br>",
                  "<b>Dimensión 1:</b> ", round(Comp1, 3), "<br>",
                  "<b>Dimensión 3:</b> ", round(Comp2, 3)),
    type = "scatter",
    mode = "markers",
    marker = list(
      size = 12,
      opacity = 0.8,
      line = list(width = 2, color = "white")
    ),
    hovertemplate = '%{text}<extra></extra>',
    name = ~nombres_clusters[as.character(Cluster)],
    showlegend = TRUE
  ) %>%
  
  # Añadir centroides
  add_trace(
    data = centroides_13,
    x = ~Centroid1,
    y = ~Centroid2,
    color = ~Cluster,
    colors = colores_clusters,
    type = "scatter",
    mode = "markers",
    marker = list(
      size = 25,
      symbol = "diamond",
      line = list(width = 3, color = "white"),
      opacity = 1
    ),
    text = ~paste("<b>Centroide Cluster ", Cluster, "</b><br>",
                  nombres_clusters[as.character(Cluster)], "<br>",
                  "<b>Posición promedio del grupo</b>"),
    hovertemplate = '%{text}<extra></extra>',
    name = ~paste("Centroide ", nombres_clusters[as.character(Cluster)]),
    showlegend = TRUE
  ) %>%
  
  # Layout profesional para 1-3
  layout(
    title = list(
      text = "<b>ANÁLISIS DE CLUSTERS - DIMENSIONES 1 Y 3</b><br>",
      font = list(size = 20, color = "#2C5F8D", family = "Arial"),
      x = 0.05
    ),
    xaxis = list(
      title = paste0("<b>DIMENSIÓN 1</b><br>",
                    "Desarrollo Humano y Tecnológico<br>",
                    "(", round(resultado_ACP$dudi$eig[1]/sum(resultado_ACP$dudi$eig)*100, 1), "% varianza)"),
      zeroline = TRUE,
      zerolinecolor = "lightgray",
      gridcolor = "lightgray",
      showgrid = TRUE,
      titlefont = list(size = 14)
    ),
    yaxis = list(
      title = paste0("<b>DIMENSIÓN 3</b><br>",
                    "Integración Comercial Global<br>",
                    "(", round(resultado_ACP$dudi$eig[3]/sum(resultado_ACP$dudi$eig)*100, 1), "% varianza)"),
      zeroline = TRUE,
      zerolinecolor = "lightgray",
      gridcolor = "lightgray",
      showgrid = TRUE,
      titlefont = list(size = 14)
    ),
    legend = list(
      title = list(text = "<b>CLUSTERS IDENTIFICADOS</b>", 
                  font = list(size = 14, color = "#2C5F8D")),
      bgcolor = "rgba(255,255,255,0.95)",
      bordercolor = "#2C5F8D",
      borderwidth = 2,
      x = 1.05,
      y = 0.5,
      xanchor = "left",
      yanchor = "middle",
      font = list(size = 12)
    ),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    margin = list(l = 80, r = 200, b = 80, t = 100),
    annotations = list(
      list(
        x = 0.02, y = 0.98, xref = "paper", yref = "paper",
        text = "💡 Pasa el cursor sobre los puntos para ver detalles",
        showarrow = FALSE,
        font = list(size = 12, color = "gray"),
        bgcolor = "rgba(255,255,255,0.8)",
        bordercolor = "gray"
      )
    )
  )

# Mostrar ambas gráficas
p_12_animado
p_13_animado
```

```{r Grafico clusters}

# 2. Círculo de Correlaciones Interactivo
p2 <- fviz_pca_var(acp_result,
                   col.var = "contrib",
                   gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                   repel = TRUE,
                   title = "Círculo de Correlaciones - Contribución de Variables") +
  theme_minimal()

p2_interactive <- ggplotly(p2) %>%
  layout(
    title = list(
      text = "<b>Círculo de Correlaciones - Contribución de Variables</b>",
      x = 0.05
    )
  )

# 3. Países por Cluster - Componentes 1-2
p3 <- fviz_pca_ind(acp_result,
                   axes = c(1, 2),
                   geom.ind = "point",
                   col.ind = as.factor(NuevaBase$Cluster),
                   palette = c("#1f77b4", "#ff7f0e", "#2ca02c"),
                   addEllipses = TRUE,
                   ellipse.type = "convex",
                   ellipse.level = 0.95,
                   legend.title = "Cluster",
                   title = "Países por Cluster - Componentes 1-2") +
  theme_minimal()

p3_interactive <- ggplotly(p3) %>%
  layout(
    title = list(
      text = "<b>Países por Cluster - Componentes 1-2</b>",
      x = 0.05
    )
  )

# 4. Países por Cluster - Componentes 1-3
p4 <- fviz_pca_ind(acp_result,
                   axes = c(1, 3),
                   geom.ind = "point",
                   col.ind = as.factor(NuevaBase$Cluster),
                   palette = c("#1f77b4", "#ff7f0e", "#2ca02c"),
                   addEllipses = TRUE,
                   ellipse.type = "convex",
                   ellipse.level = 0.95,
                   legend.title = "Cluster",
                   title = "Países por Cluster - Componentes 1-3") +
  theme_minimal()

p4_interactive <- ggplotly(p4) %>%
  layout(
    title = list(
      text = "<b>Países por Cluster - Componentes 1-3</b>",
      x = 0.05
    )
  )

# Mostrar todas las gráficas
p1_interactive
p2_interactive
p3_interactive
p4_interactive

```


### Caracterizacion de los clusters


```{r Tabla de distribucion}
distribucion_clusters <- table(clusters_asignados) %>%
  as.data.frame() %>%
  rename(Cluster = clusters_asignados, Frecuencia = Freq) %>%
  mutate(Porcentaje = round(Frecuencia/sum(Frecuencia)*100, 2))

tabla_distribucion <- distribucion_clusters %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 12**"),
    subtitle = "Distribución de Países por Cluster"
  ) %>%
  cols_label(
    Cluster = md("**Cluster**"),
    Frecuencia = md("**N° Países**"),
    Porcentaje = md("**Porcentaje (%)**")
  ) %>%
  fmt_number(
    columns = Porcentaje,
    decimals = 1,
    pattern = "{x}%"
  ) %>%
  tab_options(
    table.font.names = "Times New Roman"
  )

tabla_distribucion

```


```{r descriptivas clusters}
estadisticas_clusters <- NuevaBase %>%
  group_by(Cluster) %>%
  summarise(across(
    where(is.numeric),
    list(
      Media = ~round(mean(., na.rm = TRUE), 2),
      DE = ~round(sd(., na.rm = TRUE), 2),
      Min = ~round(min(., na.rm = TRUE), 2),
      Max = ~round(max(., na.rm = TRUE), 2),
      Rango = ~round(max(., na.rm = TRUE) - min(., na.rm = TRUE), 2)
    )
  )) %>%
  pivot_longer(
    cols = -Cluster,
    names_to = "Variable_Estadistica",
    values_to = "Valor"
  ) %>%
  separate(Variable_Estadistica, into = c("Variable", "Estadistica"), sep = "_") %>%
  pivot_wider(
    names_from = Estadistica,
    values_from = Valor
  )

nombres_variables <- c(
  "PIB_per" = "PIB per cápita (US$)",
  "Poblacion" = "Población total",
  "Esperanza.vida" = "Esperanza de vida (años)",
  "Acceso.electricidad" = "Acceso electricidad (%)",
  "Area.boscosa" = "Área boscosa (%)",
  "Suscripciones.movil" = "Suscripciones móviles",
  "Crecimiento.PIB" = "Crecimiento PIB (%)",
  "Mortalidad.infantil" = "Mortalidad infantil",
  "Inversion.extranjera" = "Inversión extranjera (%)",
  "Gasto.salud" = "Gasto en salud (%)",
  "Uso.internet" = "Uso de internet (%)",
  "Importaciones" = "Importaciones (%)",
  "Exportaciones" = "Exportaciones (%)",
  "Tierra.cultivable" = "Tierra cultivable (%)",
  "Crecimiento.poblacion" = "Crecimiento población (%)",
  "Industria" = "Industria (%)",
  "Remesas" = "Remesas (%)"
)

# Tabla principal de estadísticas por cluster
tabla_estadisticas <- estadisticas_clusters %>%
  mutate(
    Variable_Descriptiva = nombres_variables[Variable],
    Cluster = paste("Cluster", Cluster)
  ) %>%
  select(Cluster, Variable_Descriptiva, Media, DE, Min, Max, Rango) %>%
  arrange(Cluster, Variable_Descriptiva) %>%
  gt(groupname_col = "Cluster") %>%
  tab_header(
    title = md("**ESTADÍSTICAS DESCRIPTIVAS POR CLUSTER**"),
    subtitle = "Medias, desviaciones estándar y rangos de las variables originales"
  ) %>%
  cols_label(
    Variable_Descriptiva = md("**Variable**"),
    Media = md("**Media**"),
    DE = md("**D.E.**"),
    Min = md("**Mín**"),
    Max = md("**Máx**"),
    Rango = md("**Rango**")
  ) %>%
  cols_align(
    align = "center",
    columns = c(Media, DE, Min, Max, Rango)
  ) %>%
  cols_align(
    align = "left",
    columns = Variable_Descriptiva
  ) %>%
  fmt_number(
    columns = c(Media, DE, Min, Max, Rango),
    decimals = 2
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable_Descriptiva, Media, DE, Min, Max))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Variable_Descriptiva)
  ) %>%
  tab_style(
    style = cell_fill(color = "#F0F8FF"),
    locations = cells_row_groups()
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(6),
    heading.title.font.size = 16,
    heading.subtitle.font.size = 14,
    heading.padding = px(8),
    footnotes.padding = px(6)
  ) %>%
  tab_source_note(
    source_note = md("**Fuente:** Elaboración propia con base en World Bank (2023)")
  )

# Mostrar tabla principal
tabla_estadisticas


```



### Segmentos de paises

```{r segmentacion}
clusters <- cutree(hc, k = 3)

cluster_df <- data.frame(
  Pais = rownames(coordenadas_pca),
  Dim1 = coordenadas_pca$Axis1,
  Dim2 = coordenadas_pca$Axis2,
  Dim3 = coordenadas_pca$Axis3,
  Dim4 = coordenadas_pca$Axis4,
  Cluster = as.factor(clusters)
)


cluster_plot <- plot_ly(cluster_df,
                        x = ~Dim1, 
                        y = ~Dim2,
                        color = ~Cluster,
                        colors = c("red", "#00AFBB", "#E7B800"),
                        text = ~paste("<b>", Pais, "</b><br>",
                                      "Cluster:", Cluster),
                        type = "scatter",
                        mode = "markers",
                        marker = list(size = 10, opacity = 0.8),
                        hovertemplate = '%{text}<extra></extra>') %>%
  layout(
    title = list(
      text = "<b>Clusters en el Espacio de Componentes Principales</b>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 1"),
    yaxis = list(title = "Dimensión 2"),
    hovermode = "closest"
  )

cluster_plot

cluster_plot1 <- plot_ly(cluster_df,
                        x = ~Dim3, 
                        y = ~Dim4,
                        color = ~Cluster,
                        colors = c("red", "#00AFBB", "#E7B800"),
                        text = ~paste("<b>", Pais, "</b><br>",
                                      "Cluster:", Cluster),
                        type = "scatter",
                        mode = "markers",
                        marker = list(size = 10, opacity = 0.8),
                        hovertemplate = '%{text}<extra></extra>') %>%
  layout(
    title = list(
      text = "<b>Clusters en el Espacio de Componentes Principales</b>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensión 3"),
    yaxis = list(title = "Dimensión 4"),
    hovermode = "closest"
  )

cluster_plot1

resumen_clusters <- cluster_df %>%
  group_by(Cluster) %>%
  summarise(
    Cantidad_Paises = n(),
    Porcentaje = round(n() / nrow(cluster_df) * 100, 1),
    Paises_Ejemplo = paste(head(Pais, 5), collapse = ", "),
    .groups = 'drop'
  ) %>%
  gt() %>%
  tab_header(
    title = md("**Resumen de Clusters Identificados**"),
    subtitle = "Agrupamiento jerárquico con método Ward"
  ) %>%
  cols_label(
    Cluster = md("**Cluster**"),
    Cantidad_Paises = md("**N° Países**"),
    Porcentaje = md("**%**"),
    Paises_Ejemplo = md("**Países Representativos**")
  ) %>%
  fmt_number(
    columns = Porcentaje,
    decimals = 1,
    pattern = "{x}%"
  ) %>%
  tab_options(
    table.font.names = "Times New Roman"
  )

resumen_clusters
```

```{r Mapa }
world <- ne_countries(scale = "medium", returnclass = "sf")

Base_2022_con_cluster <- Base_2022 %>%
  mutate(Cluster = clusters) %>%  
  select(Codigo, Cluster, Pais)   
Base_con_mapa <- world %>%
  left_join(Base_2022_con_cluster, by = c("iso_a3" = "Codigo")) %>%
  filter(!is.na(Cluster))  

nombres_clusters <- c("1" = "Desarrollado", "2" = "Emergente", "3" = "Subdesarrollado")


pal <- colorFactor(palette = c("#2C5F8D", "#27AE60", "#8E44AD"), domain = 1:3)
leaflet(Base_con_mapa) %>%
  addTiles() %>%  
  addPolygons(fillColor = ~pal(Cluster), weight = 1, opacity = 1,
              color = "white", fillOpacity = 0.7,
              popup = ~paste("País:", Pais, "<br>Clúster:", nombres_clusters[as.character(Cluster)]))  
```


## Resultados e interpletacion

### Caracterizacion de los componentes principales

#### Componente Principal 1: "Desarrollo Humano y Conectividad Digital" (24.3% de varianza)

El primer componente principal explica casi un cuarto de toda la variabilidad en desarrollo internacional, capturando la dimensión más fundamental que diferencia a países ricos de pobres. Se define por esperanza de vida (loading: 0.413), uso de internet (0.4126), acceso a electricidad (0.3709) contrapuestos a mortalidad infantil (-0.4083). Estas variables covarían porque todas requieren sistemas de salud consolidados, riqueza económica, infraestructura tecnológica y estabilidad política—es decir, reflejan la capacidad institucional de una sociedad para garantizar bienestar multidimensional. Países que han logrado esperanzas de vida de 80+ años han realizado décadas de inversión en salud pública, educación universal y desarrollo económico; simultáneamente, estos mismos países inevitablemente desarrollaron infraestructuras digitales avanzadas porque sus economías postindustriales dependen de servicios e innovación tecnológica.

San Marino lidera el extremo positivo de PC1 con coordenada 4.609, siendo una micro-república de 34,000 habitantes enclavada en Italia con esperanza de vida de ~85 años, PIB per cápita superior a $50,000 USD, mortalidad infantil menor a 5 por 1,000, y acceso digital prácticamente universal. Malta (3.608) es otro micro-Estado mediterráneo con esperanza de vida de ~83 años que transitó desde economía agraria a hub financiero y tecnológico. Irlanda (3.457) representa el "milagro celta" que transformó una economía de subsistencia agraria en los 1950s hacia hub tecnológico global con esperanza de vida de ~82 años. Suiza (3.444) y Noruega (2.913) completan el quinteto de élite con sus sistemas de salud universales, educación de calidad, estabilidad política, y economías basadas en servicios financieros, manufactura de precisión, tecnología y recursos petroleros.

En el extremo opuesto, Níger encabeza con coordenada -5.599, siendo un país saheliano sin salida al mar donde 85% del territorio es desierto del Sahara, con esperanza de vida apenas de 62 años, mortalidad infantil de 85 por 1,000, uso de internet inferior a 10%, y acceso a electricidad de apenas 18%. Burundi (-4.797), una pequeña nación densamente poblada devastada por conflictos étnicos, muestra esperanza de vida de 61 años y PIB per cápita de apenas $270 USD. República Democrática del Congo (-4.619) posee recursos naturales valorados en trillones de dólares pero permanece atrapada en pobreza extrema debido a conflictos armados recurrentes y corrupción sistémica, resultando en esperanza de vida de 60 años, mortalidad infantil de 68 por 1,000, y acceso a electricidad inferior a 20%. Sierra Leona (-4.406) y Madagascar (-4.393) completan este quinteto de vulnerabilidad extrema, compartiendo fragilidad institucional, dependencia de agricultura de subsistencia y sistemas de salud colapsados. La brecha cuantitativa es asombrosa: 30 años de diferencia en esperanza de vida, mortalidad infantil 17 veces mayor, acceso digital multiplicado por 10, y riqueza económica 200 veces inferior entre los extremos (Banco Mundial, 2023; PNUD, 2023).

#### Componente Principal 2: "Modelo Económico-Institucional" (13.5% de varianza)
El segundo componente, ortogonal al primero, captura una dimensión más sutil: la estructura económica independiente del nivel absoluto de riqueza. Se define por industria negativa (-0.5145, cos²: 0.2648), crecimiento poblacional negativo (-0.4365, cos²: 0.1906), contrapuestos a remesas (0.3465, cos²: 0.12), gasto en salud (0.3038, cos²: 0.0923), importaciones (0.2842, cos²: 0.0808) y tierra cultivable (0.2415, cos²: 0.0583). Esta estructura revela un contraste profundo: el extremo negativo representa economías industrializadas maduras que han completado transiciones demográficas con capacidad productiva autónoma; el extremo positivo representa economías pequeñas vulnerables dependientes de transferencias externas de población emigrada.

Qatar encabeza el extremo negativo con coordenada -5.768 como pequeño emirato con población de 2.9 millones (90% migrantes temporales) donde la industria petrolera representa 66% del PIB, generando PIB per cápita de ~$61,000 USD a través de extracción de gas natural licuado. Kuwait (-5.102) y Arabia Saudita (-4.487) presentan patrones similares de economías extractivas con industria petroquímica representando 50-70% del PIB, crecimiento poblacional controlado artificialmente mediante políticas migratorias restrictivas, y no reciben remesas porque funcionan como exportadores netos de trabajadores. Omán (-4.455) e Iraq (-3.224), a pesar de la inestabilidad que afecta a Iraq, mantienen industria petrolera significativa que define sus estructuras económicas.

En el extremo opuesto, Islas Marshall lideran con coordenada 4.210, siendo micro-nación insular del Pacífico con población de 60,000 habitantes donde casi 30% de los marshaleses viven en Estados Unidos, enviando remesas que representan 15-20% del PIB doméstico. Tonga (3.513), pequeña nación polinesia, tiene aproximadamente 50% de sus ciudadanos viviendo en el exterior, generando remesas que constituyen 40% de su PIB—la proporción más alta del mundo. Moldavia (3.041), antigua república soviética sin salida al mar, es una de las naciones más pobres de Europa donde ~25% de su población trabaja en Rusia o Italia, con remesas representando 16% del PIB como principal fuente de divisas. Samoa (2.898) y Líbano (2.750) completan este grupo dependiente de transferencias externas: Samoa recibe remesas principalmente de Australia y Nueva Zelanda, mientras Líbano, devastado por crisis financiera y explosiones, depende críticamente de remesas de su diáspora global (~$7 mil millones anuales, representando 15% del PIB). Este componente revela una paradoja fascinante: no todos los países ricos dependen de industrialización, y no todos los países dependientes de transferencias son pobres—reflejando que distintos modelos institucionales pueden coexistir con diferentes resultados de desarrollo (Banco Mundial, 2023; FMI, 2023).

#### Componente Principal 3: "Integración Comercial Global" (9.1% de varianza)
El tercer componente captura la dimensión de apertura e integración en cadenas globales de valor, definida por importaciones (0.5187, cos²: 0.269), exportaciones (0.5084, cos²: 0.2584), inversión extranjera directa (0.3714, cos²: 0.138) y crecimiento del PIB (0.2562, cos²: 0.0657) positivos, contrapuestos a área boscosa (-0.273, cos²: 0.0745) y población (-0.263, cos²: 0.0692) negativos. Esta estructura refleja que la globalización contemporánea ha permitido que economías pequeñas adopten estrategias de hiperespecialización e hiperaperrura insertándose en nichos de cadenas globales, mientras que economías continentales grandes pueden mantener mayor autosuficiencia porque sus mercados internos masivos absorben la mayor parte de la producción doméstica.

Malta lidera el extremo positivo con la coordenada más extrema de todos los componentes (7.072), siendo archipiélago mediterráneo de 500 km² con 530,000 habitantes donde importaciones representan 120% del PIB y exportaciones 140%, sumando comercio total superior a 260% del PIB. Malta funciona como hub financiero offshore, centro de servicios digitales (iGaming, blockchain), y base logística para comercio regional, con inversión extranjera directa representando ~15% del PIB anualmente. Djibouti (5.246), pequeño país del Cuerno de África sin recursos naturales significativos pero posicionado estratégicamente en el Mar Rojo, maneja 95% del comercio exterior de Etiopía (población: 120 millones sin salida al mar), con importaciones y exportaciones combinadas superando 100% del PIB djiboutiano e ingresos de ~$200 millones anuales de alquiler de bases militares. San Marino (4.819) e Irlanda (2.588) completan el extremo de hiperglobalización: San Marino con comercio total >300% PIB, Irlanda como hub tecnológico y farmacéutico con exportaciones >100% PIB.

En el extremo negativo, China encabeza con coordenada -3.651 a pesar de ser la "fábrica del mundo" y mayor exportador global en términos absolutos ($3.6 billones USD en 2022), porque su economía es tan masiva ($17.9 billones USD) que el comercio total representa apenas 37% del PIB. India (-2.453), a pesar de exportaciones de ~$770 mil millones USD, tiene comercio exterior representando apenas 22% de su PIB de $3.5 billones. Federación Rusa (-2.560), aunque es gran exportadora de petróleo, gas y armamento, tiene comercio total de ~45% del PIB porque su economía continental es relativamente autárquica. Este componente revela la paradoja fundamental de la globalización: los más globalizados son los más pequeños y vulnerables; los más grandes pueden permitirse mayor independencia comercial (Baldwin, 2016; Rodrik, 2011).

#### Componente Principal 4: "Presión Territorial y Recursos Naturales" (7.5% de varianza)
El cuarto componente captura el trade-off fundamental entre conservación ambiental y expansión agrícola, definido por área boscosa (0.5134, cos²: 0.2635) positiva, contrapuesta a tierra cultivable (-0.5539, cos²: 0.3068) y población (-0.4713, cos²: 0.2221) negativas. El extremo positivo representa países con ecosistemas naturales preservados y baja presión demográfica; el extremo negativo representa países con presión demográfica masiva que ha forzado sacrificar bosques por tierra agrícola para seguridad alimentaria.

Timor-Leste encabeza el extremo positivo con coordenada 3.921, siendo joven nación independiente donde ~70% del territorio es bosque tropical montañoso con agricultura limitada a ~10% debido a escarpado terreno, población pequeña (~1.3 millones) y presión demográfica moderada. Finlandia (1.736) también en este extremo tiene ~73% de cobertura boscosa boreal, uno de los porcentajes más altos de Europa, con población de apenas 5.5 millones en territorio de 338,000 km². Islas Salomón (2.273) y República del Congo (2.259) tienen cobertura boscosa de ~80% y ~65% respectivamente, manteniéndola debido a baja densidad poblacional relativa.

India lidera el extremo negativo con coordenada -5.813, teniendo 1,400 millones de habitantes en 3.3 millones de km² (densidad: ~420 hab/km²), lo que ha convertido ~60% del territorio en tierra cultivable para arroz, trigo, algodón, caña de azúcar, reduciendo bosques a apenas 23%. China (-3.891) y Bangladesh (-3.049) presentan patrones similares: Bangladesh tiene densidad de ~1,250 hab/km² con ~70% tierra cultivable y bosques reducidos a 11%; China, aunque menos densamente poblada (~145 hab/km²), tiene 1,400 millones de habitantes que han transformado casi toda tierra disponible en agricultura intensiva. Este componente revela el dilema del desarrollo: presión demográfica extrema obliga sacrificar ecosistemas naturales por seguridad alimentaria; solo países con baja densidad pueden permitirse preservar naturaleza (Banco Mundial, 2023).


```{r caracterizacion }
caracterizacion_componentes <- data.frame(
  Componente = c("PC1", "PC2", "PC3", "PC4"),
  Nombre = c("Desarrollo Humano y Conectividad Digital", 
             "Modelo Económico-Institucional", 
             "Integración Comercial Global", 
             "Presión Territorial y Recursos Naturales"),
  Varianza_Explicada = c("24.3%", "13.5%", "9.1%", "7.5%"),
  Variables_Positivas = c(
    "Esperanza de vida (0.413), Uso de internet (0.4126), Acceso a electricidad (0.3709)",
    "Remesas (0.3465), Gasto en salud (0.3038), Importaciones (0.2842), Tierra cultivable (0.2415)",
    "Importaciones (0.5187), Exportaciones (0.5084), Inversión extranjera (0.3714), Crecimiento PIB (0.2562)",
    "Área boscosa (0.5134)"
  ),
  Variables_Negativas = c(
    "Mortalidad infantil (-0.4083)",
    "Industria (-0.5145), Crecimiento poblacional (-0.4365)",
    "Área boscosa (-0.273), Población (-0.263)",
    "Tierra cultivable (-0.5539), Población (-0.4713)"
  ),
  Interpretación = c(
    "Países desarrollados con alta esperanza de vida, conectividad digital e infraestructura vs países en desarrollo con sistemas sanitarios frágiles",
    "Economías industriales maduras vs economías dependientes de transferencias externas y remesas",
    "Economías pequeñas ultra-abiertas (hubs comerciales) vs economías grandes con mercados internos dominantes",
    "Países con ecosistemas preservados vs países con alta presión agrícola y demográfica"
  )
)

tabla_componentes <- caracterizacion_componentes %>%
  gt() %>%
  tab_header(
    title = md("**Caracterización de Componentes Principales**"),
    subtitle = "Análisis de componentes principales de indicadores de desarrollo global"
  ) %>%
  cols_label(
    Componente = md("**Comp.**"),
    Nombre = md("**Dimensión Identificada**"),
    Varianza_Explicada = md("**% Varianza**"),
    Variables_Positivas = md("**Variables Positivas**"),
    Variables_Negativas = md("**Variables Negativas**"),
    Interpretación = md("**Interpretación Conceptual**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = c(Componente, Nombre))
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Variables_Positivas, Variables_Negativas, Interpretación))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuente:** Elaboración propia con base en análisis PCA de indicadores globales (Banco Mundial, PNUD, FMI)")
  )

tabla_componentes
```


### Prediccion

Tras construir el modelo ACP con aproximadamente 180 países de entrenamiento, se proyectaron cinco países adicionales (Angola, Belice, Jordania, Luxemburgo, Uruguay) sobre el espacio factorial ya definido. La proyección utiliza las medias y varianzas del conjunto de entrenamiento para estandarizar los nuevos datos, evitando que cambien la estructura de componentes. Se calcularon las coordenadas de estos cinco países en los cuatro primeros componentes principales, cuantificando su posición relativa respecto al espacio multidimensional de desarrollo ya identificado (Hastie et al., 2009).

```{r Prediccion}

Prediccion <- read_csv("f36a5086-3311-4b1a-9f0c-bda5cd4718df_Series - Metadata.csv",
                 show_col_types = FALSE) %>%
  select(
    Pais = `Country Name`,
    Codigo = `Country Code`,
    PIB_per = `GDP per capita (current US$) [NY.GDP.PCAP.CD]`,
    Poblacion = `Population, total [SP.POP.TOTL]`,
    `Esperanza vida` = `Life expectancy at birth, total (years) [SP.DYN.LE00.IN]`,
    `Acceso electricidad` = `Access to electricity (% of population) [EG.ELC.ACCS.ZS]`,
    `Area boscosa` = `Forest area (% of land area) [AG.LND.FRST.ZS]`,
    `Suscripciones movil` = `Mobile cellular subscriptions (per 100 people) [IT.CEL.SETS.P2]`,
    `Crecimiento PIB` = `GDP growth (annual %) [NY.GDP.MKTP.KD.ZG]`,
    `Mortalidad infantil` = `Mortality rate, infant (per 1,000 live births) [SP.DYN.IMRT.IN]`,
    `Inversion extranjera` = `Foreign direct investment, net inflows (% of GDP) [BX.KLT.DINV.WD.GD.ZS]`,
    `Gasto salud` = `Current health expenditure (% of GDP) [SH.XPD.CHEX.GD.ZS]`,
    `Uso internet` = `Individuals using the Internet (% of population) [IT.NET.USER.ZS]`,
    Importaciones = `Imports of goods and services (% of GDP) [NE.IMP.GNFS.ZS]`,
    Exportaciones = `Exports of goods and services (% of GDP) [NE.EXP.GNFS.ZS]`,
    `Tierra cultivable` = `Arable land (% of land area) [AG.LND.ARBL.ZS]`,
    `Crecimiento poblacion` = `Population growth (annual %) [SP.POP.GROW]`,
    Industria = `Industry (including construction), value added (% of GDP) [NV.IND.TOTL.ZS]`,
    Remesas = `Personal remittances, received (% of GDP) [BX.TRF.PWKR.DT.GD.ZS]`
  ) %>%
  filter(Pais %in% c("Uruguay","Belize","Luxembourg","Jordan","Angola"))

ind.test <- Prediccion[, 3:19] %>%
  mutate(across(everything(), as.numeric))


ind.test_clean <- ind.test %>%
  mutate(across(everything(), ~ifelse(is.na(.), mean(., na.rm = TRUE), .)))

ind.test.coord <- predict(res.pca, newdata = ind.test_clean)
coordenadas_paises <- data.frame(
  País = Prediccion$Pais,
  `Código País` = Prediccion$Codigo,
  `Dimensión 1 - Desarrollo Humano` = round(ind.test.coord[, 1], 4),
  `Dimensión 2 - Industrialización` = round(ind.test.coord[, 2], 4),
  `Dimensión 3 - Apertura Comercial` = round(ind.test.coord[, 3], 4),
  `Dimensión 4 - Recursos Naturales` = round(ind.test.coord[, 4], 4)
)


tabla_coordenadas <- coordenadas_paises %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 3: Coordenadas de Países en Componentes Principales**"),
    subtitle = "Proyección de países seleccionados en las cuatro dimensiones del Análisis de Componentes Principales"
  ) %>%
  cols_label(
    País = md("**País**"),
    `Código.País` = md("**Código**"),
    `Dimensión.1...Desarrollo.Humano` = md("**Dimensión 1**"),
    `Dimensión.2...Industrialización` = md("**Dimensión 2**"),
    `Dimensión.3...Apertura.Comercial` = md("**Dimensión 3**"),
    `Dimensión.4...Recursos.Naturales` = md("**Dimensión 4**")
  ) %>%
  cols_align(
    align = "center",
    columns = c(`Dimensión.1...Desarrollo.Humano`, `Dimensión.2...Industrialización`,
                `Dimensión.3...Apertura.Comercial`, `Dimensión.4...Recursos.Naturales`)
  ) %>%
  cols_align(
    align = "left",
    columns = c(País, `Código.País`)
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(País, `Código.País`, `Dimensión.1...Desarrollo.Humano`, 
                                       `Dimensión.2...Industrialización`, `Dimensión.3...Apertura.Comercial`))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = País)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(`Código.País`, `Dimensión.1...Desarrollo.Humano`,
                                       `Dimensión.2...Industrialización`, `Dimensión.3...Apertura.Comercial`,
                                       `Dimensión.4...Recursos.Naturales`))
  ) %>%
  tab_options(
    table.font.names = "Times New Roman",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuente:** Elaboración propia con base en proyección ACP de indicadores del World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Dimensión 1: Desarrollo Humano y Tecnológico (24.3% varianza) | Dimensión 2: Industrialización y Dinámica Demográfica (13.5% varianza)",
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_footnote(
    footnote = "Dimensión 3: Apertura e Integración Comercial (9.1% varianza) | Dimensión 4: Base Territorial y Recursos Naturales (7.5% varianza)",
    locations = cells_title(groups = "subtitle")
  )

tabla_coordenadas

library(plotly)
coordenadas_originales <- as.data.frame(res.pca$x)
coordenadas_originales$Pais <- rownames(coordenadas_originales)
coordenadas_originales$Tipo <- "Original"

# Las coordenadas de los países predichos ya están en ind.test.coord
coordenadas_predichas <- as.data.frame(ind.test.coord)
coordenadas_predichas$Pais <- Prediccion$Pais
coordenadas_predichas$Tipo <- "Predicho"

# Renombrar las columnas para que coincidan
colnames(coordenadas_originales)[1:4] <- c("PC1", "PC2", "PC3", "PC4")
colnames(coordenadas_predichas)[1:4] <- c("PC1", "PC2", "PC3", "PC4")

# Combinar los datos
datos_completos <- rbind(
  coordenadas_originales[, c("Pais", "PC1", "PC2", "Tipo")],
  coordenadas_predichas[, c("Pais", "PC1", "PC2", "Tipo")]
)

# Crear el gráfico plotly SIN nombres visibles
p_animado <- plot_ly() %>%
  
  # Países originales (solo puntos, sin texto)
  add_trace(
    data = datos_completos[datos_completos$Tipo == "Original", ],
    x = ~PC1, y = ~PC2,
    type = 'scatter',
    mode = 'markers',
    marker = list(
      color = 'black',
      size = 8,
      opacity = 0.7,
      line = list(width = 1, color = 'white')
    ),
    name = "Países originales",
    hoverinfo = 'text',
    hovertext = ~paste("<b>", Pais, "</b><br>",
                       "Tipo: Original<br>",
                       "Dimensión 1: ", round(PC1, 3), "<br>",
                       "Dimensión 2: ", round(PC2, 3))
  ) %>%
  
  # Países predichos (solo puntos, sin texto)
  add_trace(
    data = datos_completos[datos_completos$Tipo == "Predicho", ],
    x = ~PC1, y = ~PC2,
    type = 'scatter',
    mode = 'markers',
    marker = list(
      color = 'blue',
      size = 12,
      opacity = 0.8,
      symbol = 'star',
      line = list(width = 1.5, color = 'white')
    ),
    name = "Países predichos",
    hoverinfo = 'text',
    hovertext = ~paste("<b>", Pais, "</b><br>",
                       "Tipo: Predicho<br>",
                       "Dimensión 1: ", round(PC1, 3), "<br>",
                       "Dimensión 2: ", round(PC2, 3)),
    visible = FALSE  # Inicialmente ocultos
  ) %>%
  
  layout(
    title = list(
      text = "<b>PCA - Países originales (negro) y países predichos (azul)</b>",
      x = 0.05,
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(
      title = "Dimensión 1 - Desarrollo Humano y Tecnológico (24.3%)",
      zeroline = TRUE,
      zerolinecolor = "gray",
      gridcolor = "lightgray"
    ),
    yaxis = list(
      title = "Dimensión 2 - Modelo Económico-Institucional (13.5%)",
      zeroline = TRUE,
      zerolinecolor = "gray",
      gridcolor = "lightgray"
    ),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    showlegend = TRUE,
    legend = list(
      x = 0.02,
      y = 0.98,
      bgcolor = "rgba(255,255,255,0.8)"
    ),
    annotations = list(
      list(
        x = 0.5,
        y = -0.15,
        text = "● Países originales | ★ Países predichos • Pasa el cursor sobre los puntos para ver información",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        font = list(size = 12, color = "gray")
      )
    )
  ) %>%
  
  # Configurar animación con botones
  layout(
    updatemenus = list(
      list(
        type = "buttons",
        direction = "right",
        x = 0.1,
        y = 1.15,
        buttons = list(
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, FALSE)),
              list(title = "PCA - Solo países originales")
            ),
            label = "Solo Originales"
          ),
          list(
            method = "update",
            args = list(
              list(visible = c(TRUE, TRUE)),
              list(title = "PCA - Países originales (negro) y países predichos (azul)")
            ),
            label = "Mostrar Predichos"
          )
        )
      )
    )
  )

# Mostrar el gráfico
p_animado

```
 Luxemburgo obtiene coordenada 2.9075 en PC1 (desarrollo extremo), junto a San Marino en la élite ultra-desarrollada, confirmando su posición como micro-Estado financiero con esperanza de vida de 85 años e hiperconectividad digital. Uruguay (1.4145 en PC1) se posiciona como país emergente latinoamericano con desarrollo humano consolidado. Jordania (0.1673) y Belice (-0.4472) son casos intermedios de ingresos medios con vulnerabilidades persistentes. Angola (-3.6127) lidera el rezago extremo, caracterizada por baja esperanza de vida (61 años), alta mortalidad infantil (56 por 1,000) y acceso limitado a servicios. En Dimensión 2, Luxemburgo (-1.0540) representa industrialización postindustrial consolidada; Angola (-1.7126) representa industrialización petroquímica sin beneficios distributivos. En Dimensión 3, Luxemburgo (-7.6090) es hiperglobalizado (comercio >300% PIB); Angola (-0.1232) es básicamente cerrada con dependencia petrolera. En Dimensión 4, Luxemburgo (4.9379) tiene escasa presión demográfica; Angola (1.7885) tiene tierra cultivable disponible pero sin transformación agrícola.

# Bibliografia
