---
title: "An√°lisis de Componentes Principales y Clusterizaci√≥n de Pa√≠ses"
subtitle: "Aplicaci√≥n de T√©cnicas de Aprendizaje No Supervisado con Datos del Banco Mundial"
author: "Barros Rayo Alejandro (2415837), Mu√±oz Portela Diego Fernando (2415620), Portilla Aguirre Johan Camilo (2422468), Aguirre Aldana Joan Sebastian (2419550)"
date: "`r format(Sys.Date(), '%d de %B de %Y')`"
output: 
  html_document:
    theme: darkly
    highlight: kate
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    toc_depth: 3
    number_sections: true
    code_folding: show
    df_print: paged
---

```{=html}
<style type="text/css">
/* ========== PALETA DE COLORES CYBER ========== */
:root {
  --bg-black: #000000;
  --bg-dark: #0a0e1a;
  --bg-card: #12161f;
  --bg-sidebar: #0d1117;
  --accent-cyan: #00e5ff;
  --accent-blue: #0084ff;
  --accent-purple: #a259ff;
  --text-white: #ffffff;
  --text-light: #e0e6ed;
  --text-gray: #8b92a0;
  --border-glow: rgba(0, 229, 255, 0.4);
  --sidebar-width: 280px;
  --right-toc-width: 240px;
}

/* ========== RESET ========== */
* {
  box-sizing: border-box !important;
  margin: 0;
  padding: 0;
}

html, body {
  background: var(--bg-black) !important;
  color: var(--text-light) !important;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
  line-height: 1.7 !important;
  overflow-x: hidden !important;
  height: 100% !important;
}

/* ========== ESTRUCTURA PRINCIPAL - SIN HUECOS ========== */
.main-container {
  max-width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
  padding-left: var(--sidebar-width) !important;
  padding-right: var(--right-toc-width) !important;
  background: var(--bg-black) !important;
  min-height: 100vh !important;
}

/* ========== TOC IZQUIERDO - SIN FONDO GRIS ========== */
#TOC {
  background: transparent !important;
  border-right: 1px solid rgba(0, 229, 255, 0.15) !important;
  padding: 30px 20px 100px 20px !important;
  position: fixed !important;
  left: 0 !important;
  top: 0 !important;
  width: var(--sidebar-width) !important;
  height: 100vh !important;
  overflow-y: auto !important;
  overflow-x: hidden !important;
  z-index: 1000 !important;
  box-shadow: 2px 0 20px rgba(0, 0, 0, 0.5) !important;
}

#TOC::-webkit-scrollbar {
  width: 6px !important;
}

#TOC::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3) !important;
}

#TOC::-webkit-scrollbar-thumb {
  background: var(--accent-cyan) !important;
  border-radius: 3px !important;
  box-shadow: 0 0 10px rgba(0, 229, 255, 0.5) !important;
}

#TOC::before {
  content: " CONTENIDO" !important;
  display: block !important;
  font-size: 1.1em !important;
  font-weight: 700 !important;
  color: var(--accent-cyan) !important;
  text-transform: uppercase !important;
  letter-spacing: 2px !important;
  padding-bottom: 15px !important;
  margin-bottom: 25px !important;
  border-bottom: 2px solid rgba(0, 229, 255, 0.3) !important;
  text-align: center !important;
  text-shadow: 0 0 15px rgba(0, 229, 255, 0.5) !important;
}

/* ========== ENLACES TOC IZQUIERDO - SIN CUADROS GRISES ========== */
#TOC ul {
  list-style: none !important;
  padding: 0 !important;
  margin: 0 !important;
}

#TOC li {
  margin: 4px 0 !important;
  background: transparent !important;
}

#TOC a {
  color: var(--text-gray) !important;
  text-decoration: none !important;
  font-size: 0.9em !important;
  display: block !important;
  padding: 10px 15px !important;
  border-left: 3px solid transparent !important;
  transition: all 0.3s ease !important;
  background: transparent !important;
  border-radius: 0 !important;
}

#TOC a:hover {
  color: var(--accent-cyan) !important;
  border-left: 3px solid var(--accent-cyan) !important;
  transform: translateX(5px) !important;
  background: transparent !important;
}

#TOC a.active {
  color: var(--accent-cyan) !important;
  background: transparent !important;
  border-left: 3px solid var(--accent-cyan) !important;
  font-weight: 700 !important;
}

#TOC .toc-section-number {
  color: var(--accent-cyan) !important;
  font-weight: 700 !important;
  margin-right: 8px !important;
  display: inline-block !important;
  min-width: 25px !important;
}

#TOC ul ul {
  padding-left: 20px !important;
  margin-top: 6px !important;
  border-left: 1px solid rgba(0, 229, 255, 0.1) !important;
  margin-left: 15px !important;
}

#TOC ul ul a {
  font-size: 0.85em !important;
  padding: 8px 12px !important;
}

/* ========== BOT√ìN CONTROL DE C√ìDIGO - LADO DERECHO ========== */
#global-code-toggle {
  position: fixed !important;
  bottom: 30px !important;
  right: calc(var(--right-toc-width) + 30px) !important;
  z-index: 10000 !important;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue)) !important;
  color: var(--bg-black) !important;
  border: none !important;
  padding: 14px 28px !important;
  border-radius: 50px !important;
  font-weight: 700 !important;
  font-size: 0.9em !important;
  cursor: pointer !important;
  box-shadow: 0 6px 25px rgba(0, 229, 255, 0.5) !important;
  transition: all 0.3s ease !important;
  text-transform: uppercase !important;
  letter-spacing: 1px !important;
}

#global-code-toggle:hover {
  transform: translateY(-3px) !important;
  box-shadow: 0 8px 35px rgba(0, 229, 255, 0.7) !important;
}

/* ========== MINI-TOC DERECHO ========== */
#right-toc {
  position: fixed !important;
  right: 0 !important;
  top: 0 !important;
  width: var(--right-toc-width) !important;
  height: 100vh !important;
  background: transparent !important;
  border-left: 1px solid rgba(162, 89, 255, 0.15) !important;
  padding: 30px 20px !important;
  overflow-y: auto !important;
  z-index: 999 !important;
  box-shadow: -2px 0 20px rgba(0, 0, 0, 0.5) !important;
}

#right-toc::-webkit-scrollbar {
  width: 4px !important;
}

#right-toc::-webkit-scrollbar-thumb {
  background: var(--accent-purple) !important;
  border-radius: 2px !important;
}

#right-toc-title {
  font-size: 0.8em !important;
  font-weight: 700 !important;
  color: var(--accent-purple) !important;
  text-transform: uppercase !important;
  letter-spacing: 1.5px !important;
  margin-bottom: 15px !important;
  padding-bottom: 10px !important;
  border-bottom: 1px solid rgba(162, 89, 255, 0.3) !important;
  text-shadow: 0 0 10px rgba(162, 89, 255, 0.5) !important;
}

#right-toc-list {
  list-style: none !important;
  padding: 0 !important;
}

#right-toc-list li {
  margin: 6px 0 !important;
}

#right-toc-list a {
  color: var(--text-gray) !important;
  text-decoration: none !important;
  font-size: 0.8em !important;
  display: block !important;
  padding: 6px 10px !important;
  border-left: 2px solid transparent !important;
  transition: all 0.2s ease !important;
  border-radius: 0 4px 4px 0 !important;
}

#right-toc-list a:hover {
  color: var(--accent-purple) !important;
  border-left: 2px solid var(--accent-purple) !important;
  padding-left: 15px !important;
  background: rgba(162, 89, 255, 0.08) !important;
}

#right-toc-list a.active-section {
  color: var(--accent-purple) !important;
  border-left: 2px solid var(--accent-purple) !important;
  padding-left: 15px !important;
  background: rgba(162, 89, 255, 0.15) !important;
  font-weight: 600 !important;
  box-shadow: 0 0 15px rgba(162, 89, 255, 0.2) !important;
}

/* ========== CONTENIDO CENTRAL - SIN HUECOS ========== */
.toc-content {
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 !important;
  padding: 40px 60px !important;
  background: var(--bg-black) !important;
  min-height: 100vh !important;
}

/* ========== SECCIONES ========== */
.section.level1 {
  background: var(--bg-card) !important;
  border: 1px solid rgba(0, 229, 255, 0.15) !important;
  border-radius: 12px !important;
  padding: 35px !important;
  margin-bottom: 25px !important;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6) !important;
}

/* ========== T√çTULOS ========== */
h1 {
  color: var(--text-white) !important;
  font-size: 2.3em !important;
  font-weight: 700 !important;
  text-align: center !important;
  padding: 20px 0 !important;
  margin-bottom: 30px !important;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue)) !important;
  -webkit-background-clip: text !important;
  -webkit-text-fill-color: transparent !important;
  background-clip: text !important;
  position: relative !important;
}

h1::after {
  content: '' !important;
  position: absolute !important;
  bottom: 10px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: 150px !important;
  height: 3px !important;
  background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent) !important;
  box-shadow: 0 0 15px rgba(0, 229, 255, 0.8) !important;
}

h2 {
  color: var(--accent-cyan) !important;
  font-size: 1.8em !important;
  font-weight: 700 !important;
  padding: 15px 20px !important;
  margin-top: 35px !important;
  margin-bottom: 20px !important;
  border-left: 5px solid var(--accent-cyan) !important;
  background: linear-gradient(90deg, rgba(0, 229, 255, 0.1) 0%, transparent 100%) !important;
  border-radius: 0 8px 8px 0 !important;
  text-shadow: 0 0 20px rgba(0, 229, 255, 0.3) !important;
}

h3 {
  color: var(--text-white) !important;
  font-size: 1.5em !important;
  font-weight: 600 !important;
  padding-left: 15px !important;
  margin-top: 25px !important;
  margin-bottom: 15px !important;
  border-left: 4px solid var(--accent-purple) !important;
}

h4 {
  color: var(--text-light) !important;
  font-size: 1.2em !important;
  font-weight: 600 !important;
  margin-top: 20px !important;
  margin-bottom: 12px !important;
  padding-left: 12px !important;
  border-left: 3px solid var(--text-gray) !important;
}

/* ========== CHUNKS DE C√ìDIGO ========== */
.code-chunk {
  margin: 30px 0 !important;
  border: 1px solid rgba(0, 229, 255, 0.2) !important;
  border-radius: 10px !important;
  overflow: hidden !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5) !important;
}

.code-header {
  background: linear-gradient(90deg, rgba(0, 229, 255, 0.15), rgba(0, 132, 255, 0.15)) !important;
  color: var(--accent-cyan) !important;
  padding: 12px 20px !important;
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  cursor: pointer !important;
  border-bottom: 1px solid rgba(0, 229, 255, 0.2) !important;
}

.code-header:hover {
  background: linear-gradient(90deg, rgba(0, 229, 255, 0.25), rgba(0, 132, 255, 0.25)) !important;
}

.chunk-title {
  font-weight: 600 !important;
  font-size: 0.95em !important;
}

.toggle-icon {
  font-size: 1.1em !important;
  transition: transform 0.3s ease !important;
}

.toggle-icon.rotated {
  transform: rotate(180deg) !important;
}

.code-content {
  background: var(--bg-dark) !important;
  transition: all 0.3s ease !important;
  overflow: hidden !important;
}

.code-content.collapsed {
  max-height: 0 !important;
  opacity: 0 !important;
}

.code-content.expanded {
  max-height: 5000px !important;
  opacity: 1 !important;
}

.code-content pre {
  margin: 0 !important;
  border: none !important;
  border-radius: 0 !important;
}

/* ========== TABLAS ========== */
table {
  width: 100% !important;
  border-collapse: collapse !important;
  margin: 25px 0 !important;
  background: var(--bg-dark) !important;
  border-radius: 10px !important;
  overflow: hidden !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8) !important;
}

thead {
  background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-cyan) 100%) !important;
}

th {
  color: var(--bg-black) !important;
  padding: 16px 20px !important;
  text-align: left !important;
  font-weight: 700 !important;
  text-transform: uppercase !important;
  letter-spacing: 0.5px !important;
  font-size: 0.9em !important;
}

td {
  padding: 14px 20px !important;
  color: var(--text-light) !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
}

tr:hover td {
  background: rgba(0, 229, 255, 0.05) !important;
}

/* ========== C√ìDIGO ========== */
pre {
  background: var(--bg-dark) !important;
  border: 1px solid rgba(0, 229, 255, 0.2) !important;
  border-left: 4px solid var(--accent-cyan) !important;
  border-radius: 8px !important;
  padding: 20px !important;
  margin: 25px 0 !important;
  overflow-x: auto !important;
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5) !important;
}

code {
  color: var(--accent-cyan) !important;
  background: rgba(0, 229, 255, 0.08) !important;
  padding: 3px 8px !important;
  border-radius: 4px !important;
  font-family: 'Fira Code', 'Consolas', monospace !important;
  font-size: 0.88em !important;
}

pre code {
  background: transparent !important;
  padding: 0 !important;
  color: var(--text-light) !important;
}

/* ========== GR√ÅFICOS ========== */
.figure {
  text-align: center !important;
  margin: 30px 0 !important;
  padding: 25px !important;
  background: var(--bg-card) !important;
  border: 1px solid rgba(0, 229, 255, 0.2) !important;
  border-radius: 10px !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5) !important;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 1400px) {
  .main-container {
    padding-right: 0 !important;
  }
  
  #right-toc {
    display: none !important;
  }
  
  #global-code-toggle {
    right: 30px !important;
  }
}

@media (max-width: 1024px) {
  .main-container {
    padding-left: 0 !important;
  }
  
  #TOC {
    position: relative !important;
    width: 100% !important;
    height: auto !important;
    padding: 30px 20px !important;
  }
  
  .toc-content {
    padding: 20px !important;
  }
  
  #global-code-toggle {
    position: relative !important;
    right: 0 !important;
    margin: 20px auto !important;
    display: block !important;
    width: 80% !important;
  }
}

/* ========== SCROLL SUAVE ========== */
html {
  scroll-behavior: smooth !important;
}

/* ========== FOOTER ========== */
.footer {
  text-align: center !important;
  padding: 40px !important;
  margin-top: 60px !important;
  border-top: 2px solid rgba(0, 229, 255, 0.3) !important;
  color: var(--text-gray) !important;
  background: var(--bg-dark) !important;
}
</style>
```

<!-- Mini TOC Derecho -->

:::: {#right-toc}
::: {#right-toc-title}
EN ESTA SECCI√ìN
:::

<ul id="right-toc-list">

</ul>
::::

<!-- Bot√≥n Control de C√≥digo -->

<button id="global-code-toggle">

C√≥digo

</button>

```{=html}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ========== CONTROL DE C√ìDIGO ==========
  let allCodeVisible = true;
  const toggleButton = document.getElementById('global-code-toggle');
  
  function initializeCodeToggles() {
    const codeChunks = document.querySelectorAll('pre.r, pre.python, div.sourceCode');
    
    codeChunks.forEach((chunk, index) => {
      if (chunk.closest('.code-chunk')) return;
      
      const container = document.createElement('div');
      container.className = 'code-chunk';
      
      const header = document.createElement('div');
      header.className = 'code-header';
      header.innerHTML = `
        <div class="chunk-title">üíª C√≥digo - Chunk ${index + 1}</div>
        <div class="toggle-icon">‚ñº</div>
      `;
      
      const content = document.createElement('div');
      content.className = 'code-content expanded';
      content.appendChild(chunk.cloneNode(true));
      
      chunk.parentNode.replaceChild(container, chunk);
      container.appendChild(header);
      container.appendChild(content);
      
      header.addEventListener('click', function() {
        const isExpanded = content.classList.contains('expanded');
        const icon = this.querySelector('.toggle-icon');
        
        if (isExpanded) {
          content.classList.remove('expanded');
          content.classList.add('collapsed');
          icon.classList.add('rotated');
        } else {
          content.classList.remove('collapsed');
          content.classList.add('expanded');
          icon.classList.remove('rotated');
        }
      });
    });
  }
  
  function toggleAllCode() {
    const codeContents = document.querySelectorAll('.code-content');
    const icons = document.querySelectorAll('.toggle-icon');
    
    if (allCodeVisible) {
      codeContents.forEach(content => {
        content.classList.remove('expanded');
        content.classList.add('collapsed');
      });
      icons.forEach(icon => icon.classList.add('rotated'));
      toggleButton.innerHTML = '‚ö° Mostrar';
      allCodeVisible = false;
    } else {
      codeContents.forEach(content => {
        content.classList.remove('collapsed');
        content.classList.add('expanded');
      });
      icons.forEach(icon => icon.classList.remove('rotated'));
      toggleButton.innerHTML = '‚ö° Ocultar';
      allCodeVisible = true;
    }
  }
  
  setTimeout(initializeCodeToggles, 100);
  if (toggleButton) {
    toggleButton.addEventListener('click', toggleAllCode);
  }
  
  // ========== FUNCIONES MEJORADAS PARA TOC ==========
  
  // Obtener secci√≥n actual con mejor detecci√≥n
  function getCurrentSection() {
    const sections = document.querySelectorAll('.section.level1');
    const scrollPos = window.pageYOffset || document.documentElement.scrollTop;
    const windowHeight = window.innerHeight;
    
    let currentSection = null;
    let minDistance = Infinity;
    
    // Primero intentar encontrar la secci√≥n visible en viewport
    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      
      // Si la secci√≥n est√° en el tercio superior de la pantalla
      if (rect.top <= windowHeight / 3 && rect.bottom > 0) {
        const distance = Math.abs(rect.top);
        if (distance < minDistance) {
          minDistance = distance;
          currentSection = section;
        }
      }
    });
    
    // Si no hay secci√≥n en viewport, tomar la m√°s cercana por arriba
    if (!currentSection) {
      sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        if (rect.top < 0 && rect.bottom > -100) {
          currentSection = section;
        }
      });
    }
    
    // Si a√∫n no hay, tomar la primera secci√≥n visible
    if (!currentSection && sections.length > 0) {
      for (let section of sections) {
        const rect = section.getBoundingClientRect();
        if (rect.bottom > 0) {
          currentSection = section;
          break;
        }
      }
    }
    
    return currentSection;
  }
  
  // Actualizar TOC derecho con la secci√≥n actual
  function updateRightToc() {
    const rightTocList = document.getElementById('right-toc-list');
    if (!rightTocList) return;
    
    const activeSection = getCurrentSection();
    
    if (!activeSection) {
      rightTocList.innerHTML = '<li style="color: var(--text-gray); font-style: italic; padding: 10px;">Despl√°zate para ver contenido</li>';
      return;
    }
    
    // Buscar todos los encabezados h2, h3, h4 dentro de la secci√≥n activa
    const headings = activeSection.querySelectorAll('h2, h3, h4');
    rightTocList.innerHTML = '';
    
    if (headings.length === 0) {
      rightTocList.innerHTML = '<li style="color: var(--text-gray); font-style: italic; padding: 10px;">Sin subt√≠tulos en esta secci√≥n</li>';
      return;
    }
    
    headings.forEach((heading, index) => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      
      // Asignar ID si no existe
      if (!heading.id) {
        heading.id = 'sub-heading-' + index + '-' + Date.now();
      }
      
      a.href = '#' + heading.id;
      
      // Limpiar texto (remover numeraci√≥n)
      let textContent = heading.textContent || heading.innerText;
      textContent = textContent.replace(/^\d+(\.\d+)*\s*/, '').trim();
      
      a.textContent = textContent;
      
      // Aplicar indentaci√≥n seg√∫n nivel
      if (heading.tagName === 'H3') {
        a.style.paddingLeft = '20px';
        a.style.fontSize = '0.75em';
      } else if (heading.tagName === 'H4') {
        a.style.paddingLeft = '30px';
        a.style.fontSize = '0.7em';
      }
      
      li.appendChild(a);
      rightTocList.appendChild(li);
      
      // Evento click para scroll suave
      a.addEventListener('click', function(e) {
        e.preventDefault();
        const targetTop = heading.getBoundingClientRect().top + window.pageYOffset - 120;
        window.scrollTo({ top: targetTop, behavior: 'smooth' });
        
        setTimeout(() => {
          highlightActiveRightToc();
        }, 400);
      });
    });
    
    // Resaltar el subt√≠tulo activo
    highlightActiveRightToc();
  }
  
  // Resaltar subt√≠tulo activo en TOC derecho
  function highlightActiveRightToc() {
    const activeSection = getCurrentSection();
    if (!activeSection) return;
    
    const headings = Array.from(activeSection.querySelectorAll('h2, h3, h4'));
    const rightTocLinks = document.querySelectorAll('#right-toc-list a');
    
    let activeIndex = -1;
    let minDistance = Infinity;
    const threshold = 200;
    
    headings.forEach((heading, index) => {
      const rect = heading.getBoundingClientRect();
      const distance = Math.abs(rect.top);
      
      if (rect.top <= threshold && distance < minDistance) {
        minDistance = distance;
        activeIndex = index;
      }
    });
    
    rightTocLinks.forEach((link, index) => {
      if (index === activeIndex) {
        link.classList.add('active-section');
      } else {
        link.classList.remove('active-section');
      }
    });
  }
  
// Resaltar secci√≥n activa en TOC izquierdo CON AUTO-SCROLL
function highlightActiveTocSection() {
  const sections = document.querySelectorAll('.section.level1');
  const tocContainer = document.getElementById('TOC');
  
  if (!tocContainer) return;
  
  // Obtener todos los enlaces del TOC (incluyendo subsecciones)
  const tocLinks = tocContainer.querySelectorAll('a[href^="#"]');
  
  const activeSection = getCurrentSection();
  
  if (!activeSection) return;
  
  const activeId = activeSection.id;
  
  let activeLinkElement = null;
  
  // Remover clase active de todos los links
  tocLinks.forEach(link => {
    link.classList.remove('active');
    
    // Verificar si el href coincide con la secci√≥n activa
    const href = link.getAttribute('href');
    if (href) {
      const linkId = href.replace('#', '');
      if (linkId === activeId) {
        link.classList.add('active');
        activeLinkElement = link;
      }
    }
  });
  
  // AUTO-SCROLL DEL TOC - MEJORADO
  if (activeLinkElement && tocContainer) {
    // Usar requestAnimationFrame para asegurar que el DOM est√° listo
    requestAnimationFrame(() => {
      const linkTop = activeLinkElement.offsetTop;
      const tocScrollTop = tocContainer.scrollTop;
      const tocHeight = tocContainer.clientHeight;
      
      // Obtener la posici√≥n del header "CONTENIDO"
      const headerHeight = 100; // Altura aproximada del header + padding
      
      // Calcular la posici√≥n relativa del link en el TOC
      const linkRelativeTop = linkTop - tocScrollTop;
      
      // Definir zona visible (con margen)
      const visibleTop = headerHeight;
      const visibleBottom = tocHeight - 50;
      
      // Si el link est√° fuera de la zona visible, hacer scroll
      if (linkRelativeTop < visibleTop) {
        // El link est√° por encima, scroll hacia arriba
        tocContainer.scrollTo({
          top: linkTop - headerHeight - 20,
          behavior: 'smooth'
        });
      } else if (linkRelativeTop > visibleBottom) {
        // El link est√° por debajo, scroll hacia abajo
        tocContainer.scrollTo({
          top: linkTop - tocHeight + 100,
          behavior: 'smooth'
        });
      }
    });
  }
}
  // ========== EVENT LISTENERS ==========
  
  // Throttled scroll handler para mejor rendimiento
  let scrollTimeout;
  let lastScrollTop = 0;
  
  window.addEventListener('scroll', function() {
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    
    // Solo actualizar si el scroll cambi√≥ significativamente
    if (Math.abs(scrollTop - lastScrollTop) > 10) {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(function() {
        updateRightToc();
        highlightActiveTocSection();
        lastScrollTop = scrollTop;
      }, 100);
    }
  }, { passive: true });
  
  // Inicializaci√≥n despu√©s de que el documento est√© completamente cargado
  setTimeout(function() {
    updateRightToc();
    highlightActiveTocSection();
  }, 600);
  
  // Manejar clicks en enlaces del TOC izquierdo
  document.querySelectorAll('#TOC a').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const targetId = this.getAttribute('href');
      if (!targetId || targetId === '#') return;
      
      e.preventDefault();
      const target = document.querySelector(targetId);
      
      if (target) {
        const offsetTop = target.getBoundingClientRect().top + window.pageYOffset - 100;
        window.scrollTo({ top: offsetTop, behavior: 'smooth' });
        
        setTimeout(function() {
          updateRightToc();
          highlightActiveTocSection();
        }, 500);
      }
    });
  });
  
  // Observer para detectar cambios en el DOM
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length) {
        setTimeout(function() {
          updateRightToc();
          highlightActiveTocSection();
        }, 300);
      }
    });
  });
  
  // Observar cambios en el contenido principal
  const mainContent = document.querySelector('.toc-content') || document.body;
  observer.observe(mainContent, {
    childList: true,
    subtree: true
  });
});
</script>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  fig.width = 10,
  fig.height = 6
)
library(ggtext)
library(tidyverse)
library(ggplot2)
library(plotly)
library(knitr)
library(kableExtra)
library(FactoMineR)
library(cluster)
library(corrplot)
library(FactoClass)
library(ade4)
library(factoextra)
library(dendextend)
library(ggrepel)
library(readr)
library(dplyr)
library(ggforce)
library(htmlwidgets)
library(DT)
library(leaflet)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(htmltools)
library(gt)
library(ade4) 
library(dendextend)
library(RColorBrewer)  
library(ellipse)
library(leaflet)

cyber_palette <- c(
  primary = "#00e5ff",
  secondary = "#0084ff",
  accent = "#a259ff",
  warning = "#ff1744",
  success = "#00e676",
  gold = "#ffd600"
)

theme_cyber <- function() {
  theme_minimal(base_size = 12) +
    theme(
      plot.background = element_rect(fill = "#000000", color = NA),
      panel.background = element_rect(fill = "#0a0e1a", color = NA),
      panel.grid.major = element_line(color = "#12161f", size = 0.5),
      panel.grid.minor = element_line(color = "#12161f", size = 0.25),
      text = element_text(color = "#e0e6ed", family = "sans", size = 12),
      axis.text = element_text(color = "#8b92a0", size = 10),
      axis.title = element_text(color = "#e0e6ed", face = "bold", size = 13),
      axis.line = element_line(color = "#00e5ff", size = 0.5),
      plot.title = element_text(
        color = "#00e5ff", 
        face = "bold", 
        size = 18, 
        hjust = 0.5,
        margin = margin(b = 10)
      ),
      plot.subtitle = element_text(
        color = "#8b92a0", 
        size = 13, 
        hjust = 0.5,
        margin = margin(b = 15)
      ),
      legend.background = element_rect(fill = "#12161f", color = "#00e5ff", size = 0.5),
      legend.key = element_rect(fill = "#12161f", color = NA),
      legend.text = element_text(color = "#e0e6ed", size = 10),
      legend.title = element_text(color = "#00e5ff", face = "bold", size = 11),
      legend.position = "right",
      strip.background = element_rect(fill = "#12161f", color = "#00e5ff"),
      strip.text = element_text(color = "#00e5ff", face = "bold", size = 11),
      panel.border = element_rect(color = "#00e5ff", fill = NA, size = 0.5),
      plot.margin = margin(20, 20, 20, 20)
    )
}

theme_set(theme_cyber())

tabla_cyber <- function(data, caption = "", col_names = NULL) {
  if (is.null(col_names)) {
    col_names <- names(data)
  }
  
  data %>%
    kbl(
      caption = caption,
      col.names = col_names,
      align = "c"
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover", "condensed"),
      full_width = FALSE,
      font_size = 14,
      position = "center"
    ) %>%
    row_spec(0, background = "#0084ff", color = "black", bold = TRUE) %>%
    row_spec(1:nrow(data), background = "#0a0e1a", color = "#e0e6ed")
}

scale_fill_cyber <- function(...) {
  scale_fill_manual(values = cyber_palette, ...)
}

scale_color_cyber <- function(...) {
  scale_color_manual(values = cyber_palette, ...)
}
```

# Introducci√≥n

En el coraz√≥n de la econom√≠a global existe una paradoja fundamental: mientras que algunos indicadores sugieren una relaci√≥n lineal y predecible entre el desarrollo econ√≥mico y el bienestar social, la realidad es mucho m√°s compleja y matizada. Tomemos un ejemplo: Costa Rica tiene una esperanza de vida comparable a la de pa√≠ses europeos desarrollados, pero con un PIB per c√°pita significativamente menor; Qatar, por su parte, lidera en PIB per c√°pita pero no encabeza necesariamente en todos los indicadores de bienestar social (Shkolnikov et al., 2019). Estas "anomal√≠as" no son excepciones sino revelaciones de una verdad fundamental: el desarrollo no es unidimensional.

El problema central que motiva este trabajo es fundamental: ¬øCu√°les son realmente los "tipos" de desarrollo que caracterizan la econom√≠a mundial cuando se analiza simult√°neamente un conjunto amplio de 17 indicadores econ√≥micos, sociales, tecnol√≥gicos y ambientales? No se trata de responder cu√°l pa√≠s es m√°s "rico", sino algo m√°s profundo: descubrir si existen estructuras ocultas en los datos que agrupen pa√≠ses con perfiles similares m√°s all√° de la geograf√≠a o las clasificaciones convencionales. Espec√≠ficamente, la pregunta es: ¬øColombia y Uruguay podr√≠an compartir m√°s similitudes con algunos pa√≠ses asi√°ticos que con sus propios vecinos latinoamericanos? ¬øExiste realmente un "grupo de pa√≠ses con baja renta pero alto acceso tecnol√≥gico"? ¬øLas caracter√≠sticas ambientales y demogr√°ficas se alinean con la riqueza econ√≥mica o presentan patrones independientes?

Hist√≥ricamente, el desarrollo internacional se ha medido mediante indicadores aislados. El PIB per c√°pita domina los rankings; la esperanza de vida se analiza independientemente; la conectividad digital se observa separadamente. Este enfoque fragmentado es problem√°tico porque el desarrollo no es unidimensional: un pa√≠s puede ser econ√≥micamente exitoso pero fr√°gil en salud p√∫blica, o tener excelente conectividad digital pero vulnerabilidad ambiental cr√≠tica (Jolliffe, 2002; World Bank, 2023). Los datos del a√±o 2022 capturan un momento √∫nico en la historia econ√≥mica global: post-pandemia de COVID-19, con efectos heterog√©neos seg√∫n pa√≠s. Algunos recuperaron r√°pidamente su dinamismo; otros enfrentaron cicatrices estructurales persistentes en empleo, salud y finanzas p√∫blicas (World Bank, 2023).

El Banco Mundial proporciona 17 indicadores reconocidos internacionalmente que miden dimensiones distintas: factores econ√≥micos (PIB per c√°pita, crecimiento del PIB, inversi√≥n extranjera, remesas, industria, comercio), indicadores de salud y bienestar (esperanza de vida, mortalidad infantil, gasto en salud), variables de conectividad tecnol√≥gica (acceso a electricidad, uso de internet, suscripciones m√≥viles) y aspectos ambientales y demogr√°ficos (√°rea boscosa, tierra cultivable, crecimiento poblacional) (World Bank, 2023). Analizar estas 17 variables de forma independiente genera ruido; analizarlas de manera integrada puede revelar patrones coherentes que informan pol√≠ticas p√∫blicas, estrategias de cooperaci√≥n internacional y decisiones de inversi√≥n.

El desaf√≠o es modelar una pregunta sin respuesta predefinida: ¬øQu√© agrupamientos naturales de pa√≠ses emergen cuando se analiza simult√°neamente esta multiplicidad de indicadores? Este es precisamente el rol del aprendizaje no supervisado‚Äîun conjunto de t√©cnicas que descubren patrones en datos sin etiquetas previas, sin clasificaciones arbitrarias impuestas externamente (Charrad et al., 2014; Jolliffe, 2002).

Lo que sigue es una cartograf√≠a multidimensional de la econom√≠a global en el contexto post-pandemia: no solo se responde "¬øen qu√© grupos se dividen los pa√≠ses?", sino, m√°s profundamente, "¬øqu√© revelan estos grupos sobre mecanismos reales del desarrollo, oportunidades compartidas, restricciones comunes y trayectorias viables para diferentes sociedades?" Los resultados no ser√°n una clasificaci√≥n administrativa sino un descubrimiento emp√≠rico basado en lo que los datos de 180 pa√≠ses en 2022 efectivamente revelan.

------------------------------------------------------------------------

# Metodolog√≠a

## Base de datos

La base de datos utilizada en este an√°lisis proviene de la compilaci√≥n World Development Indicators (WDI) del Banco Mundial, considerada la principal fuente internacional de estad√≠sticas comparables sobre desarrollo econ√≥mico y social (World Bank, 2023). Los WDI representan el esfuerzo m√°s comprehensivo del Banco Mundial para consolidar indicadores de desarrollo de fuentes oficialmente reconocidas, incluyendo oficinas nacionales de estad√≠stica, bancos centrales, agencias de las Naciones Unidas, instituciones de investigaci√≥n y contribuyentes del sector privado (World Bank, 2023; Jeanty, 2010).

La base WDI contiene aproximadamente 1,600 indicadores de series temporales para 217 econom√≠as y m√°s de 40 grupos de pa√≠ses, con datos para muchos indicadores que se remontan m√°s de 50 a√±os (World Bank, 2023). Los datos son compilados mediante metodolog√≠as estandarizadas que garantizan comparabilidad internacional, transparencia metodol√≥gica y robustez estad√≠stica (World Bank, 2019). El proceso de selecci√≥n de indicadores del WDI sigue cuatro criterios fundamentales: facilidad de uso (accesibilidad y claridad para usuarios diversos), confiabilidad (reputaci√≥n y credibilidad de la fuente), cobertura (amplitud geogr√°fica y temporal), y calidad (rigor metodol√≥gico y precisi√≥n) (Behar & Mok, 2024).

Para este an√°lisis, se filtro informaci√≥n exclusivamente para pa√≠ses individuales (eliminando bloques regionales o agrupaciones econ√≥micas) del a√±o 2022. El dataset resultante contiene aproximadamente 180-200 pa√≠ses, seg√∫n la disponibilidad de datos completos, donde cada observaci√≥n representa una unidad soberana comparable en un √∫nico punto temporal.

El a√±o 2022 marca un punto de inflexi√≥n cr√≠tico en la econom√≠a global, representa el momento post-pandemia en que las trayectorias de recuperaci√≥n de cada pa√≠s se hacen visibles y diferenciadas. Mientras algunos pa√≠ses desarrollados con capacidad fiscal recuperaron o superaron niveles pre-COVID-19, econom√≠as emergentes enfrentaban cicatrices estructurales persistentes en empleo, inflaci√≥n descontrolada, y aumento de deuda p√∫blica (Banco Mundial, 2022; FMI, 2023; CEPAL, 2023). La desigualdad global se ampli√≥ dr√°sticamente: el crecimiento proyectado para Am√©rica Latina en 2022 era apenas 2.6%, mientras la desigualdad de ingresos aument√≥ significativamente despu√©s de dos d√©cadas de mejoras (BID, 2022).

En este contexto, 2022 funciona como un "revelador" excepcional de vulnerabilidades y fortalezas estructurales subyacentes de los pa√≠ses: aquellos con sistemas de salud robustos, infraestructura tecnol√≥gica consolidada y econom√≠as diversificadas mostraron resiliencia; los que enfrentaban fragilidades estructurales experimentaron impactos persistentes (Banco Mundial, 2022; CIDOB, 2022). Por tanto, 2022 es un a√±o extraordinariamente informativo para identificar perfiles reales de desarrollo, ya que las diferencias entre pa√≠ses se magnificaron visiblemente, permitiendo observar no clasificaciones arbitrarias sino estructuras aut√©nticas de capacidad nacional.

## Descripci√≥n de las variables

El dataset construido para este an√°lisis integra 17 variables cuantitativas que capturan las m√∫ltiples dimensiones del desarrollo contempor√°neo. Estas variables se organizan en cinco √°reas tem√°ticas que, en conjunto, ofrecen una perspectiva comprehensiva del desempe√±o socioecon√≥mico, tecnol√≥gico y ambiental de cada pa√≠s. A continuaci√≥n, se presenta una descripci√≥n detallada de cada variable seg√∫n su √°rea tem√°tica.

### Dimensi√≥n economica

La inclusi√≥n de variables econ√≥micas es fundamental porque el desarrollo ha sido hist√≥ricamente conceptualizado como un proceso de transformaci√≥n estructural impulsado por el crecimiento econ√≥mico (World Bank, 2023; Piketty, 2022). Sin embargo, el crecimiento econ√≥mico no es unidimensional: requiere tanto un nivel absoluto de riqueza (PIB per c√°pita) como dinamismo y expansi√≥n (crecimiento del PIB), diversificaci√≥n productiva (industria), y capacidad de atracci√≥n de inversi√≥n internacional (IED) que transfiera conocimiento y capital (ECB, 2018). Adem√°s, las econom√≠as contempor√°neas est√°n integradas globalmente, por lo que exportaciones, importaciones y remesas son transmisores clave de oportunidades y vulnerabilidades econ√≥micas (World Bank, 2023)., en la tabla 1 las observamos.

```{r Variables economicas}
variables_economicas <- data.frame(
  Variable = c(
    "PIB per c√°pita (US$)",
    "Crecimiento del PIB (% anual)",
    "Inversi√≥n extranjera directa (% PIB)",
    "Remesas recibidas (% PIB)",
    "Industria (% PIB)",
    "Exportaciones (% PIB)",
    "Importaciones (% PIB)"
  ),
  
  Descripci√≥n = c(
    "PIB dividido por poblaci√≥n, en d√≥lares corrientes. Indicador principal del nivel de ingreso y producci√≥n econ√≥mica por persona.",
    "Tasa de variaci√≥n anual del PIB en precios constantes. Refleja la expansi√≥n o contracci√≥n econ√≥mica de un pa√≠s.",
    "Flujos netos de inversi√≥n con inter√©s gerencial duradero. Fuente crucial de financiamiento externo y transferencia tecnol√≥gica.",
    "Transferencias personales de migrantes que trabajan en el extranjero. Flujo financiero clave para muchas econom√≠as en desarrollo.",
    "Valor agregado del sector industrial. Refleja el grado de industrializaci√≥n y la estructura productiva de una econom√≠a.",
    "Valor de bienes y servicios vendidos al exterior. Mide el grado de apertura comercial y oportunidades de crecimiento.",
    "Valor de bienes y servicios comprados al exterior. Indica la dependencia de la econom√≠a respecto al comercio internacional."
  ),
  
  Interpretaci√≥n = c(
    ">20,000 USD: econom√≠a desarrollada\n5,000-20,000 USD: econom√≠a emergente\n<5,000 USD: econom√≠a en desarrollo",
    ">3%: crecimiento robusto\n0-3%: crecimiento moderado\n<0%: recesi√≥n econ√≥mica",
    ">5%: alta atracci√≥n de IED\n2-5%: nivel moderado\n<2%: baja atracci√≥n de inversi√≥n",
    ">10%: alta dependencia\n2-10%: contribuci√≥n significativa\n<2%: impacto limitado",
    ">30%: econom√≠a industrializada\n20-30%: sector industrial s√≥lido\n<20%: base industrial reducida", 
    ">50%: econom√≠a muy abierta\n30-50%: apertura moderada\n<30%: econom√≠a relativamente cerrada",
    ">40%: alta dependencia importaciones\n25-40%: nivel moderado\n<25%: autosuficiencia relativa"
  )
)

tabla_1 <- variables_economicas %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 1**"),
    subtitle = "Variables Macroecon√≥micas y su Interpretaci√≥n"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripci√≥n = md("**Descripci√≥n**"),
    Interpretaci√≥n = md("**Interpretaci√≥n**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small", color = "#e0e6ed"),
    locations = cells_body(columns = c(Descripci√≥n, Interpretaci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", color = "#00e5ff", size = "large")
    ),
    locations = cells_title(groups = "title")
  ) %>%
  tab_style(
    style = list(
      cell_text(color = "#e0e6ed", size = "medium")
    ),
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(3),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 13,
    source_notes.font.size = 13,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en World Bank (2023), UN (2015), ECB (2018)")
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretaci√≥n son referenciales y pueden variar seg√∫n el contexto regional y temporal",
    locations = cells_title(groups = "subtitle")
  )

tabla_1
```

### Dimension de salud y bienestar

La inclusi√≥n de variables sanitarias responde a que el desarrollo no es puramente econ√≥mico sino que debe reflejarse en mejoras sustantivas en la calidad de vida, particularmente en indicadores de salud poblacional (Sachs et al., 2022; World Bank, 2023). La esperanza de vida es considerada por organismos internacionales como el indicador sint√©tico m√°s robusto de desarrollo humano, capturando tanto el acceso a servicios de salud como condiciones generales de vida (OECD, 2024). La mortalidad infantil es particularmente sensible a la calidad del sistema sanitario, y el gasto en salud refleja el esfuerzo institucional de un pa√≠s por asegurar bienestar poblacional (World Bank, 2023)., en la tabla 2 las observamos.

```{r Variables bienestar}
variables_salud <- data.frame(
  Variable = c(
    "Esperanza de vida al nacer (a√±os)",
    "Mortalidad infantil (por cada 1,000 nacidos vivos)",
    "Gasto en salud (% del PIB)"
  ),
  
  Descripci√≥n = c(
    "N√∫mero promedio de a√±os que se espera que viva un reci√©n nacido si los patrones de mortalidad prevalecientes al momento de su nacimiento permanecen constantes a lo largo de su vida. Es uno de los indicadores m√°s robustos para medir el estado de salud poblacional, reflejando la calidad del sistema sanitario, acceso a servicios m√©dicos, condiciones de vida, nutrici√≥n y factores ambientales.",
    "N√∫mero de muertes de ni√±os menores de un a√±o por cada 1,000 nacimientos vivos. Es un indicador sensible de la calidad de atenci√≥n sanitaria materno-infantil, condiciones sanitarias, acceso a agua potable y nutrici√≥n adecuada, funcionando como proxy de desarrollo social y capacidad institucional del sistema de salud.",
    "Gasto corriente en salud expresado como porcentaje del PIB, incluyendo tanto gasto p√∫blico como privado. Refleja la prioridad presupuestaria que un pa√≠s asigna al sector salud y su capacidad de financiar infraestructura sanitaria, siendo un determinante clave de resultados de salud poblacional."
  ),
  
  Interpretaci√≥n = c(
    ">75 a√±os: salud poblacional avanzada\n70-75 a√±os: nivel medio de desarrollo sanitario\n<70 a√±os: desaf√≠os significativos en salud p√∫blica",
    "<10: excelentes condiciones sanitarias\n10-25: condiciones moderadas\n>25: necesidades cr√≠ticas en salud infantil",
    ">8%: alta prioridad en salud\n5-8%: compromiso moderado\n<5%: recursos sanitarios limitados"
  )
)

tabla_2 <- variables_salud %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 2**"),
    subtitle = "Indicadores de Salud P√∫blica y su Interpretaci√≥n"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripci√≥n = md("**Descripci√≥n**"),
    Interpretaci√≥n = md("**Interpretaci√≥n**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small", color = "#e0e6ed"),
    locations = cells_body(columns = c(Descripci√≥n, Interpretaci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", color = "#00e5ff", size = "large")
    ),
    locations = cells_title(groups = "title")
  ) %>%
  tab_style(
    style = list(
      cell_text(color = "#e0e6ed", size = "medium")
    ),
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(3),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 13,
    source_notes.font.size = 13,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en WHO (2020), OECD (2024), World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretaci√≥n son referenciales y pueden variar seg√∫n el contexto regional y nivel de desarrollo",
    locations = cells_title(groups = "subtitle")
  )

tabla_2
```

### Dimension tecnologica y de conectividad

La inclusi√≥n de variables tecnol√≥gicas es justificada por la importancia creciente de la transformaci√≥n digital en el desarrollo contempor√°neo (UNCTAD, 2021; World Bank, 2023). La acceso a electricidad, internet y telefon√≠a m√≥vil no son lujos sino infraestructuras esenciales que habilitan participaci√≥n en la econom√≠a del conocimiento, acceso a informaci√≥n, servicios financieros y oportunidades econ√≥micas (UNCTAD, 2021). La brecha digital ha emergido como una nueva dimensi√≥n de desigualdad internacional, donde pa√≠ses con penetraci√≥n digital menor enfrentan desventajas competitivas significativas (World Bank, 2023)., en la tabla 3 las observamos.

```{r Variables tecnologicas}
variables_tecnologia <- data.frame(
  Variable = c(
    "Acceso a electricidad (% de la poblaci√≥n)",
    "Uso de internet (% de la poblaci√≥n)",
    "Suscripciones m√≥viles (por cada 100 personas)"
  ),
  
  Descripci√≥n = c(
    "Porcentaje de la poblaci√≥n con acceso a electricidad. Indicador fundamental de infraestructura energ√©tica b√°sica, condici√≥n necesaria para actividad econ√≥mica moderna, educaci√≥n, salud y conectividad digital.",
    "Porcentaje de individuos que han utilizado internet en los √∫ltimos 3 meses. Proxy de conectividad digital, acceso a informaci√≥n, y participaci√≥n en la econom√≠a del conocimiento, siendo cada vez m√°s relevante para productividad econ√≥mica y reducci√≥n de brechas informativas.",
    "N√∫mero de suscripciones a servicios de telefon√≠a celular m√≥vil por cada 100 habitantes. Refleja la penetraci√≥n de tecnolog√≠a m√≥vil, que ha sido un vector fundamental de inclusi√≥n digital y acceso a servicios financieros en econom√≠as en desarrollo."
  ),
  
  Interpretaci√≥n = c(
    ">95%: cobertura el√©ctrica universal\n80-95%: acceso extendido\n<80%: d√©ficit significativo de infraestructura",
    ">70%: sociedad digitalmente integrada\n30-70%: adopci√≥n media de internet\n<30%: brecha digital significativa",
    ">100: alta penetraci√≥n m√≥vil\n80-100: cobertura adecuada\n<80: oportunidades de expansi√≥n del mercado"
  )
)

tabla_3 <- variables_tecnologia %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 3**"),
    subtitle = "Indicadores de Infraestructura y Tecnolog√≠a"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripci√≥n = md("**Descripci√≥n**"),
    Interpretaci√≥n = md("**Interpretaci√≥n**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small", color = "#e0e6ed"),
    locations = cells_body(columns = c(Descripci√≥n, Interpretaci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", color = "#00e5ff", size = "large")
    ),
    locations = cells_title(groups = "title")
  ) %>%
  tab_style(
    style = list(
      cell_text(color = "#e0e6ed", size = "medium")
    ),
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(3),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 13,
    source_notes.font.size = 13,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los valores superiores a 100 en suscripciones m√≥viles indican m√∫ltiples suscripciones por persona",
    locations = cells_body(
      rows = 3,
      columns = Interpretaci√≥n
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretaci√≥n son referenciales y pueden variar seg√∫n el nivel de desarrollo regional",
    locations = cells_title(groups = "subtitle")
  )

tabla_3
```

### Dimension ambiental y de recursos

La inclusi√≥n de variables ambientales responde al creciente reconocimiento de que el desarrollo sostenible debe integrar consideraciones ecol√≥gicas (PNUD, 2023; World Bank, 2023). Aunque el crecimiento econ√≥mico tradicional ha sido alcanzado frecuentemente mediante degradaci√≥n ambiental, la sostenibilidad del desarrollo requiere preservaci√≥n de capital natural, particularmente bosques (para captura de carbono y biodiversidad) y tierra cultivable (para seguridad alimentaria) (PNUD, 2023; World Bank, 2023), en la tabla 4 las vemos.

```{r Variables ambiental}
variables_ambientales <- data.frame(
  Variable = c(
    "√Årea boscosa (% del √°rea terrestre)",
    "Tierra cultivable (% del √°rea terrestre)"
  ),
  
  Descripci√≥n = c(
    "Porcentaje del territorio nacional cubierto por bosques. Es un indicador de conservaci√≥n ambiental, biodiversidad y sostenibilidad, siendo relevante tanto para mitigaci√≥n del cambio clim√°tico como para servicios ecosist√©micos.",
    "Porcentaje de tierra apta para cultivos agr√≠colas. Refleja el potencial agr√≠cola y la base de recursos naturales para producci√≥n de alimentos, siendo particularmente relevante para econom√≠as con sectores agr√≠colas significativos."
  ),
  
  Interpretaci√≥n = c(
    ">30%: alta cobertura forestal\n15-30%: cobertura media\n<15%: deforestaci√≥n significativa",
    ">20%: alta disponibilidad agr√≠cola\n10-20%: capacidad moderada\n<10%: limitaciones para agricultura"
  )
)

tabla_4 <- variables_ambientales %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 4**"),
    subtitle = "Indicadores Ambientales y de Uso de la Tierra"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripci√≥n = md("**Descripci√≥n**"),
    Interpretaci√≥n = md("**Interpretaci√≥n**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small", color = "#e0e6ed"),
    locations = cells_body(columns = c(Descripci√≥n, Interpretaci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", color = "#00e5ff", size = "large")
    ),
    locations = cells_title(groups = "title")
  ) %>%
  tab_style(
    style = list(
      cell_text(color = "#e0e6ed", size = "medium")
    ),
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(3),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 13,
    source_notes.font.size = 13,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "Los servicios ecosist√©micos incluyen regulaci√≥n h√≠drica, conservaci√≥n de biodiversidad y secuestro de carbono",
    locations = cells_body(
      rows = 1,
      columns = Descripci√≥n
    )
  ) %>%
  tab_footnote(
    footnote = "La tierra cultivable incluye tierras arables, cultivos permanentes y pastos permanentes",
    locations = cells_body(
      rows = 2,
      columns = Descripci√≥n
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretaci√≥n pueden variar seg√∫n las caracter√≠sticas geogr√°ficas y ecol√≥gicas de cada regi√≥n",
    locations = cells_title(groups = "subtitle")
  )

tabla_4

```

### Dimension demografica

La inclusi√≥n de variables demogr√°ficas es justificada porque la din√°mica poblacional condiciona fundamentalmente los desaf√≠os y oportunidades de desarrollo: presi√≥n sobre recursos, mercado laboral, demanda por servicios p√∫blicos, y sostenibilidad fiscal (CEPAL, 2023; World Bank, 2023). Pa√≠ses con crecimiento poblacional acelerado enfrentan distintos desaf√≠os que aquellos con envejecimiento poblacional, impactando tasas de ahorro, inversi√≥n, y provisi√≥n de servicios (CEPAL, 2023), vemos las variables en la tabla 5.

```{r Variables demograficas}
variables_demograficas <- data.frame(
  Variable = c(
    "Poblaci√≥n total",
    "Crecimiento poblacional (% anual)"
  ),
  
  Descripci√≥n = c(
    "N√∫mero total de habitantes de un pa√≠s a mitad de a√±o. El tama√±o poblacional determina tanto el mercado interno como la escala de demanda por servicios p√∫blicos y recursos naturales.",
    "Tasa de variaci√≥n porcentual anual de la poblaci√≥n. Refleja la presi√≥n demogr√°fica y sus implicaciones para sostenibilidad, mercados laborales, y provisi√≥n de servicios p√∫blicos."
  ),
  
  Interpretaci√≥n = c(
    ">100M: pa√≠s muy poblado\n10-100M: poblaci√≥n media\n<10M: pa√≠s poco poblado",
    ">2%: crecimiento r√°pido\n0.5-2%: crecimiento moderado\n<0.5%: crecimiento lento"
  )
)

tabla_5 <- variables_demograficas %>%
  gt() %>%
  tab_header(
    title = md("**Tabla 5**"),
    subtitle = "Indicadores Demogr√°ficos B√°sicos"
  ) %>%
  cols_label(
    Variable = md("**Variable**"),
    Descripci√≥n = md("**Descripci√≥n**"),
    Interpretaci√≥n = md("**Interpretaci√≥n**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable, Descripci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = Variable)
  ) %>%
  tab_style(
    style = cell_text(size = "small", color = "#e0e6ed"),
    locations = cells_body(columns = c(Descripci√≥n, Interpretaci√≥n))
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", color = "#00e5ff", size = "large")
    ),
    locations = cells_title(groups = "title")
  ) %>%
  tab_style(
    style = list(
      cell_text(color = "#e0e6ed", size = "medium")
    ),
    locations = cells_title(groups = "subtitle")
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(3),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 13,
    source_notes.font.size = 13,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "La poblaci√≥n se refiere a residentes totales independientemente de su estatus legal o ciudadan√≠a",
    locations = cells_body(
      rows = 1,
      columns = Descripci√≥n
    )
  ) %>%
  tab_footnote(
    footnote = "El crecimiento poblacional incluye nacimientos, muertes y migraci√≥n neta",
    locations = cells_body(
      rows = 2,
      columns = Descripci√≥n
    )
  ) %>%
  tab_footnote(
    footnote = "Los umbrales de interpretaci√≥n son referenciales y pueden variar seg√∫n el contexto regional y nivel de desarrollo",
    locations = cells_title(groups = "subtitle")
  )

tabla_5
```

## Base de datos del modelo

A continuacion, se muestra la base de datos que se usara para el modelo de aprendizaje no supervisado.

```{r Base de datos, warning=FALSE,message=FALSE}

Base_2022 <- read_csv("f36a5086-3311-4b1a-9f0c-bda5cd4718df_Series - Metadata.csv",
                 show_col_types = FALSE) %>%
  select(
    Pais = `Country Name`,
    Codigo = `Country Code`,
    PIB_per = `GDP per capita (current US$) [NY.GDP.PCAP.CD]`,
    Poblacion = `Population, total [SP.POP.TOTL]`,
    `Esperanza vida` = `Life expectancy at birth, total (years) [SP.DYN.LE00.IN]`,
    `Acceso electricidad` = `Access to electricity (% of population) [EG.ELC.ACCS.ZS]`,
    `Area boscosa` = `Forest area (% of land area) [AG.LND.FRST.ZS]`,
    `Suscripciones movil` = `Mobile cellular subscriptions (per 100 people) [IT.CEL.SETS.P2]`,
    `Crecimiento PIB` = `GDP growth (annual %) [NY.GDP.MKTP.KD.ZG]`,
    `Mortalidad infantil` = `Mortality rate, infant (per 1,000 live births) [SP.DYN.IMRT.IN]`,
    `Inversion extranjera` = `Foreign direct investment, net inflows (% of GDP) [BX.KLT.DINV.WD.GD.ZS]`,
    `Gasto salud` = `Current health expenditure (% of GDP) [SH.XPD.CHEX.GD.ZS]`,
    `Uso internet` = `Individuals using the Internet (% of population) [IT.NET.USER.ZS]`,
    Importaciones = `Imports of goods and services (% of GDP) [NE.IMP.GNFS.ZS]`,
    Exportaciones = `Exports of goods and services (% of GDP) [NE.EXP.GNFS.ZS]`,
    `Tierra cultivable` = `Arable land (% of land area) [AG.LND.ARBL.ZS]`,
    `Crecimiento poblacion` = `Population growth (annual %) [SP.POP.GROW]`,
    Industria = `Industry (including construction), value added (% of GDP) [NV.IND.TOTL.ZS]`,
    Remesas = `Personal remittances, received (% of GDP) [BX.TRF.PWKR.DT.GD.ZS]`
  )%>%
  filter(!Pais %in% c("World", "High income", "Low income", "European Union",
                      "Latin America & Caribbean", "Middle income", "OECD members",
                      "East Asia & Pacific", "Sub-Saharan Africa", "South Asia",
                      "North America", "Euro area", "Arab World", "West Bank and Gaza",
                      "Lower middle income", "Upper middle income", 
                      "Least developed countries: UN classification",
                      "Fragile and conflict affected situations", 
                      "Heavily indebted poor countries (HIPC)",
                      "IDA total", "Low & middle income", "Middle East & North Africa",
                      "Pacific island small states", "Small states", 
                      "Caribbean small states", "Other small states", 
                      "IDA & IBRD total", "IDA only", "IBRD only",
                      "Pre-demographic dividend", "Post-demographic dividend", 
                      "Early-demographic dividend", "Late-demographic dividend")) %>% 
  mutate(across(3:19, as.numeric)) %>% drop_na()%>% 
  filter(Pais != c( "Luxembourg","	Uruguay", "Angola","Jordan","Belize")) %>% 
  filter(Codigo != "BLZ",Codigo!="JOR",Codigo!="URY")


tabla_inicial <- datatable(
  Base_2022,
  extensions = c('Buttons', 'Scroller', 'Responsive', 'FixedHeader'),
  options = list(
    dom = '<"top"lBf>rt<"bottom"ip><"clear">',
    buttons = list(
      list(extend = 'copy', text = ' Copiar', className = 'btn-cyber'),
      list(extend = 'csv', text = ' CSV', className = 'btn-cyber'),
      list(extend = 'excel', text = ' Excel', className = 'btn-cyber'),
      list(extend = 'pdf', text = ' PDF', className = 'btn-cyber'),
      list(extend = 'print', text = 'Ô∏è Imprimir', className = 'btn-cyber')
    ),
    pageLength = 12,
    lengthMenu = list(c(8, 12, 20, 50, -1), 
                     c('8', '12', '20', '50', 'Todos')),
    scrollX = TRUE,
    scrollY = "550px",
    scroller = TRUE,
    deferRender = TRUE,
    language = list(
      url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json',
      search = "Buscar:",
      lengthMenu = "Mostrar _MENU_ registros",
      info = "_START_ - _END_ de _TOTAL_",
      paginate = list(
        first = "Primero",
        last = "√öltimo",
        `next` = "Siguiente",
        previous = "Anterior"
      )
    ),
    autoWidth = TRUE,
    fixedHeader = TRUE,
    searchHighlight = TRUE
  ),
  rownames = FALSE,
  filter = 'top',
  class = c('display', 'compact', 'hover', 'dt-cyber'),
  caption = htmltools::HTML(' <span style="color: #00e5ff; font-weight: bold; font-size: 16px;">Indicadores Econ√≥micos y Sociales Globales 2022</span>')
) %>%
  formatCurrency(
    columns = 'PIB_per', 
    currency = "$", 
    digits = 0,
    before = TRUE
  ) %>%
  formatRound(
    columns = 'Poblacion', 
    digits = 0,
    mark = ","
  ) %>%
  formatRound(
    columns = c('Esperanza vida', 'Acceso electricidad', 'Area boscosa',
               'Suscripciones movil', 'Crecimiento PIB', 'Inversion extranjera', 
               'Gasto salud', 'Uso internet', 'Importaciones', 'Exportaciones', 
               'Tierra cultivable', 'Crecimiento poblacion', 'Industria', 'Remesas'), 
    digits = 2
  ) %>%
  formatRound(
    columns = 'Mortalidad infantil',
    digits = 1
  ) %>%
  formatStyle(
    columns = names(Base_2022),
    fontSize = '13px',
    fontFamily = 'Arial, sans-serif',
    color = '#e0e6ed',
    backgroundColor = '#0a0e1a'
  ) %>%
  htmlwidgets::onRender("
    function(el, x) {
      // Estilizar encabezados
      var headers = $('thead th');
      headers.css({
        'background-color': '#00e5ff !important',
        'color': '#000000 !important',
        'font-weight': 'bold !important',
        'font-size': '14px !important',
        'border': '2px solid #00e5ff !important',
        'text-transform': 'uppercase',
        'letter-spacing': '0.5px'
      });
      
      // Estilizar filas
      $('tbody tr').css({
        'background-color': '#0a0e1a !important',
        'border-bottom': '1px solid #00e5ff !important'
      });
      
      // Hover effect
      $('tbody tr').hover(
        function() {
          $(this).css({
            'background-color': '#12161f !important',
            'box-shadow': 'inset 0 0 20px rgba(0, 229, 255, 0.2) !important'
          });
        },
        function() {
          $(this).css({
            'background-color': '#0a0e1a !important',
            'box-shadow': 'none !important'
          });
        }
      );
      
      // Estilizar celdas
      $('tbody td').css({
        'color': '#e0e6ed !important',
        'border-right': '1px solid #00e5ff !important',
        'padding': '12px !important'
      });
      
      // Estilizar filtros
      var filterRow = $('thead tr:last');
      filterRow.find('th').css({
        'background-color': '#12161f !important',
        'border': '1px solid #0084ff !important'
      });
      
      filterRow.find('input').css({
        'background-color': '#0a0e1a !important',
        'color': '#e0e6ed !important',
        'border': '1px solid #00e5ff !important',
        'border-radius': '6px',
        'padding': '8px !important',
        'font-size': '12px'
      }).attr('placeholder', ' Filtrar...');
      
      // Estilizar botones
      var buttons = $('.dt-buttons .btn-cyber');
      buttons.css({
        'background': 'linear-gradient(135deg, #00e5ff 0%, #0084ff 100%) !important',
        'color': '#000000 !important',
        'border': '2px solid #00e5ff !important',
        'border-radius': '8px !important',
        'padding': '10px 16px !important',
        'font-weight': 'bold !important',
        'font-size': '13px !important',
        'cursor': 'pointer !important',
        'margin': '5px !important',
        'transition': 'all 0.3s ease !important',
        'box-shadow': '0 0 15px rgba(0, 229, 255, 0.4) !important'
      }).hover(
        function() {
          $(this).css({
            'transform': 'translateY(-3px) !important',
            'box-shadow': '0 0 25px rgba(0, 229, 255, 0.8) !important'
          });
        },
        function() {
          $(this).css({
            'transform': 'translateY(0) !important',
            'box-shadow': '0 0 15px rgba(0, 229, 255, 0.4) !important'
          });
        }
      );
      
      // Estilizar paginaci√≥n
      $('.dataTables_paginate .paginate_button').css({
        'background-color': '#12161f !important',
        'color': '#e0e6ed !important',
        'border': '1px solid #00e5ff !important',
        'margin': '2px !important',
        'padding': '8px 12px !important',
        'border-radius': '4px',
        'font-size': '12px'
      }).hover(
        function() {
          if (!$(this).hasClass('disabled')) {
            $(this).css({
              'background-color': '#00e5ff !important',
              'color': '#000000 !important'
            });
          }
        },
        function() {
          $(this).css({
            'background-color': '#12161f !important',
            'color': '#e0e6ed !important'
          });
        }
      );
      
      $('.dataTables_paginate .paginate_button.current').css({
        'background-color': '#00e5ff !important',
        'color': '#000000 !important',
        'box-shadow': '0 0 15px rgba(0, 229, 255, 0.6) !important'
      });
      
      // Estilizar info
      $('.dataTables_info').css({
        'color': '#e0e6ed !important',
        'font-size': '13px'
      });
      
      // Estilizar controles
      $('label').css({
        'color': '#e0e6ed !important',
        'font-size': '13px'
      });
      
      $('select').css({
        'background-color': '#0a0e1a !important',
        'color': '#e0e6ed !important',
        'border': '1px solid #00e5ff !important',
        'border-radius': '4px',
        'padding': '6px !important'
      });
    }
  ")

tabla_inicial
```

## Descripci√≥n del modelo

La implementaci√≥n del an√°lisis se estructura en cuatro etapas secuenciales, cada una construida sobre los resultados de la anterior, garantizando que la informaci√≥n y patrones descubiertos se preserven y amplifiquen a trav√©s del pipeline de an√°lisis.

### Preparaci√≥n y Estandarizaci√≥n de Datos

Previo a cualquier an√°lisis multivariado, es fundamental estandarizar las variables originales para garantizar que todas contribuyan en igualdad de condiciones al c√°lculo de componentes principales (KeepCoding, 2025). La estandarizaci√≥n se realiz√≥ mediante la transformaci√≥n z-score: $Z_i = \frac{X_i - \mu_i}{\sigma_i}$ donde $Z_i$ es la variable estandarizada, $X_i$ la variable original, $\mu_i$ la media y $\sigma_i$ la desviaci√≥n est√°ndar.

Esta estandarizaci√≥n es cr√≠tica porque el an√°lisis de componentes principales se fundamenta en la varianza de los datos: sin estandarizar, variables con escalas num√©ricas mayores (como poblaci√≥n total en millones) dominar√≠an el c√°lculo de componentes, distorsionando la interpretaci√≥n y otorgando influencia desproporcionada a magnitudes en lugar de patrones (LinkedIn, 2023; Ciencia de Datos, 2016). Adicionalmente, la estandarizaci√≥n garantiza que el an√°lisis capture relaciones entre variables y no simplemente diferencias en escala.

### An√°lisis de Componentes Principales (ACP)

Con las 17 variables estandarizadas, se aplica el An√°lisis de Componentes Principales para transformar el conjunto de variables originales, potencialmente correlacionadas, en un conjunto menor de componentes principales ortogonales (Jolliffe, 2002; OpenWebinars, 2025). El ACP identifica las direcciones en el espacio de datos donde la varianza es m√°xima, creando nuevas dimensiones (componentes) que son combinaciones lineales ponderadas de las variables originales (Jolliffe, 2002; KeepCoding, 2025).

Matem√°ticamente, el ACP comienza construyendo la matriz de covarianza $C$ de las variables estandarizadas, cuyas entradas representan c√≥mo var√≠an conjuntamente pares de variables (KeepCoding, 2025). Los vectores propios de esta matriz de covarianza definen las direcciones principales (componentes), ordenados seg√∫n sus correspondientes valores propios, que representan la cantidad de varianza explicada en cada direcci√≥n (Jolliffe, 2002). El primer componente principal captura la m√°xima varianza; el segundo, la m√°xima varianza restante sujeto a ortogonalidad respecto al primero; y as√≠ sucesivamente (Jolliffe, 2002).

El objetivo es identificar cu√°ntos componentes son necesarios para capturar la mayor parte de la varianza total de los datos‚Äît√≠picamente entre 70-90% seg√∫n el contexto (OpenWebinars, 2025). Esto permite reducir significativamente la dimensionalidad: en lugar de trabajar con 17 variables potencialmente redundantes, se trabaja con un n√∫mero reducido de componentes sint√©ticos que capturan la esencia de la heterogeneidad internacional (Jolliffe, 2002).

### C√°lculo de Distancias Euclidianas

Una vez obtenidos los componentes principales, se utiliza la distancia euclidiana como m√©trica de disimilaridad entre pa√≠ses. Para cada par de pa√≠ses, la distancia euclidiana se calcula como:

$$ d_{ij} = \sqrt{\sum_{k=1}^{p} (PC_{ik} - PC_{jk})^2} $$ Donde:

-   $d_{ij}$ = Distancia euclidiana entre los pa√≠ses $i$ y $j$
-   $p$ = N√∫mero de componentes principales utilizados
-   $PC_{ik}$ = Valor del $k$-√©simo componente principal para el pa√≠s $i$
-   $PC_{jk}$ = Valor del $k$-√©simo componente principal para el pa√≠s $j$

Esta distancia mide la proximidad multidimensional entre pa√≠ses: distancias peque√±as indican perfiles similares, distancias grandes indican disimilaridad (Universidad de Granada, 2016; ArcGIS, 2024).

La distancia euclidiana es particularmente apropiada para el m√©todo de Ward porque, en su implementaci√≥n aglomerativa, se utiliza el cuadrado de la distancia euclidiana‚Äîformalmente conocida como "distancia euclidiana semicuadrada"‚Äîcomo medida de disimilaridad (Ward, 1963; Wikipedia, 2013; TIBCO, 2024).

### Clusterizaci√≥n Jer√°rquica Aglomerativa con M√©todo de Ward

El m√©todo de Ward es un algoritmo jer√°rquico aglomerativo que opera iterativamente sobre el conjunto de pa√≠ses para formar una jerarqu√≠a de clusters (Ward, 1963). El procedimiento inicia considerando cada pa√≠s como un cluster individual independiente, creando n grupos iniciales. En cada iteraci√≥n subsecuente, se identifican los dos clusters m√°s pr√≥ximos seg√∫n el criterio de Ward y se fusionan en un √∫nico cluster m√°s grande (Ward, 1963; Universidad de Granada, 2016; ICESI, 2025).

El criterio de Ward minimiza espec√≠ficamente la suma total de cuadrados dentro de los clusters (within-cluster sum of squares, WCSS). Matem√°ticamente, en cada paso, Ward selecciona el par de clusters cuya fusi√≥n produce el incremento m√≠nimo en la varianza total intra-cluster (Ward, 1963; Wikipedia, 2013).

El algoritmo se ejecuta recursivamente hasta que todos los pa√≠ses quedan englobados en un √∫nico cluster. El resultado es un dendrograma‚Äîdiagrama en forma de √°rbol invertido‚Äîque visualiza el proceso completo de fusi√≥n: cada rama representa un pa√≠s individual, cada nodo de fusi√≥n representa la uni√≥n de dos clusters, y la altura de cada nodo indica el nivel de disimilaridad en el cual ocurri√≥ la fusi√≥n (Universidad de Granada, 2016; ICESI, 2025). El dendrograma permite identificar visualmente el n√∫mero √≥ptimo de clusters "cortando" el √°rbol a un nivel espec√≠fico de altura, determinando as√≠ cu√°ntos grupos finales son m√°s interpretables y √∫tiles (Ward, 1963; Universidad de Granada, 2016).

En s√≠ntesis, el modelo integra: (1) estandarizaci√≥n para igualar contribuciones relativas, (2) reducci√≥n de dimensionalidad mediante ACP para simplificar sin perder informaci√≥n, (3) c√°lculo de distancias euclidianas para cuantificar disimilaridad, y (4) clusterizaci√≥n jer√°rquica Ward para crear una taxonom√≠a multidimensional de desarrollo. Esta arquitectura metodol√≥gica asegura que los agrupamientos emergentes sean producto exclusivamente de los datos y no de imposiciones externas, permitiendo descubrimientos genuinos sobre la estructura del desarrollo internacional (Jolliffe, 2002; Charrad et al., 2014).

------------------------------------------------------------------------

# An√°lisis Descriptivo

Antes de aplicar la reducci√≥n dimensional mediante An√°lisis de Componentes Principales y revelar agrupamientos multidimensionales de pa√≠ses, es fundamental explorar c√≥mo se distribuyen y relacionan los indicadores individuales en el espacio observable. El an√°lisis descriptivo identifica relaciones preliminares, heterogeneidades sistem√°ticas y anomal√≠as en cada dimensi√≥n del desarrollo‚Äîinformaci√≥n que prepara conceptualmente para el descubrimiento de clusters coherentes. En esencia: mientras que el ACP responder√° "¬øqu√© estructura latente subyace en los datos?", el an√°lisis descriptivo responde "¬øqu√© patrones visibles anticipan esa estructura?" Las cinco dimensiones tem√°ticas‚Äîecon√≥mica, de salud, tecnol√≥gica, ambiental y demogr√°fica‚Äîse examinan secuencialmente a trav√©s de visualizaciones interactivas que revelan l√≠deres y rezagados en cada indicador, patrones de asociaci√≥n entre variables dentro de dimensiones, y diferencias regionales que anticipan los agrupamientos posteriores. Este enfoque dimensional permite reconocer que el "desarrollo" no es una variable √∫nica sino un fen√≥meno multifac√©tico donde pa√≠ses pueden destacar en algunas √°reas mientras quedan rezagados en otras‚Äîprecisamente la complejidad que justifica un an√°lisis multivariado integrado.

## Explorador Interactivo de Indicadores

Con el prop√≥sito de facilitar el an√°lisis exploratorio de cada una de las 17 variables de desarrollo de forma individual, se ha desarrollado un explorador interactivo que permite examinar din√°micamente la distribuci√≥n, dispersi√≥n y rankings de cada indicador. Esta herramienta opera sobre todo el dataset y proporciona tres niveles de informaci√≥n complementarios: (1) estad√≠sticas globales que resumen la concentraci√≥n y dispersi√≥n de cada variable (media, mediana, desviaci√≥n est√°ndar, percentiles), (2) ranking de los 10 pa√≠ses l√≠deres en cada indicador, y (3) variabilidad porcentual respecto a la media, que cuantifica cu√°nto cada pa√≠s se desv√≠a del patr√≥n global.

El explorador funciona mediante un sistema de pesta√±as interactivas: selecciona cualquier variable haciendo click en sus botonespara visualizar simult√°neamente las estad√≠sticas agregadas y el top 10 de desempe√±o. Esta estructura permite identificar patrones preliminares de concentraci√≥n, identificar outliers extremos, y reconocer diferenciaciones regionales antes de proceder al an√°lisis multidimensional integrado. A continuaci√≥n se presentan dos ejemplos ilustrativos que ejemplifican la heterogeneidad fundamental del desarrollo global.

```{r preparar-datos-unificados}

variables_numericas <- names(Base_2022)[3:ncol(Base_2022)]

crear_tabla_unificada <- function(data, variable) {
  valores <- data[[variable]]
  
  total_paises <- sum(!is.na(valores))
  media <- round(mean(valores, na.rm = TRUE), 2)
  mediana <- round(median(valores, na.rm = TRUE), 2)
  desv_est <- round(sd(valores, na.rm = TRUE), 2)
  q1 <- round(quantile(valores, 0.25, na.rm = TRUE), 2)
  q3 <- round(quantile(valores, 0.75, na.rm = TRUE), 2)
  minimo <- round(min(valores, na.rm = TRUE), 2)
  maximo <- round(max(valores, na.rm = TRUE), 2)
  
  top10 <- data %>%
    select(Pais, Valor = all_of(variable)) %>%
    arrange(desc(Valor)) %>%
    head(10) %>%
    mutate(
      Ranking = row_number(),
      Pct_vs_Media = round((Valor / media - 1) * 100, 1)
    )
  
  estadisticas <- data.frame(
    M√©trica = c("Total Pa√≠ses", "Media", "Mediana", "Desv. Est.", 
                "Q1", "Q3", "M√≠nimo", "M√°ximo"),
    Valor = c(total_paises, media, mediana, desv_est, q1, q3, minimo, maximo)
  )
  
  top10_tabla <- top10 %>%
    mutate(
      Pct_Display = paste0(ifelse(Pct_vs_Media >= 0, "+", ""), Pct_vs_Media, "%"),
      Pct_Color = ifelse(Pct_vs_Media >= 0, "#00e676", "#ff1744")
    ) %>%
    select(Ranking, Pa√≠s = Pais, Valor, Pct_Display, Pct_Color)
  
  list(estadisticas = estadisticas, top10 = top10_tabla)
}
```

```{=html}
<style>
/* OCULTAR N√öMEROS DE SECCIONES EN PESTA√ëAS */
.section-number {
  display: none !important;
}

#TOC .toc-section-number {
  display: none !important;
}

h4 .header-section-number {
  display: none !important;
}

/* Contenedor de pesta√±as mejorado */
.nav-pills {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 12px !important;
  padding: 25px !important;
  background: linear-gradient(135deg, #0a0e1a 0%, #12161f 100%) !important;
  border-radius: 15px !important;
  border: 2px solid rgba(0, 229, 255, 0.3) !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
  margin-bottom: 30px !important;
}

.nav-pills > li {
  margin: 0 !important;
  list-style: none !important;
}

.nav-pills > li > a {
  background: linear-gradient(135deg, #12161f 0%, #0d1117 100%) !important;
  color: #e0e6ed !important;
  border: 2px solid #00e5ff !important;
  border-radius: 10px !important;
  padding: 14px 22px !important;
  font-size: 14px !important;
  font-weight: 600 !important;
  text-align: center !important;
  min-width: 160px !important;
  transition: all 0.3s ease !important;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5) !important;
  text-decoration: none !important;
  display: block !important;
}

.nav-pills > li > a:hover {
  background: linear-gradient(135deg, #00e5ff 0%, #0084ff 100%) !important;
  color: #000 !important;
  border-color: #00ffff !important;
  transform: translateY(-4px) !important;
  box-shadow: 0 8px 25px rgba(0, 229, 255, 0.6) !important;
}

.nav-pills > li.active > a,
.nav-pills > li.active > a:hover,
.nav-pills > li.active > a:focus {
  background: linear-gradient(135deg, #00e5ff 0%, #0084ff 100%) !important;
  color: #000 !important;
  border-color: #00ffff !important;
  box-shadow: 0 0 30px rgba(0, 229, 255, 0.8) !important;
  font-weight: 700 !important;
}

/* Layout de dos columnas lado a lado */
.two-column-layout {
  display: grid;
  grid-template-columns: 48% 48%;
  gap: 30px;
  margin-top: 25px;
  justify-content: center;
}

@media (max-width: 1200px) {
  .two-column-layout {
    grid-template-columns: 1fr;
  }
}

/* Contenedores de tablas */
.table-container {
  background: linear-gradient(135deg, #0a0e1a 0%, #0d1117 100%);
  border: 2px solid rgba(0, 229, 255, 0.3);
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7);
}

.section-title {
  color: #00e5ff;
  font-size: 1.3em;
  font-weight: 700;
  margin-bottom: 20px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  text-align: center;
  text-shadow: 0 0 15px rgba(0, 229, 255, 0.5);
  padding-bottom: 12px;
  border-bottom: 2px solid rgba(0, 229, 255, 0.3);
}
</style>
```

### Selecciona una Variable {.tabset .tabset-pills .unnumbered}

```{r tablas-layout, results='asis'}
for (variable in variables_numericas) {
  cat(sprintf('\n\n#### %s {.unnumbered}\n\n', variable))
  
  datos <- crear_tabla_unificada(Base_2022, variable)
  
  cat('<div class="two-column-layout">\n\n')
  
  cat('<div class="table-container">\n\n')
  
  cat('<p class="section-title"> Estad√≠sticas Globales</p>\n\n')
  
  tabla_stats <- datos$estadisticas %>%
    kbl(
      align = c('l', 'r'), 
      escape = FALSE,
      col.names = c("M√©trica", "Valor")
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = TRUE,
      font_size = 13
    ) %>%
    row_spec(0, background = "#00e5ff", color = "#000", bold = TRUE, font_size = 14) %>%
    row_spec(1, background = "#12161f", color = "#00e5ff", bold = TRUE, font_size = 14) %>%
    row_spec(2:8, background = "#0d1117", color = "#e0e6ed") %>%
    column_spec(1, width = "14em", bold = TRUE, color = "#e0e6ed") %>%
    column_spec(2, width = "10em", color = "#00e5ff", bold = TRUE)
  
  print(tabla_stats)
  
  cat('\n\n</div>\n\n')
  
  cat('<div class="table-container">\n\n')
  
  cat('<p class="section-title"> Top 10 Pa√≠ses</p>\n\n')
  
  tabla_top10_data <- datos$top10 %>%
    mutate(
      Pct_Display_Colored = cell_spec(
        Pct_Display,
        "html",
        color = Pct_Color,
        bold = TRUE
      )
    ) %>%
    select(`#` = Ranking, Pa√≠s, Valor, `% vs Media` = Pct_Display_Colored)
  
  tabla_top10 <- tabla_top10_data %>%
    kbl(
      align = c('c', 'l', 'r', 'c'), 
      escape = FALSE
    ) %>%
    kable_styling(
      bootstrap_options = c("striped", "hover"),
      full_width = TRUE,
      font_size = 13
    ) %>%
    row_spec(0, background = "#0084ff", color = "#000", bold = TRUE, font_size = 14) %>%
    row_spec(1:10, background = "#0d1117", color = "#e0e6ed") %>%
    column_spec(1, width = "3em", bold = TRUE, color = "#000", background = "#00e5ff") %>%
    column_spec(2, width = "13em", bold = TRUE) %>%
    column_spec(3, width = "9em", color = "#00e5ff", bold = TRUE)
  
  print(tabla_top10)
  
  cat('\n\n</div>\n\n')
  
  cat('</div>\n\n')
}
```

El an√°lisis del conjunto de los indicadores revela una caracter√≠stica fundamental: la desigualdad internacional no es uniforme sino espec√≠fica a cada dimensi√≥n de desarrollo. Mientras que el PIB per c√°pita muestra una concentraci√≥n extrema (media \$17,045.36 vs. mediana \$6,705.15, indicando que el 50% de pa√≠ses est√° por debajo de apenas \$6,705), la poblaci√≥n exhibe un patr√≥n radicalmente distinto de concentraci√≥n geogr√°fica en gigantes asi√°ticos (media 49.6 millones vs. mediana 10.4 millones). Esta variabilidad espec√≠fica a cada variable es precisamente lo que genera la complejidad multidimensional del desarrollo: pa√≠ses pueden sobresalir en algunas √°reas (por ejemplo, esperanza de vida alta pero PIB bajo, como Costa Rica) mientras quedan rezagados en otras (por ejemplo, PIB alto pero vulnerabilidad ambiental, como algunos productores de petr√≥leo). El explorador revela estas heterogeneidades al visualizar que en algunas variables existe concentraci√≥n extrema (desv. est. \> 3x la media), mientras que en otras la dispersi√≥n es m√°s moderada, lo que puede indicar que el ACP identificar√° dimensiones donde la varianza es m√°xima y donde se concentra realmente la diferencia internacional.

## An√°lisis por Dimensiones

### Dimensi√≥n Econ√≥mica

A continuaci√≥n se examinan siete indicadores econ√≥micos complementarios mediante un explorador interactivo que permite visualizar din√°micamente los top 15 pa√≠ses en cada m√©trica. Haz click en cualquier bot√≥n de variable (PIB per c√°pita, Crecimiento PIB, Inversi√≥n Extranjera, Remesas, Industria, Exportaciones, Importaciones) para cambiar el ranking y observar c√≥mo la composici√≥n del liderazgo econ√≥mico global cambia radicalmente seg√∫n la dimensi√≥n analizada. Esta variabilidad espec√≠fica a cada variable econ√≥mica anticipa que el An√°lisis de Componentes Principales identificar√° factores latentes que sintetizan estas dimensiones de forma coherente, revelando la verdadera estructura de la diferenciaci√≥n econ√≥mica internacional.

Al seleccionar diferentes indicadores mediante los botones de variable, se modifica el orden de los pa√≠ses en el ranking. Este comportamiento evidencia que la posici√≥n relativa de cada pa√≠s var√≠a seg√∫n la m√©trica considerada, lo que refleja que el concepto de una ‚Äúeconom√≠a fuerte‚Äù puede adoptar significados distintos dependiendo del criterio de evaluaci√≥n utilizado.

```{r economia-top15-interactivo-MEJORADO, fig.height=7, fig.width=30, out.width="100%"}

preparar_top15 <- function(data, variable, nombre_var) {
  resultado <- data %>%
    filter(!is.na(!!sym(variable)) & !!sym(variable) > 0) %>%
    arrange(desc(!!sym(variable))) %>%
    slice_head(n = 15) %>%
    arrange(!!sym(variable)) %>%
    mutate(
      Pais_label = Pais,
      Valor = !!sym(variable),
      Nombre_Variable = nombre_var
    ) %>%
    select(Pais_label, Valor, Nombre_Variable)
  
  return(resultado)
}

vars_config <- list(
  list(var = "PIB_per", nombre = "PIB per c√°pita (US$)", color = "#00e676"),
  list(var = "Crecimiento PIB", nombre = "Crecimiento PIB (% anual)", color = "#0084ff"),
  list(var = "Inversion extranjera", nombre = "Inversi√≥n Extranjera Directa (% PIB)", color = "#ffd600"),
  list(var = "Remesas", nombre = "Remesas recibidas (% PIB)", color = "#a259ff"),
  list(var = "Industria", nombre = "Industria (% PIB)", color = "#ff6b00"),
  list(var = "Exportaciones", nombre = "Exportaciones (% PIB)", color = "#00e5ff"),
  list(var = "Importaciones", nombre = "Importaciones (% PIB)", color = "#ff1744")
)

datasets <- lapply(seq_along(vars_config), function(i) {
  config <- vars_config[[i]]
  preparar_top15(Base_2022, config$var, config$nombre)
})

p <- plot_ly()

for (i in seq_along(vars_config)) {
  config <- vars_config[[i]]
  
  if(nrow(datasets[[i]]) > 0) {
    p <- p %>%
      add_trace(
        x = datasets[[i]]$Valor,
        y = datasets[[i]]$Pais_label,
        type = 'bar',
        orientation = 'h',
        marker = list(
          color = config$color, 
          line = list(color = '#ffffff', width = 1.5)
        ),
        text = format(round(datasets[[i]]$Valor, 2), big.mark = ",", scientific = FALSE),
        textposition = 'outside',
        textfont = list(color = '#00e5ff', size = 13, family = "Arial"),
        customdata = datasets[[i]]$Nombre_Variable,
        # ‚úÖ Hover template CORREGIDO - colores que siempre contrastan
        hovertemplate = paste0(
          "<b style='color:#000000; font-size:14px; background-color:#ffffff; padding:5px; border-radius:3px;'>%{y}</b><br>",
          "<span style='color:#1a1a1a;'><b>%{customdata}:</b></span><br>",
          "<b style='color:#b35900; font-size:16px;'>%{x:.2f}</b>",
          "<extra></extra>"
        ),
        name = config$nombre,
        visible = (i == 1),
        showlegend = FALSE
      )
  }
}

p %>%
  layout(
    title = list(
      text = paste0(
        "<b style='color:#00e5ff; font-size:24px;'>Top 15 Pa√≠ses - ", 
        vars_config[[1]]$nombre, 
        "</b><br>",
        "<span style='color:#8b92a0; font-size:14px;'>A√±o 2022 | Selecciona una variable para cambiar</span>"
      ),
      x = 0.5,
      xanchor = 'center',
      y = 0.95
    ),
    xaxis = list(
      title = paste0("<b style='font-size:16px;'>", vars_config[[1]]$nombre, "</b>"),
      gridcolor = '#12161f',
      showgrid = TRUE,
      zeroline = TRUE,
      zerolinewidth = 2,
      zerolinecolor = "rgba(0, 229, 255, 0.5)",
      tickfont = list(color = '#8b92a0', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16),
      range = c(0, max(datasets[[1]]$Valor) * 1.15)
    ),
    
    yaxis = list(
      title = "<b style='font-size:16px;'>Pa√≠s</b>",
      tickfont = list(color = '#e0e6ed', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16),
      categoryorder = "array",
      categoryarray = rev(datasets[[1]]$Pais_label),
      automargin = TRUE
    ),
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 13),
    margin = list(l = 180, r = 50, b = 80, t = 120),
    hovermode = 'closest',
    hoverlabel = list(
      bgcolor = "#ffffff",
      bordercolor = "#00e5ff",
      font = list(color = "#000000", size = 13, family = "Arial")
    ),
    
    updatemenus = list(
      list(
        buttons = lapply(seq_along(vars_config), function(i) {
          config <- vars_config[[i]]
          
          visible <- rep(FALSE, length(vars_config))
          visible[i] <- TRUE
          
          list(
            label = strsplit(config$nombre, " \\(")[[1]][1],
            method = "update",
            args = list(
              list(visible = visible),
              list(
                title = paste0(
                  "<b style='color:#00e5ff; font-size:24px;'>Top 15 Pa√≠ses - ", 
                  config$nombre, 
                  "</b><br>",
                  "<span style='color:#8b92a0; font-size:14px;'>A√±o 2022 | Selecciona una variable para cambiar</span>"
                ),
                "xaxis.title" = paste0("<b style='font-size:16px;'>", config$nombre, "</b>"),
                "xaxis.range" = c(0, max(datasets[[i]]$Valor) * 1.15),
                "yaxis.categoryarray" = rev(datasets[[i]]$Pais_label)
              )
            )
          )
        }),
        
        direction = "down",
        pad = list(r = 10, t = 10),
        showactive = TRUE,
        x = 0.02,
        xanchor = "left",
        y = 1.02,
        yanchor = "bottom",
        bgcolor = "rgba(162, 89, 255, 0.25)",
        bordercolor = "#a259ff",
        borderwidth = 2,
        font = list(size = 12, color = "#a259ff", family = "Arial")
      )
    )
  ) %>%
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "top15_economia_2022",
      width = 1600,
      height = 900
    )
  )
```

El an√°lisis de los distintos indicadores revela una marcada heterogeneidad entre pa√≠ses. Aquellos que lideran en una m√©trica no necesariamente mantienen posiciones similares en otras. Por ejemplo, Noruega encabeza el PIB per c√°pita, mientras que el crecimiento econ√≥mico destaca en pa√≠ses distintos; Malta sobresale en inversi√≥n extranjera y Nepal en remesas.

La composici√≥n del top 15 var√≠a seg√∫n el indicador: las econom√≠as europeas dominan en PIB per c√°pita, pero en crecimiento, inversi√≥n o remesas surgen pa√≠ses de otras regiones. Adem√°s, las magnitudes y dispersiones difieren entre variables, lo que sugiere que cada indicador refleja dimensiones particulares del desempe√±o econ√≥mico nacional.

### Dimensi√≥n Salud y Bienestar

La Figura XX presenta la relaci√≥n bidimensional entre esperanza de vida al nacer y mortalidad infantil, dos indicadores fundamentales del desempe√±o sanitario global. Estos indicadores capturan realidades complementarias: mientras la esperanza de vida refleja el resultado acumulado de mejoras en salud a lo largo de toda la vida, la mortalidad infantil es particularmente sensible a la calidad inmediata de la atenci√≥n materno-infantil, acceso a saneamiento e infraestructura b√°sica (WHO, 2020).

El gr√°fico interactivo es especialmente informativo: al pasar el cursor sobre cada punto (pa√≠s), se despliegan simult√°neamente tres dimensiones de salud‚Äîesperanza de vida, mortalidad infantil y gasto p√∫blico en salud‚Äîpermitiendo identificar si los pa√≠ses con mejor desempe√±o en longevidad genuinamente invierten recursos en su sistema de salud o si tienen patrones an√≥malos.

```{r ev-mi-animado, fig.height=8, fig.width=28, out.width="100%"}
# Asignar continentes
asignar_continentes <- function(data) {
  continentes_map <- c(
    "Argentina" = "Americas", "Bahamas, The" = "Americas", "Barbados" = "Americas",
    "Belize" = "Americas", "Bolivia" = "Americas", "Brazil" = "Americas",
    "Canada" = "Americas", "Chile" = "Americas", "Colombia" = "Americas",
    "Costa Rica" = "Americas", "Cuba" = "Americas", "Dominica" = "Americas",
    "Dominican Republic" = "Americas", "Ecuador" = "Americas", "El Salvador" = "Americas",
    "Grenada" = "Americas", "Guatemala" = "Americas", "Guyana" = "Americas",
    "Haiti" = "Americas", "Honduras" = "Americas", "Jamaica" = "Americas",
    "Mexico" = "Americas", "Nicaragua" = "Americas", "Panama" = "Americas",
    "Paraguay" = "Americas", "Peru" = "Americas", "St. Kitts and Nevis" = "Americas",
    "St. Lucia" = "Americas", "St. Vincent and the Grenadines" = "Americas",
    "Suriname" = "Americas", "Trinidad and Tobago" = "Americas", "United States" = "Americas",
    "Uruguay" = "Americas", "Venezuela, RB" = "Americas", "Antigua and Barbuda" = "Americas",
    
    "Albania" = "Europe", "Austria" = "Europe", "Belarus" = "Europe",
    "Belgium" = "Europe", "Bosnia and Herzegovina" = "Europe", "Bulgaria" = "Europe",
    "Croatia" = "Europe", "Cyprus" = "Europe", "Czech Republic" = "Europe",
    "Czechia" = "Europe", "Denmark" = "Europe", "Estonia" = "Europe",
    "Finland" = "Europe", "France" = "Europe", "Germany" = "Europe",
    "Greece" = "Europe", "Hungary" = "Europe", "Iceland" = "Europe",
    "Ireland" = "Europe", "Italy" = "Europe", "Kosovo" = "Europe",
    "Latvia" = "Europe", "Lithuania" = "Europe", "Luxembourg" = "Europe",
    "Malta" = "Europe", "Montenegro" = "Europe", "Netherlands" = "Europe",
    "North Macedonia" = "Europe", "Norway" = "Europe", "Poland" = "Europe",
    "Portugal" = "Europe", "Russian Federation" = "Europe", "Serbia" = "Europe",
    "Slovak Republic" = "Europe", "Slovakia" = "Europe", "Slovenia" = "Europe",
    "Spain" = "Europe", "Sweden" = "Europe", "Switzerland" = "Europe",
    "Turkey" = "Europe", "Turkiye" = "Europe", "Ukraine" = "Europe",
    "United Kingdom" = "Europe", "Armenia" = "Europe", "Azerbaijan" = "Europe",
    "Georgia" = "Europe", "Moldova" = "Europe", "Romania" = "Europe",
    "San Marino" = "Europe",
    
    "Afghanistan" = "Asia", "Bahrain" = "Asia", "Bangladesh" = "Asia",
    "Bhutan" = "Asia", "Brunei Darussalam" = "Asia", "Cambodia" = "Asia",
    "China" = "Asia", "Hong Kong SAR, China" = "Asia", "India" = "Asia",
    "Indonesia" = "Asia", "Iran, Islamic Rep." = "Asia", "Iraq" = "Asia",
    "Israel" = "Asia", "Japan" = "Asia", "Jordan" = "Asia",
    "Kazakhstan" = "Asia", "Korea, Dem. People's rep." = "Asia", "Korea, Rep." = "Asia",
    "Kuwait" = "Asia", "Kyrgyz Republic" = "Asia", "Lao PDR" = "Asia",
    "Lebanon" = "Asia", "Macao SAR, China" = "Asia", "Malaysia" = "Asia",
    "Maldives" = "Asia", "Mongolia" = "Asia", "Myanmar" = "Asia",
    "Nepal" = "Asia", "Oman" = "Asia", "Pakistan" = "Asia",
    "Philippines" = "Asia", "Qatar" = "Asia", "Saudi Arabia" = "Asia",
    "Singapore" = "Asia", "Sri Lanka" = "Asia", "Syrian Arab Republic" = "Asia",
    "Taiwan" = "Asia", "Tajikistan" = "Asia", "Thailand" = "Asia",
    "Timor-Leste" = "Asia", "Turkmenistan" = "Asia", "United Arab Emirates" = "Asia",
    "Uzbekistan" = "Asia", "Vietnam" = "Asia", "Viet Nam" = "Asia",
    "West Bank and Gaza" = "Asia", "Yemen, Rep." = "Asia",
    
    "Algeria" = "Africa", "Angola" = "Africa", "Benin" = "Africa",
    "Botswana" = "Africa", "Burkina Faso" = "Africa", "Burundi" = "Africa",
    "Cabo Verde" = "Africa", "Cameroon" = "Africa", "Central African Republic" = "Africa",
    "Chad" = "Africa", "Comoros" = "Africa", "Congo, Dem. Rep." = "Africa",
    "Congo, Rep." = "Africa", "Cote d'Ivoire" = "Africa", "Djibouti" = "Africa",
    "Egypt, Arab Rep." = "Africa", "Equatorial Guinea" = "Africa", "Eritrea" = "Africa",
    "Eswatini" = "Africa", "Ethiopia" = "Africa", "Gabon" = "Africa",
    "Gambia, The" = "Africa", "Ghana" = "Africa", "Guinea" = "Africa",
    "Guinea-Bissau" = "Africa", "Kenya" = "Africa", "Lesotho" = "Africa",
    "Liberia" = "Africa", "Libya" = "Africa", "Madagascar" = "Africa",
    "Malawi" = "Africa", "Mali" = "Africa", "Mauritania" = "Africa",
    "Mauritius" = "Africa", "Morocco" = "Africa", "Mozambique" = "Africa",
    "Namibia" = "Africa", "Niger" = "Africa", "Nigeria" = "Africa",
    "Rwanda" = "Africa", "Senegal" = "Africa", "Sierra Leone" = "Africa",
    "Somnia" = "Africa", "South Africa" = "Africa", "South Sudan" = "Africa",
    "Sudan" = "Africa", "Tanzania" = "Africa", "Togo" = "Africa",
    "Tunisia" = "Africa", "Uganda" = "Africa", "Zambia" = "Africa",
    "Zimbabwe" = "Africa",
    
    "Australia" = "Oceania", "Fiji" = "Oceania", "Kiribati" = "Oceania",
    "Marshall Islands" = "Oceania", "Micronesia, Fed. Sts." = "Oceania",
    "New Zealand" = "Oceania", "Palau" = "Oceania", "Samoa" = "Oceania",
    "Solomon Islands" = "Oceania", "Tonga" = "Oceania", "Vanuatu" = "Oceania"
  )
  
  data %>%
    mutate(Continente = ifelse(Pais %in% names(continentes_map),
                                continentes_map[Pais], NA))
}

# Preparar datos - SOLO VARIABLES DE SALUD
datos_ev_mi <- Base_2022 %>%
  asignar_continentes() %>%
  filter(!is.na(`Esperanza vida`) & 
         !is.na(`Mortalidad infantil`) & 
         !is.na(`Gasto salud`) &
         !is.na(Continente)) %>%
  select(Pais, Continente, `Esperanza vida`, `Mortalidad infantil`, `Gasto salud`) %>%
  mutate(
    # ‚úÖ TOOLTIP CON EL MISMO DISE√ëO QUE EL GR√ÅFICO DE CONECTIVIDAD
    tooltip = paste0(
      "<b style='font-size:14px; color:#00e5ff;'>", Pais, "</b><br>",
      "<span style='color:#a259ff; font-size:11px;'>", Continente, "</span><br><br>",
      "<b style='color:#ffd600;'> INDICADORES DE SALUD:</b><br>",
      "‚îú‚îÄ Esperanza de vida: <b style='color:#00e676;'>", 
      round(`Esperanza vida`, 1), " a√±os</b><br>",
      "‚îú‚îÄ Mortalidad infantil: <b style='color:#ff1744;'>", 
      round(`Mortalidad infantil`, 1), "/1,000</b><br>",
      "‚îî‚îÄ Gasto en salud: <b style='color:#ffd600;'>", 
      round(`Gasto salud`, 2), "% PIB</b>"
    )
  )

# Crear gr√°fico scatter optimizado al m√°ximo
p <- plot_ly(
  data = datos_ev_mi,
  x = ~`Esperanza vida`,
  y = ~`Mortalidad infantil`,
  color = ~Continente,
  colors = c(
    "Americas" = "green",
    "Europe" = "#0084ff",
    "Asia" = "#ffd600",
    "Africa" = "#ff1744",
    "Oceania" = "#a259ff"
  ),
  type = 'scatter',
  mode = 'markers',
  customdata = ~tooltip,
  hovertemplate = "%{customdata}<extra></extra>",
  marker = list(
    size = 14,  # Marcadores a√∫n m√°s grandes
    opacity = 0.9,
    line = list(color = '#ffffff', width = 2)
  ),
  showlegend = TRUE
) %>%
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:24px;'>Salud Poblacional: Esperanza de Vida vs Mortalidad Infantil</b><br>
               <span style='color:#8b92a0; font-size:14px;'>A√±o 2022 | Relaci√≥n inversa: mejor salud = mayor EV y menor MI</span>",
      x = 0.5,
      xanchor = 'center',
      y = 0.95
    ),
    
    xaxis = list(
      title = "<b style='font-size:16px;'>Esperanza de vida al nacer (a√±os)</b>",
      gridcolor = '#12161f',
      showgrid = TRUE,
      zeroline = FALSE,
      range = c(40, 90),  # Rango m√°s amplio
      tickfont = list(color = '#8b92a0', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16)
    ),
    
    yaxis = list(
      title = "<b style='font-size:16px;'>Mortalidad infantil (por 1,000 nacidos vivos)</b>",
      gridcolor = '#12161f',
      showgrid = TRUE,
      zeroline = FALSE,
      range = c(0, 110),
      tickfont = list(color = '#8b92a0', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16)
    ),
    
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 13),
    
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    
    legend = list(
      title = list(text = "<b style='font-size:14px;'>Continente</b>", font = list(size = 14, color = "#00e5ff")),
      bgcolor = 'rgba(10,14,26,0.95)',
      bordercolor = '#00e5ff',
      borderwidth = 2,
      x = 0.99,  # M√°s pegado al borde derecho
      y = 0.99,  # M√°s pegado al borde superior
      xanchor = "right",
      yanchor = "top",
      font = list(size = 13, color = "#e0e6ed")
    ),
    
    margin = list(l = 80, r = 120, b = 60, t = 100),  # Margen derecho reducido
    
    hovermode = 'closest',
    

    shapes = list(

      list(
        type = "rect",
        x0 = 75, x1 = 90,
        y0 = 0, y1 = 15,
        xref = "x", yref = "y",
        fillcolor = "rgba(0, 230, 118, 0.15)",
        line = list(color = "rgba(0, 230, 118, 0.7)", width = 2.5, dash = "dot"),
        layer = "below"
      ),
      
      # Zona CR√çTICA
      list(
        type = "rect",
        x0 = 40, x1 = 65,
        y0 = 40, y1 = 110,
        xref = "x", yref = "y",
        fillcolor = "rgba(255, 23, 68, 0.15)",
        line = list(color = "rgba(255, 23, 68, 0.7)", width = 2.5, dash = "dot"),
        layer = "below"
      )
    ),
    
    annotations = list(
      # Anotaci√≥n ZONA √ìPTIMA
      list(
        x = 82.5, 
        y = 25,  # Mover m√°s arriba para evitar superposici√≥n
        text = "<b style='color:#00e676; font-size:13px;'>‚úì ZONA √ìPTIMA</b><br><span style='color:#00e676; font-size:11px;'>Alta EV + Baja MI</span>",
        showarrow = FALSE,
        bgcolor = "rgba(0, 230, 118, 0.25)",
        bordercolor = "#00e676",
        borderwidth = 2,
        borderpad = 8,
        font = list(size = 11),
        xanchor = "center"
      ),
      
      # Anotaci√≥n ZONA CR√çTICA
      list(
        x = 52.5, 
        y = 95,  # Mover m√°s abajo para evitar superposici√≥n
        text = "<b style='color:#ff1744; font-size:13px;'>‚ö† ZONA CR√çTICA</b><br><span style='color:#ff1744; font-size:11px;'>Baja EV + Alta MI</span>",
        showarrow = FALSE,
        bgcolor = "rgba(255, 23, 68, 0.25)",
        bordercolor = "#ff1744",
        borderwidth = 2,
        borderpad = 8,
        font = list(size = 11),
        xanchor = "center"
      ),
      
      # Anotaci√≥n explicativa
      list(
        x = 0.02,
        y = -0.12,
        text = "<span style='color:#8b92a0; font-size:11px;'>Cada punto representa un pa√≠s | Arrastra para zoom | Doble click para resetear</span>",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        xanchor = "left"
      ),
      
      # Anotaci√≥n de correlaci√≥n (valor a√±adido)
      list(
        x = 0.98,
        y = -0.12,
        text = "<span style='color:#8b92a0; font-size:11px;'>Correlaci√≥n inversa fuerte: r = ~ -0.85</span>",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        xanchor = "right"
      )
    )
  ) %>%
  
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "salud_poblacional_2022",
      width = 1800,  # Mayor resoluci√≥n
      height = 1000
    )
  )

p
```

La gr√°fica evidencia una segregaci√≥n geogr√°fica pronunciada: los paises Europa y Ocean√≠a se concentran casi completamente en la zona √≥ptima, formando un grupo de alta longevidad y baja mortalidad infantil. En contraste, muchos paises de √Åfrica ocupan predominantemente la zona cr√≠tica, con esperanza de vida entre 50-65 a√±os y mortalidad infantil superior a 30 por mil nacidos vivos. Los paises de Am√©rica exhiben una distribuci√≥n intermedia con variabilidad interna significativa: mientras algunos pa√≠ses rondan los 75 a√±os de EV, otros permanecen por debajo de 70. Los Asiaticos destacan por su extrema heterogeneidad: naciones desarrolladas se ubican en la zona √≥ptima, mientras casos como Pakistan ilustran c√≥mo pa√≠ses asi√°ticos pueden enfrentar desaf√≠os sanitarios comparables a contextos africanos, a pesar de perfiles econ√≥micos distintos.

La marcada relaci√≥n inversa evidencia que los sistemas de salud m√°s robustos logran simult√°neamente aumentar longevidad y reducir mortalidad infantil, se√±alando que ambas variables capturan la misma realidad subyacente: la calidad y accesibilidad de servicios sanitarios fundamentales.

### Dimensi√≥n Tecnol√≥gica y de Conectividad

La conectividad digital es un mecanismo contempor√°neo fundamental de inclusi√≥n econ√≥mica, pero no es unidimensional: requiere infraestructura energ√©tica (acceso a electricidad), conectividad inform√°tica (uso de internet) y penetraci√≥n m√≥vil (suscripciones por habitante). Estas variables son complementarias pero pueden desacoplarse‚Äîun pa√≠s puede tener electricidad universal pero baja adopci√≥n de internet, o inversamente, penetraci√≥n m√≥vil extraordinaria sin acceso el√©ctrico generalizado.

La Figura XX desagrega estos indicadores en cinco paneles geogr√°ficos, donde el eje horizontal representa acceso a electricidad, el eje vertical uso de internet, y el tama√±o de cada burbuja codifica suscripciones m√≥viles. Una l√≠nea diagonal de referencia act√∫a como benchmark: pa√≠ses sobre ella tienen penetraci√≥n digital que compensa acceso el√©ctrico limitado; pa√≠ses bajo ella exhiben brechas donde energ√≠a no se traduce en conectividad inform√°tica. Al pasar el cursor sobre cada burbuja, se despliegan los tres indicadores de conectividad espec√≠ficos del pa√≠s y continente.

```{r scatter-facetado-tecnologia, fig.height=10, fig.width=14, out.width="90%"}

datos_scatter_gg <- Base_2022 %>%
  asignar_continentes() %>%
  filter(
    !is.na(`Acceso electricidad`) & 
    !is.na(`Uso internet`) & 
    !is.na(`Suscripciones movil`) &
    !is.na(Continente) &
    Continente != "Otros"
  ) %>%
  mutate(
    Electricidad = `Acceso electricidad`,
    Internet = `Uso internet`,
    Movil = `Suscripciones movil`,
    Continente = factor(Continente, 
      levels = c("Africa", "Americas", "Asia", "Europe", "Oceania"))
  ) %>%
  arrange(Continente)

p_gg <- ggplot(datos_scatter_gg, aes(x = Electricidad, y = Internet)) +
  geom_abline(
    intercept = 0, 
    slope = 1, 
    linetype = "dashed",
    color = "#00e5ff",
    linewidth = 1,
    alpha = 0.3
  ) +
  geom_point(
    aes(
      fill = Continente,
      size = Movil,
      text = paste0(
        "<b style='font-size:14px;'>", Pais, "</b><br>",
        "<span style='color:#a259ff; font-size:11px;'>", Continente, "</span><br><br>",
        "<b style='color:#ffd600;'> INDICADORES</b><br>",
        "‚îú‚îÄ üîå Electricidad: <b style='color:#00e676;'>", 
        round(Electricidad, 1), "%</b><br>",
        "‚îú‚îÄ üåê Internet: <b style='color:#00e5ff;'>", 
        round(Internet, 1), "%</b><br>",
        "‚îî‚îÄ üì± M√≥viles: <b style='color:#ffd600;'>", 
        round(Movil, 1), "/100 hab.</b>"
      )
    ),
    alpha = 0.78,
    shape = 19,
    color = NA
  ) +
  scale_size_continuous(
    name = "Suscripciones M√≥viles\n(por 100 hab.)",
    range = c(2, 10),
    breaks = c(20, 50, 100, 150),
    labels = c("20", "50", "100", "150+")
  ) +
  geom_text_repel(
    aes(label = Pais),
    size = 2.8,
    color = "#e0e6ed",
    max.overlaps = 20,
    segment.color = "#00e5ff",
    segment.alpha = 0.3,
    segment.size = 0.3
  ) +
  facet_wrap(~Continente, ncol = 3) +
  scale_fill_manual(
    name = "Continente",
    values = c(
      "Africa" = "#ff1744",
      "Americas" = "#00e676",
      "Asia" = "#ffd600",
      "Europe" = "#0084ff",
      "Oceania" = "#a259ff"
    )
  ) +
  scale_x_continuous(limits = c(0, 105), breaks = seq(0, 100, 20)) +
  scale_y_continuous(limits = c(0, 105), breaks = seq(0, 100, 20)) +
  labs(
    title = "Infraestructura Digital: An√°lisis Multidimensional por Regi√≥n",
    subtitle = "A√±o 2022 | Tama√±o de burbuja = Suscripciones M√≥viles (por 100 hab)",
    x = "Acceso a Electricidad (% poblaci√≥n)",
    y = "Uso de Internet (% poblaci√≥n)"
  ) +
  theme_minimal(base_size = 11) +
  theme(
    plot.background = element_rect(fill = "#000000", color = NA),
    panel.background = element_rect(fill = "#0a0e1a", color = NA),
    panel.grid.major = element_line(color = "#12161f", linewidth = 0.3),
    panel.grid.minor = element_line(color = "#12161f", linewidth = 0.2),
    
    plot.title = element_text(
      color = "#00e5ff",
      face = "bold",
      size = 16,
      hjust = 0.5,
      margin = margin(b = 8)
    ),
    plot.subtitle = element_text(
      color = "#8b92a0",
      size = 11,
      hjust = 0.5,
      margin = margin(b = 15),
      lineheight = 1.2,
      face = "italic"
    ),
    
    axis.title = element_text(
      color = "#e0e6ed",
      face = "bold",
      size = 11
    ),
    axis.text = element_text(color = "#8b92a0", size = 10),
    axis.line = element_line(color = "#00e5ff", linewidth = 0.4),
    
    strip.text = element_text(
      color = "#00e5ff",
      face = "bold",
      size = 12,
      margin = margin(b = 8)
    ),
    strip.background = element_rect(
      fill = "#1a1a3e",
      color = "#00e5ff",
      linewidth = 1.2
    ),
    
    # LEYENDAS - AMBAS ACTIVAS
    legend.background = element_rect(
      fill = "#0a0e1a",
      color = "#00e5ff",
      linewidth = 1.2
    ),
    legend.text = element_text(color = "#e0e6ed", size = 11),
    legend.title = element_text(color = "#00e5ff", face = "bold", size = 12),
    legend.key = element_rect(fill = "#0a0e1a", color = NA),
    legend.key.size = unit(0.8, "cm"),
    legend.position = "right",
    legend.box = "vertical",
    legend.spacing.y = unit(0.5, "cm"),
    legend.margin = margin(10, 10, 10, 10),
    
    plot.margin = margin(15, 15, 15, 15)
  )

# Convertir a plotly y AJUSTAR LEYENDAS SEPARADAMENTE
plotly_plot <- ggplotly(p_gg, tooltip = "text") %>%
  layout(
    # Leyenda de continentes (arriba)
    legend = list(
      title = list(text = "<b>Continente</b>"),
      font = list(color = "#e0e6ed", size = 11),
      bgcolor = "rgba(10, 14, 26, 0.9)",
      bordercolor = "#00e5ff",
      borderwidth = 1,
      x = 1.05,
      y = 0.8,
      traceorder = "normal"
    ),
    # Leyenda de tama√±o (abajo) - CREAR MANUALMENTE
    annotations = list(
      # T√≠tulo de leyenda de tama√±o
      list(
        x = 1.05,
        y = 0.45,
        xref = "paper",
        yref = "paper",
        text = "<b style='color:#00e5ff; font-size:12px;'>Suscripciones M√≥viles</b>",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle",
        font = list(size = 12, color = "#00e5ff")
      ),
      # C√≠rculo peque√±o
      list(
        x = 1.02,
        y = 0.4,
        xref = "paper",
        yref = "paper",
        text = "‚óè",
        showarrow = FALSE,
        xanchor = "center",
        yanchor = "middle",
        font = list(size = 15, color = "#8b92a0")
      ),
      # Texto peque√±o
      list(
        x = 1.08,
        y = 0.4,
        xref = "paper",
        yref = "paper",
        text = "20",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle",
        font = list(size = 10, color = "#e0e6ed")
      ),
      # C√≠rculo mediano
      list(
        x = 1.02,
        y = 0.35,
        xref = "paper",
        yref = "paper",
        text = "‚óè",
        showarrow = FALSE,
        xanchor = "center",
        yanchor = "middle",
        font = list(size = 20, color = "#8b92a0")
      ),
      # Texto mediano
      list(
        x = 1.08,
        y = 0.35,
        xref = "paper",
        yref = "paper",
        text = "50",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle",
        font = list(size = 10, color = "#e0e6ed")
      ),
      # C√≠rculo grande
      list(
        x = 1.02,
        y = 0.3,
        xref = "paper",
        yref = "paper",
        text = "‚óè",
        showarrow = FALSE,
        xanchor = "center",
        yanchor = "middle",
        font = list(size = 25, color = "#8b92a0")
      ),
      # Texto grande
      list(
        x = 1.08,
        y = 0.3,
        xref = "paper",
        yref = "paper",
        text = "100",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle",
        font = list(size = 10, color = "#e0e6ed")
      ),
      # C√≠rculo muy grande
      list(
        x = 1.02,
        y = 0.25,
        xref = "paper",
        yref = "paper",
        text = "‚óè",
        showarrow = FALSE,
        xanchor = "center",
        yanchor = "middle",
        font = list(size = 30, color = "#8b92a0")
      ),
      # Texto muy grande
      list(
        x = 1.08,
        y = 0.25,
        xref = "paper",
        yref = "paper",
        text = "150+",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle",
        font = list(size = 10, color = "#e0e6ed")
      ),
      # Nota explicativa
      list(
        x = 1.05,
        y = 0.18,
        xref = "paper",
        yref = "paper",
        text = "<span style='color:#8b92a0; font-size:10px;'>(por 100 habitantes)</span>",
        showarrow = FALSE,
        xanchor = "left",
        yanchor = "middle"
      )
    ),
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    font = list(family = "Arial", color = "#e0e6ed"),
    margin = list(l = 50, r = 200, b = 50, t = 100)
  ) %>%
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "infraestructura_digital_final",
      width = 1200,
      height = 800
    )
  )

plotly_plot <- plotly_plot %>%
  style(showlegend = FALSE, traces = c(2:6))  # Ocultar leyendas de tama√±o

plotly_plot
```

En √Åfrica, pa√≠ses como N√≠ger y Mali se concentran en el cuadrante inferior izquierdo (20-40% electricidad, 10-30% internet), aunque Marruecos emerge como outlier con 100% acceso el√©ctrico y 89.9% internet, demostrando que la universalizaci√≥n es viable. En Europa, Suecia y Noruega ocupan la esquina superior derecha con universalizaci√≥n el√©ctrica, internet penetrante (95-100%) y saturaci√≥n m√≥vil (100+ suscripciones/100 hab.). Am√©rica presenta electricidad generalizada (80-95%) pero internet variable (50-80%), indicando que infraestructura energ√©tica no garantiza autom√°ticamente adopci√≥n digital sin inversi√≥n espec√≠fica en telecomunicaciones. Asia destaca por su extrema heterogeneidad: mientras Jap√≥n y Singapur se alinean con econom√≠as desarrolladas, Bangladesh y Pakist√°n enfrentan limitaciones m√°s severas. Notablemente, pa√≠ses asi√°ticos como India y Filipinas exhiben penetraci√≥n m√≥vil extraordinaria (120-140 suscripciones/100 hab.) a pesar de acceso el√©ctrico limitado, evidenciando que la telefon√≠a m√≥vil ha permitido saltos tecnol√≥gicos sin requerir infraestructura fija completa.

### Dimension ambiental y de recursos

La Figura XX muestra c√≥mo los pa√≠ses distribuyen su territorio entre bosques y tierras cultivables, dos recursos fundamentales para conservaci√≥n ambiental y seguridad alimentaria. El eje horizontal mide cobertura boscosa, el eje vertical tierra cultivable, y el gr√°fico divide el espacio en cuatro zonas: conservaci√≥n (muchos bosques, poca agricultura), agr√≠cola (mucha agricultura, pocos bosques), balance (ambas moderadas), y cr√≠tica (ambas limitadas).
Al pasar el cursor sobre cada punto, aparece informaci√≥n del pa√≠s: porcentaje de cobertura boscosa, porcentaje de tierra cultivable, el balance total entre ambas, y tama√±o de poblaci√≥n. Esto permite ver c√≥mo el uso de tierra var√≠a seg√∫n demograf√≠a: India concentra alta agricultura (51.8% tierra cultivable) y baja cobertura boscosa, reflejando presi√≥n por alimentar su enorme poblaci√≥n. Brasil y Bolivia se ubican en zona de balance con mayor cobertura forestal. Mauritania y Eritrea ocupan la zona cr√≠tica, con recursos limitados tanto para bosques como para agricultura.
En la leyenda al hacer clic en un continente, el gr√°fico se filtra mostrando solo los pa√≠ses de esa regi√≥n, permitiendo comparar patrones ambientales dentro de cada geograf√≠a. Esta visualizaci√≥n anticipa si la conservaci√≥n ambiental es un lujo de pa√≠ses ricos o una estrategia viable en todos los contextos.

```{r ambiental-scatter, fig.height=8, fig.width=25, out.width="100%"}

asignar_continentes <- function(data) {
  continentes_map <- c(
    "Argentina" = "Americas", "Bahamas, The" = "Americas", "Barbados" = "Americas",
    "Belize" = "Americas", "Bolivia" = "Americas", "Brazil" = "Americas",
    "Canada" = "Americas", "Chile" = "Americas", "Colombia" = "Americas",
    "Costa Rica" = "Americas", "Cuba" = "Americas", "Dominica" = "Americas",
    "Dominican Republic" = "Americas", "Ecuador" = "Americas", "El Salvador" = "Americas",
    "Grenada" = "Americas", "Guatemala" = "Americas", "Guyana" = "Americas",
    "Haiti" = "Americas", "Honduras" = "Americas", "Jamaica" = "Americas",
    "Mexico" = "Americas", "Nicaragua" = "Americas", "Panama" = "Americas",
    "Paraguay" = "Americas", "Peru" = "Americas", "St. Kitts and Nevis" = "Americas",
    "St. Lucia" = "Americas", "St. Vincent and the Grenadines" = "Americas",
    "Suriname" = "Americas", "Trinidad and Tobago" = "Americas", "United States" = "Americas",
    "Uruguay" = "Americas", "Venezuela, RB" = "Americas", "Antigua and Barbuda" = "Americas",
    
    "Albania" = "Europe", "Austria" = "Europe", "Belarus" = "Europe",
    "Belgium" = "Europe", "Bosnia and Herzegovina" = "Europe", "Bulgaria" = "Europe",
    "Croatia" = "Europe", "Cyprus" = "Europe", "Czech Republic" = "Europe",
    "Czechia" = "Europe", "Denmark" = "Europe", "Estonia" = "Europe",
    "Finland" = "Europe", "France" = "Europe", "Germany" = "Europe",
    "Greece" = "Europe", "Hungary" = "Europe", "Iceland" = "Europe",
    "Ireland" = "Europe", "Italy" = "Europe", "Kosovo" = "Europe",
    "Latvia" = "Europe", "Lithuania" = "Europe", "Luxembourg" = "Europe",
    "Malta" = "Europe", "Montenegro" = "Europe", "Netherlands" = "Europe",
    "North Macedonia" = "Europe", "Norway" = "Europe", "Poland" = "Europe",
    "Portugal" = "Europe", "Russian Federation" = "Europe", "Serbia" = "Europe",
    "Slovak Republic" = "Europe", "Slovakia" = "Europe", "Slovenia" = "Europe",
    "Spain" = "Europe", "Sweden" = "Europe", "Switzerland" = "Europe",
    "Turkey" = "Europe", "Turkiye" = "Europe", "Ukraine" = "Europe",
    "United Kingdom" = "Europe", "Armenia" = "Europe", "Azerbaijan" = "Europe",
    "Georgia" = "Europe", "Moldova" = "Europe", "Romania" = "Europe",
    "San Marino" = "Europe",
    
    "Afghanistan" = "Asia", "Bahrain" = "Asia", "Bangladesh" = "Asia",
    "Bhutan" = "Asia", "Brunei Darussalam" = "Asia", "Cambodia" = "Asia",
    "China" = "Asia", "Hong Kong SAR, China" = "Asia", "India" = "Asia",
    "Indonesia" = "Asia", "Iran, Islamic Rep." = "Asia", "Iraq" = "Asia",
    "Israel" = "Asia", "Japan" = "Asia", "Jordan" = "Asia",
    "Kazakhstan" = "Asia", "Korea, Dem. People's rep." = "Asia", "Korea, Rep." = "Asia",
    "Kuwait" = "Asia", "Kyrgyz Republic" = "Asia", "Lao PDR" = "Asia",
    "Lebanon" = "Asia", "Macao SAR, China" = "Asia", "Malaysia" = "Asia",
    "Maldives" = "Asia", "Mongolia" = "Asia", "Myanmar" = "Asia",
    "Nepal" = "Asia", "Oman" = "Asia", "Pakistan" = "Asia",
    "Philippines" = "Asia", "Qatar" = "Asia", "Saudi Arabia" = "Asia",
    "Singapore" = "Asia", "Sri Lanka" = "Asia", "Syrian Arab Republic" = "Asia",
    "Taiwan" = "Asia", "Tajikistan" = "Asia", "Thailand" = "Asia",
    "Timor-Leste" = "Asia", "Turkmenistan" = "Asia", "United Arab Emirates" = "Asia",
    "Uzbekistan" = "Asia", "Vietnam" = "Asia", "Viet Nam" = "Asia",
    "West Bank and Gaza" = "Asia", "Yemen, Rep." = "Asia",
    
    "Algeria" = "Africa", "Angola" = "Africa", "Benin" = "Africa",
    "Botswana" = "Africa", "Burkina Faso" = "Africa", "Burundi" = "Africa",
    "Cabo Verde" = "Africa", "Cameroon" = "Africa", "Central African Republic" = "Africa",
    "Chad" = "Africa", "Comoros" = "Africa", "Congo, Dem. Rep." = "Africa",
    "Congo, Rep." = "Africa", "Cote d'Ivoire" = "Africa", "Djibouti" = "Africa",
    "Egypt, Arab Rep." = "Africa", "Equatorial Guinea" = "Africa", "Eritrea" = "Africa",
    "Eswatini" = "Africa", "Ethiopia" = "Africa", "Gabon" = "Africa",
    "Gambia, The" = "Africa", "Ghana" = "Africa", "Guinea" = "Africa",
    "Guinea-Bissau" = "Africa", "Kenya" = "Africa", "Lesotho" = "Africa",
    "Liberia" = "Africa", "Libya" = "Africa", "Madagascar" = "Africa",
    "Malawi" = "Africa", "Mali" = "Africa", "Mauritania" = "Africa",
    "Mauritius" = "Africa", "Morocco" = "Africa", "Mozambique" = "Africa",
    "Namibia" = "Africa", "Niger" = "Africa", "Nigeria" = "Africa",
    "Rwanda" = "Africa", "Senegal" = "Africa", "Sierra Leone" = "Africa",
    "Somalia" = "Africa", "South Africa" = "Africa", "South Sudan" = "Africa",
    "Sudan" = "Africa", "Tanzania" = "Africa", "Togo" = "Africa",
    "Tunisia" = "Africa", "Uganda" = "Africa", "Zambia" = "Africa",
    "Zimbabwe" = "Africa",
    
    "Australia" = "Oceania", "Fiji" = "Oceania", "Kiribati" = "Oceania",
    "Marshall Islands" = "Oceania", "Micronesia, Fed. Sts." = "Oceania",
    "New Zealand" = "Oceania", "Palau" = "Oceania", "Samoa" = "Oceania",
    "Solomon Islands" = "Oceania", "Tonga" = "Oceania", "Vanuatu" = "Oceania"
  )
  
  data %>%
    mutate(Continente = ifelse(Pais %in% names(continentes_map),
                                continentes_map[Pais], NA))
}

datos_ambiental <- Base_2022 %>%
  asignar_continentes() %>%
  filter(
    !is.na(`Area boscosa`) & 
    !is.na(`Tierra cultivable`) & 
    !is.na(Poblacion) &
    !is.na(Continente)
  ) %>%
  select(
    Pais, Continente,
    `Area boscosa`,
    `Tierra cultivable`,
    Poblacion
  ) %>%
  mutate(
    # ‚úÖ TOOLTIP CON EL MISMO DISE√ëO QUE EL GR√ÅFICO DE CONECTIVIDAD
    tooltip = paste0(
      "<b style='font-size:14px; color:#00e5ff;'>", Pais, "</b><br>",
      "<span style='color:#a259ff; font-size:11px;'>", Continente, "</span><br><br>",
      "<b style='color:#ffd600;'> USO DE TIERRA:</b><br>",
      "‚îú‚îÄ √Årea Boscosa: <b style='color:#00e676;'>", 
      round(`Area boscosa`, 1), "%</b><br>",
      "‚îú‚îÄ Tierra Cultivable: <b style='color:#ffd600;'>", 
      round(`Tierra cultivable`, 1), "%</b><br>",
      "‚îú‚îÄ Balance: <b style='color:#00e5ff;'>", 
      round(`Area boscosa` + `Tierra cultivable`, 1), "% (bosque + cultivo)</b><br>",
      "‚îî‚îÄ Poblaci√≥n: <b style='color:#ff1744;'>", 
      format(round(Poblacion/1e6, 1), big.mark = ",", trim = TRUE), " M</b>"
    )
  )

color_map <- c(
  "Africa" = "#ff1744",
  "Americas" = "#00e676",
  "Asia" = "#ffd600",
  "Europe" = "#0084ff",
  "Oceania" = "#a259ff"
)

p <- plot_ly() %>%
  add_trace(
    data = datos_ambiental,
    x = ~`Area boscosa`,
    y = ~`Tierra cultivable`,
    # ‚úÖ TAMA√ëO FIJO - SIN VARIACI√ìN POR POBLACI√ìN
    color = ~Continente,
    colors = color_map,
    type = "scatter",
    mode = "markers",
    customdata = ~tooltip,
    hovertemplate = "%{customdata}<extra></extra>",
    marker = list(
      size = 12,  # ‚úÖ TAMA√ëO FIJO PARA TODOS LOS PUNTOS
      opacity = 0.8,
      line = list(
        color = "#ffffff", 
        width = 1.5   
      )
    ),
    showlegend = TRUE
  ) %>%
  
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:24px;'>Sostenibilidad Ambiental: Uso de Tierra</b><br>
               <span style='color:#8b92a0; font-size:14px;'>A√±o 2022 | Balance entre conservaci√≥n y agricultura</span>",
      x = 0.5,
      xanchor = 'center',
      y = 0.95
    ),
    
    xaxis = list(
      title = "<b style='font-size:16px;'>√Årea Boscosa (% de tierra)</b>",
      gridcolor = '#12161f',
      showgrid = TRUE,
      zeroline = FALSE,
      tickfont = list(color = '#8b92a0', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16),
      range = c(0, 100)
    ),
    
    yaxis = list(
      title = "<b style='font-size:16px;'>Tierra Cultivable (% de tierra)</b>",
      gridcolor = '#12161f',
      showgrid = TRUE,
      zeroline = FALSE,
      tickfont = list(color = '#8b92a0', size = 13),
      titlefont = list(color = '#e0e6ed', size = 16),
      range = c(0, 70)
    ),
    
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 13),
    
    # ‚úÖ LEYENDA MOVIDA A LA ESQUINA SUPERIOR DERECHA
    legend = list(
      title = list(text = "<b style='font-size:14px;'>Continente</b>", font = list(size = 14, color = "#00e5ff")),
      bgcolor = 'rgba(10,14,26,0.95)',
      bordercolor = '#00e5ff',
      borderwidth = 1.5,
      x = 0.98,  # ‚úÖ POSICI√ìN DERECHA
      y = 0.98,  # ‚úÖ POSICI√ìN SUPERIOR
      xanchor = "right",
      yanchor = "top",
      font = list(size = 12, color = "#e0e6ed")
    ),
    
    margin = list(l = 100, r = 50, b = 120, t = 120),
    hovermode = 'closest',
    
    # ‚úÖ HOVERLABEL ID√âNTICO AL GR√ÅFICO DE CONECTIVIDAD
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    
    shapes = list(
      list(
        type = "rect",
        x0 = 60, x1 = 100,
        y0 = 0, y1 = 20,
        xref = "x", yref = "y",
        fillcolor = "rgba(0, 230, 118, 0.1)",
        line = list(color = "rgba(0, 230, 118, 0.6)", width = 2, dash = "dot"),
        layer = "below"
      ),
      list(
        type = "rect",
        x0 = 0, x1 = 30,
        y0 = 40, y1 = 70,
        xref = "x", yref = "y",
        fillcolor = "rgba(255, 214, 0, 0.1)",
        line = list(color = "rgba(255, 214, 0, 0.6)", width = 2, dash = "dot"),
        layer = "below"
      ),
      list(
        type = "rect",
        x0 = 30, x1 = 60,
        y0 = 20, y1 = 40,
        xref = "x", yref = "y",
        fillcolor = "rgba(0, 132, 255, 0.1)",
        line = list(color = "rgba(0, 132, 255, 0.6)", width = 2, dash = "dot"),
        layer = "below"
      ),
      list(
        type = "rect",
        x0 = 0, x1 = 30,
        y0 = 0, y1 = 20,
        xref = "x", yref = "y",
        fillcolor = "rgba(255, 23, 68, 0.1)",
        line = list(color = "rgba(255, 23, 68, 0.6)", width = 2, dash = "dot"),
        layer = "below"
      )
    ),
    
    annotations = list(
      list(
        x = 88, y = 10,
        text = "<b style='color:#00e676; font-size:12px;'>üå≤ CONSERVACI√ìN</b>",
        showarrow = FALSE,
        bgcolor = "rgba(0, 230, 118, 0.2)",
        bordercolor = "#00e676",
        borderwidth = 1.5,
        borderpad = 6,
        font = list(size = 11)
      ),
      list(
        x = 30, y = 65,
        text = "<b style='color:#ffd600; font-size:12px;'>üåæ AGR√çCOLA</b>",
        showarrow = FALSE,
        bgcolor = "rgba(255, 214, 0, 0.2)",
        bordercolor = "#ffd600",
        borderwidth = 1.5,
        borderpad = 6,
        font = list(size = 11)
      ),
      list(
        x = 60, y = 40,
        text = "<b style='color:#0084ff; font-size:12px;'>‚öñÔ∏è BALANCE</b>",
        showarrow = FALSE,
        bgcolor = "rgba(0, 132, 255, 0.2)",
        bordercolor = "#0084ff",
        borderwidth = 1.5,
        borderpad = 6,
        font = list(size = 11)
      ),
      list(
        x = 15, y = 20,
        text = "<b style='color:#ff1744; font-size:12px;'>‚ö†Ô∏è CR√çTICA</b>",
        showarrow = FALSE,
        bgcolor = "rgba(255, 23, 68, 0.2)",
        bordercolor = "#ff1744",
        borderwidth = 1.5,
        borderpad = 6,
        font = list(size = 10)
      ),
      
      list(
        x = 0.5, y = -0.15,
        xref = "paper", yref = "paper",
        text = "<span style='color:#8b92a0; font-size:12px;'>Verde = alta cobertura boscosa. Amarillo = alta agricultura. Equilibrio = desarrollo sostenible.</span>",
        showarrow = FALSE,
        xanchor = "center",
        yanchor = "top",
        font = list(size = 11, color = "#8b92a0")
      )
    )
  ) %>%
  
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "sostenibilidad_ambiental_2022",
      width = 1600,
      height = 1000
    )
  )

p

```

El gr√°fico revela una clara segregaci√≥n geogr√°fica en el uso de tierra: algunos pa√≠ses concentran la zona agr√≠cola con alta tierra cultivable pero baja cobertura boscosa, mientras otros ocupan la zona de balance manteniendo ambas variables moderadas. Europa tiende a distribuirse en la zona media-superior con mayor cobertura forestal, mientras que muchos pa√≠ses africanos se concentran en la zona cr√≠tica donde ambos recursos son limitados. La dispersi√≥n dentro de cada continente muestra variabilidad significativa, indicando que el uso de tierra no sigue un patr√≥n √∫nico sino que responde a din√°micas regionales espec√≠ficas. Esta visualizaci√≥n permite identificar que la presi√≥n ambiental‚Äîreflejada en el balance entre conservaci√≥n y agricultura‚Äîopera de formas distintas seg√∫n geograf√≠a, informaci√≥n que el an√°lisis multivariado posteriormente contextualizar√° dentro de la estructura general del desarrollo.

### Dimensi√≥n Demogr√°fica

La din√°mica poblacional condiciona fundamentalmente los desaf√≠os de desarrollo: presi√≥n sobre recursos, mercado laboral, demanda por servicios p√∫blicos y sostenibilidad fiscal. Esta figura examina simult√°neamente poblaci√≥n y crecimiento poblacional en los 60 pa√≠ses m√°s grandes, permitiendo visualizar si el crecimiento demogr√°fico genera oportunidades (dividendo demogr√°fico) o presiones cr√≠ticas (declive o sobrepoblaci√≥n).

Estructura del Gr√°fico: Cada rect√°ngulo representa un pa√≠s donde el tama√±o codifica poblaci√≥n total. El color codifica crecimiento poblacional anual: verde indica crecimiento alto (2%+, potencial dividendo demogr√°fico), amarillo transici√≥n moderada (0.5-2%), naranja-rojo crecimiento bajo o negativo (riesgo de declive poblacional).
Al pasar el cursor sobre cada pa√≠s, aparecen simult√°neamente cinco indicadores demogr√°ficos y algunos de desarrollo para complementar: poblaci√≥n en millones, tasa de crecimiento anual, esperanza de vida, mortalidad infantil, y PIB per c√°pita. Tambi√©n se muestra la clasificaci√≥n demogr√°fica del pa√≠s (Dividendo Demogr√°fico, Madurez Estable o Declive Poblacional).

```{r treemap-oportunidades-riesgos, fig.height=9, fig.width=25, out.width="100%"}

asignar_continentes <- function(data) {
  continentes_map <- c(
    "Argentina" = "Americas", "Bahamas, The" = "Americas", "Barbados" = "Americas",
    "Belize" = "Americas", "Bolivia" = "Americas", "Brazil" = "Americas",
    "Canada" = "Americas", "Chile" = "Americas", "Colombia" = "Americas",
    "Costa Rica" = "Americas", "Cuba" = "Americas", "Dominica" = "Americas",
    "Dominican Republic" = "Americas", "Ecuador" = "Americas", "El Salvador" = "Americas",
    "Grenada" = "Americas", "Guatemala" = "Americas", "Guyana" = "Americas",
    "Haiti" = "Americas", "Honduras" = "Americas", "Jamaica" = "Americas",
    "Mexico" = "Americas", "Nicaragua" = "Americas", "Panama" = "Americas",
    "Paraguay" = "Americas", "Peru" = "Americas", "St. Kitts and Nevis" = "Americas",
    "St. Lucia" = "Americas", "St. Vincent and the Grenadines" = "Americas",
    "Suriname" = "Americas", "Trinidad and Tobago" = "Americas", "United States" = "Americas",
    "Uruguay" = "Americas", "Venezuela, RB" = "Americas", "Antigua and Barbuda" = "Americas",
    
    "Albania" = "Europe", "Austria" = "Europe", "Belarus" = "Europe",
    "Belgium" = "Europe", "Bosnia and Herzegovina" = "Europe", "Bulgaria" = "Europe",
    "Croatia" = "Europe", "Cyprus" = "Europe", "Czech Republic" = "Europe",
    "Czechia" = "Europe", "Denmark" = "Europe", "Estonia" = "Europe",
    "Finland" = "Europe", "France" = "Europe", "Germany" = "Europe",
    "Greece" = "Europe", "Hungary" = "Europe", "Iceland" = "Europe",
    "Ireland" = "Europe", "Italy" = "Europe", "Kosovo" = "Europe",
    "Latvia" = "Europe", "Lithuania" = "Europe", "Luxembourg" = "Europe",
    "Malta" = "Europe", "Montenegro" = "Europe", "Netherlands" = "Europe",
    "North Macedonia" = "Europe", "Norway" = "Europe", "Poland" = "Europe",
    "Portugal" = "Europe", "Russian Federation" = "Europe", "Serbia" = "Europe",
    "Slovak Republic" = "Europe", "Slovakia" = "Europe", "Slovenia" = "Europe",
    "Spain" = "Europe", "Sweden" = "Europe", "Switzerland" = "Europe",
    "Turkey" = "Europe", "Turkiye" = "Europe", "Ukraine" = "Europe",
    "United Kingdom" = "Europe", "Armenia" = "Europe", "Azerbaijan" = "Europe",
    "Georgia" = "Europe", "Moldova" = "Europe", "Romania" = "Europe",
    "San Marino" = "Europe",
    
    "Afghanistan" = "Asia", "Bahrain" = "Asia", "Bangladesh" = "Asia",
    "Bhutan" = "Asia", "Brunei Darussalam" = "Asia", "Cambodia" = "Asia",
    "China" = "Asia", "Hong Kong SAR, China" = "Asia", "India" = "Asia",
    "Indonesia" = "Asia", "Iran, Islamic Rep." = "Asia", "Iraq" = "Asia",
    "Israel" = "Asia", "Japan" = "Asia", "Jordan" = "Asia",
    "Kazakhstan" = "Asia", "Korea, Dem. People's rep." = "Asia", "Korea, Rep." = "Asia",
    "Kuwait" = "Asia", "Kyrgyz Republic" = "Asia", "Lao PDR" = "Asia",
    "Lebanon" = "Asia", "Macao SAR, China" = "Asia", "Malaysia" = "Asia",
    "Maldives" = "Asia", "Mongolia" = "Asia", "Myanmar" = "Asia",
    "Nepal" = "Asia", "Oman" = "Asia", "Pakistan" = "Asia",
    "Philippines" = "Asia", "Qatar" = "Asia", "Saudi Arabia" = "Asia",
    "Singapore" = "Asia", "Sri Lanka" = "Asia", "Syrian Arab Republic" = "Asia",
    "Taiwan" = "Asia", "Tajikistan" = "Asia", "Thailand" = "Asia",
    "Timor-Leste" = "Asia", "Turkmenistan" = "Asia", "United Arab Emirates" = "Asia",
    "Uzbekistan" = "Asia", "Vietnam" = "Asia", "Viet Nam" = "Asia",
    "West Bank and Gaza" = "Asia", "Yemen, Rep." = "Asia",
    
    "Algeria" = "Africa", "Angola" = "Africa", "Benin" = "Africa",
    "Botswana" = "Africa", "Burkina Faso" = "Africa", "Burundi" = "Africa",
    "Cabo Verde" = "Africa", "Cameroon" = "Africa", "Central African Republic" = "Africa",
    "Chad" = "Africa", "Comoros" = "Africa", "Congo, Dem. Rep." = "Africa",
    "Congo, Rep." = "Africa", "Cote d'Ivoire" = "Africa", "Djibouti" = "Africa",
    "Egypt, Arab Rep." = "Africa", "Equatorial Guinea" = "Africa", "Eritrea" = "Africa",
    "Eswatini" = "Africa", "Ethiopia" = "Africa", "Gabon" = "Africa",
    "Gambia, The" = "Africa", "Ghana" = "Africa", "Guinea" = "Africa",
    "Guinea-Bissau" = "Africa", "Kenya" = "Africa", "Lesotho" = "Africa",
    "Liberia" = "Africa", "Libya" = "Africa", "Madagascar" = "Africa",
    "Malawi" = "Africa", "Mali" = "Africa", "Mauritania" = "Africa",
    "Mauritius" = "Africa", "Morocco" = "Africa", "Mozambique" = "Africa",
    "Namibia" = "Africa", "Niger" = "Africa", "Nigeria" = "Africa",
    "Rwanda" = "Africa", "Senegal" = "Africa", "Sierra Leone" = "Africa",
    "Somalia" = "Africa", "South Africa" = "Africa", "South Sudan" = "Africa",
    "Sudan" = "Africa", "Tanzania" = "Africa", "Togo" = "Africa",
    "Tunisia" = "Africa", "Uganda" = "Africa", "Zambia" = "Africa",
    "Zimbabwe" = "Africa",
    
    "Australia" = "Oceania", "Fiji" = "Oceania", "Kiribati" = "Oceania",
    "Marshall Islands" = "Oceania", "Micronesia, Fed. Sts." = "Oceania",
    "New Zealand" = "Oceania", "Palau" = "Oceania", "Samoa" = "Oceania",
    "Solomon Islands" = "Oceania", "Tonga" = "Oceania", "Vanuatu" = "Oceania"
  )
  
  data %>%
    mutate(Continente = ifelse(Pais %in% names(continentes_map),
                                continentes_map[Pais], NA))
}

datos_riesgos <- Base_2022 %>%
  asignar_continentes() %>%
  filter(
    !is.na(`Crecimiento poblacion`) & 
    !is.na(Poblacion) &
    !is.na(Continente) &
    Poblacion > 0
  ) %>%
  select(
    Pais, Continente, 
    Poblacion, 
    `Crecimiento poblacion`,
    `Mortalidad infantil`,
    `Esperanza vida`,
    PIB_per
  ) %>%
  arrange(desc(Poblacion)) %>%
  slice_head(n = 60) %>%
  mutate(
    Poblacion_millones = Poblacion / 1e6,
    # Clasificaci√≥n simplificada
    Clasificacion = case_when(
      `Crecimiento poblacion` > 2 ~ "Dividendo Demogr√°fico",
      `Crecimiento poblacion` >= 0.5 & `Crecimiento poblacion` <= 2 ~ "Madurez Estable", 
      `Crecimiento poblacion` < 0.5 ~ "Declive Poblacional",
      TRUE ~ "Sin Clasificar"
    ),
    # ‚úÖ TOOLTIP CON EL MISMO DISE√ëO QUE EL GR√ÅFICO DE CONECTIVIDAD
    tooltip = paste0(
      "<b style='font-size:14px; color:#00e5ff;'>", Pais, "</b><br>",
      "<span style='color:#a259ff; font-size:11px;'>", Continente, "</span><br><br>",
      "<b style='color:#ffd600;'> INDICADORES DEMOGR√ÅFICOS:</b><br>",
      "‚îú‚îÄ Poblaci√≥n: <b style='color:#ffd600;'>", 
      format(round(Poblacion_millones, 1), big.mark = ",", decimal.mark = ".", trim = TRUE), " M</b><br>",
      "‚îú‚îÄ Crecimiento: <b style='color:#00e676;'>", 
      round(`Crecimiento poblacion`, 2), "%</b><br>",
      "‚îú‚îÄ Esperanza Vida: <b style='color:#00e5ff;'>", 
      round(`Esperanza vida`, 1), " a√±os</b><br>",
      "‚îú‚îÄ Mortalidad Infantil: <b style='color:#ff1744;'>", 
      round(`Mortalidad infantil`, 1), "/1000</b><br>",
      "‚îî‚îÄ PIB per c√°pita: <b style='color:#a259ff;'>$", 
      format(round(PIB_per), big.mark = ","), "</b><br>",
      "<br><b>Clasificaci√≥n:</b> <span style='color:#00e676;'>", Clasificacion, "</span>"
    )
  )

fig_treemap <- plot_ly(
  data = datos_riesgos,
  type = "treemap",
  labels = ~Pais,
  parents = ~"",
  values = ~Poblacion,
  branchvalues = "total",
  marker = list(
    colors = ~`Crecimiento poblacion`,
    colorscale = list(
      c(0, "#ff1744"),    
      c(0.3, "#ff6b00"),  
      c(0.5, "#fdd835"),    
      c(0.7, "#76ff03"),  
      c(1, "#00e676")      
    ),
    cmin = -2,
    cmax = 4,
    showscale = TRUE,
    colorbar = list(
      title = list(
        text = "<b>Crecimiento<br>Anual (%)</b>",
        font = list(size = 12, color = "#e0e6ed")
      ),
      tickvals = c(-2, -1, 0, 1, 2, 3, 4),
      ticktext = c("-2%", "-1%", "0%", "1%", "2%", "3%", "4%"),
      thickness = 20,
      len = 0.8,
      x = 1.05,  # Posici√≥n ajustada
      y = 0.5,
      tickfont = list(size = 11, color = "#8b92a0")
    ),
    line = list(color = "#0a0e1a", width = 2),
    opacity = 0.9
  ),
  textinfo = "label+value",
  texttemplate = "<b>%{label}</b><br>%{value:.0f}M",
  textposition = "middle center", 
  textfont = list(
    size = 14,
    color = "white",
    family = "Arial"
  ),
  customdata = ~tooltip,
  hovertemplate = "%{customdata}<extra></extra>",
  showlegend = FALSE
)

fig_treemap <- fig_treemap %>%
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:24px;'>Oportunidades y Riesgos Demogr√°ficos Globales</b><br>
             <span style='color:#8b92a0; font-size:14px;'>Top 60 pa√≠ses | Tama√±o = Poblaci√≥n | Color = Crecimiento Anual (2022)</span>",
      x = 0.5,
      xanchor = 'center', 
      y = 0.95
    ),
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 12),
    
    # ‚úÖ HOVERLABEL ID√âNTICO AL GR√ÅFICO DE CONECTIVIDAD
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    
    margin = list(l = 10, r = 150, b = 100, t = 120),
    annotations = list(
      list(
        x = 0.5, 
        y = -0.08,
        xref = "paper", 
        yref = "paper",
        text = "<span style='color:#e0e6ed; font-size:12px;'><b>üìä LECTURA:</b> 
               <span style='color:#00e676;'>Verde (alto crecimiento) = Oportunidades demogr√°ficas</span> | 
               <span style='color:#ff1744;'>Rojo (bajo/negativo) = Riesgos de declive</span> | 
               <span style='color:#fdd835;'>Amarillo = Transici√≥n estable</span></span>",
        showarrow = FALSE,
        xanchor = "center",
        align = "center"
      )
    )
  ) %>%
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png", 
      filename = "oportunidades_riesgos_demograficos",
      width = 1600,
      height = 1000
    )
  )

fig_treemap
```

India y China dominan por volumen (rect√°ngulos enormes), pero con din√°micas opuestas: India en amarillo-verde (crecimiento 1-2%) versus China en naranja-rojo (crecimiento bajo). Estados Unidos, Indonesia y Brasil exhiben colores intermedios, reflejando transiciones demogr√°ficas distintas. Pa√≠ses africanos como Congo Democr√°tico, Nigeria y Uganda aparecen en verde brillante, indicando crecimiento r√°pido (oportunidades de dividendo demogr√°fico pero tambi√©n presi√≥n sobre servicios). Europeos como Alemania y Espa√±a muestran tonos rojos-naranjas, evidenciando declive poblacional y envejecimiento. Esta distribuci√≥n muestra que presiones demogr√°ficas operan en direcciones opuestas seg√∫n regi√≥n, informaci√≥n que contextualizar√° el an√°lisis multivariado posterior.

## Visualizaci√≥n Geoespacial

La visualizaci√≥n geoespacial complementa el an√°lisis dimensional anterior ofreciendo una perspectiva geogr√°fica integrada que revela c√≥mo las din√°micas de desarrollo se distribuyen espacialmente en el planeta. Esta secci√≥n presenta un mapa interactivo mundial donde cada territorio se colorea seg√∫n el indicador seleccionado, permitiendo identificar patrones de concentraci√≥n geogr√°fica, grupos regionales y anomal√≠as que anticipan la estructura latente del desarrollo global.

El mapa ofrece tres variables seleccionables mediante controles en la esquina superior izquierda: (1) Crecimiento PIB, (2) Acceso a Electricidad, y (3) Crecimiento Poblacional. Cada variable posee su propia paleta de colores. Una leyenda din√°mica en la esquina inferior derecha se actualiza autom√°ticamente al cambiar de variable, mostrando la escala espec√≠fica.

Al pasar el cursor sobre cualquier pa√≠s, emerge informac√≥n con nombre del pa√≠s, variable seleccionada y valor espec√≠fico, permitiendo consultar informaci√≥n precise sin interrumpir la visualizaci√≥n general.

```{r crear-datos-mapa}

variables_mapa <- list(
  "Crecimiento PIB" = "Crecimiento PIB",
  "Acceso electricidad" = "Acceso electricidad",  
  "Crecimiento poblacion" = "Crecimiento poblacion"  
)

world <- ne_countries(scale = "medium", returnclass = "sf")

mapeo_paises <- c(
  "United States of America" = "United States",
  "Russia" = "Russian Federation",
  "South Korea" = "Korea, Rep.",
  "North Korea" = "Korea, Dem. People's Rep.",
  "Egypt" = "Egypt, Arab Rep.",
  "Democratic Republic of the Congo" = "Congo, Dem. Rep.",
  "Republic of the Congo" = "Congo, Rep.",
  "Laos" = "Lao PDR",
  "Syria" = "Syrian Arab Republic",
  "Venezuela" = "Venezuela, RB",
  "Iran" = "Iran, Islamic Rep.",
  "Czech Republic" = "Czechia",
  "Slovakia" = "Slovak Republic",
  "Kyrgyzstan" = "Kyrgyz Republic",
  "Yemen" = "Yemen, Rep.",
  "Turkey" = "Turkiye",
  "Gambia" = "Gambia, The",
  "Bahamas" = "Bahamas, The",
  "Ivory Coast" = "Cote d'Ivoire",
  "Brunei" = "Brunei Darussalam",
  "Cape Verde" = "Cabo Verde",
  "Hong Kong" = "Hong Kong SAR, China",
  "Macao" = "Macao SAR, China",
  "Macedonia" = "North Macedonia",
  "Saint Lucia" = "St. Lucia",
  "Saint Vincent and the Grenadines" = "St. Vincent and the Grenadines",
  "Saint Kitts and Nevis" = "St. Kitts and Nevis",
  "Myanmar" = "Myanmar",
  "Bolivia" = "Bolivia",
  "Libya" = "Libya",
  "Tanzania" = "Tanzania",
  "Eswatini" = "Eswatini",
  "Timor-Leste" = "Timor-Leste"
)

mapeo_df <- data.frame(
  name_world = names(mapeo_paises),
  name_data = unname(mapeo_paises),
  stringsAsFactors = FALSE
)

world_data <- world %>%
  left_join(mapeo_df, by = c("name" = "name_world")) %>%
  left_join(
    Base_2022 %>% select(Pais, all_of(unlist(variables_mapa))),
    by = c("name_data" = "Pais")
  ) %>%
  mutate(
    across(
      all_of(unlist(variables_mapa)),
      ~ifelse(is.na(.) & name %in% Base_2022$Pais,
              Base_2022[[cur_column()]][match(name, Base_2022$Pais)], .)
    )
  )

```

```{r crear-mapa-interactivo, fig.height=6.5, fig.width=11}
paletas <- list(
  "Crecimiento PIB" = colorNumeric(
    palette = colorRampPalette(c("#ff1744", "#ff6b00", "#ffd600", "#00e676", "#00e5ff"))(100),
    domain = world_data$`Crecimiento PIB`,
    na.color = "#1a1a2e"
  ),
  "Acceso electricidad" = colorNumeric(
    palette = colorRampPalette(c("#1a1a2e", "#0084ff", "#00e5ff", "#00e676", "#ffd600"))(100),
    domain = world_data$`Acceso electricidad`,
    na.color = "#1a1a2e"
  ),
  "Crecimiento poblacion" = colorNumeric(
    palette = colorRampPalette(c("#0084ff", "#00e5ff", "#a259ff", "#ff6b00", "#ff1744"))(100),
    domain = world_data$`Crecimiento poblacion`,  # ‚úÖ CORREGIDO
    na.color = "#1a1a2e"
  )
)

mapa <- leaflet(world_data, 
                width = "100%", 
                height = "550px",
                options = leafletOptions(
                  minZoom = 2,
                  maxZoom = 7,
                  worldCopyJump = TRUE
                )) %>%
  setView(lng = 15, lat = 20, zoom = 2.2) %>%
  addProviderTiles("CartoDB.DarkMatter")

for (var_display in names(variables_mapa)) {
  var_col <- variables_mapa[[var_display]]
  pal <- paletas[[var_display]]
  
  unidad <- if(grepl("Crecimiento", var_display)) "%" else "%"
  
  labels <- sprintf(
    "<div style='font-family: sans-serif;'>
      <strong style='color: #00e5ff; font-size: 15px;'>%s</strong><br/>
      <span style='color: #8b92a0; font-size: 12px;'>%s:</span><br/>
      <strong style='color: #00e5ff; font-size: 14px;'>%s</strong>
    </div>",
    world_data$name,
    var_display,
    ifelse(is.na(world_data[[var_col]]), 
           "Sin datos", 
           paste0(round(world_data[[var_col]], 2), unidad))
  ) %>% lapply(HTML)
  
  mapa <- mapa %>%
    addPolygons(
      fillColor = ~pal(world_data[[var_col]]),
      weight = 1.2,
      opacity = 0.9,
      color = "#00e5ff",
      fillOpacity = 0.75,
      highlight = highlightOptions(
        weight = 2.5,
        color = "#00ffff",
        fillOpacity = 0.9,
        bringToFront = TRUE
      ),
      label = labels,
      labelOptions = labelOptions(
        style = list(
          "background" = "rgba(10, 14, 26, 0.95)",
          "border" = "2px solid #00e5ff",
          "border-radius" = "6px",
          "padding" = "10px",
          "box-shadow" = "0 0 15px rgba(0, 229, 255, 0.6)"
        ),
        textsize = "13px"
      ),
      group = var_display
    )
}

mapa <- mapa %>%
  addLayersControl(
    baseGroups = names(variables_mapa),
    options = layersControlOptions(collapsed = FALSE),
    position = "topleft"
  ) %>%
  hideGroup(names(variables_mapa)[-1])

mapa <- mapa %>%
  htmlwidgets::onRender("
    function(el, x) {
      var map = this;
      
      // Configuraci√≥n de leyendas
      var legendConfigs = {
        'Crecimiento PIB': {
          title: 'CRECIMIENTO DEL PIB',
          subtitle: '(% anual)',
          min: -10,
          max: 10,
          colors: ['#ff1744', '#ff6b00', '#ffd600', '#00e676', '#00e5ff'],
          labels: ['-10%', '-5%', '0%', '5%', '10%']
        },
        'Acceso electricidad': {
          title: 'ACCESO A ELECTRICIDAD',
          subtitle: '(% de poblaci√≥n)',
          min: 0,
          max: 100,
          colors: ['#1a1a2e', '#0084ff', '#00e5ff', '#00e676', '#ffd600'],
          labels: ['0%', '25%', '50%', '75%', '100%']
        },
        'Crecimiento poblacion': {
          title: 'CRECIMIENTO POBLACI√ìN',
          subtitle: '(% anual)',
          min: -2,
          max: 4,
          colors: ['#0084ff', '#00e5ff', '#a259ff', '#ff6b00', '#ff1744'],
          labels: ['-2%', '-1%', '0%', '2%', '4%']
        }
      };
      
      // Crear leyenda
      var LegendControl = L.Control.extend({
        options: { position: 'bottomright' },
        onAdd: function(map) {
          var div = L.DomUtil.create('div', 'info legend');
          div.id = 'bar-legend';
          return div;
        }
      });
      
      map.addControl(new LegendControl());
      
      // Funci√≥n para crear barra de gradiente
      function updateLegend(varName) {
        var div = document.getElementById('bar-legend');
        var config = legendConfigs[varName];
        
        // Crear gradiente CSS
        var gradient = 'linear-gradient(to right';
        config.colors.forEach(function(color) {
          gradient += ', ' + color;
        });
        gradient += ')';
        
        var html = '<div style=\"background: linear-gradient(135deg, #0a0e1a, #12161f); padding: 18px; border-radius: 10px; border: 2px solid #00e5ff; box-shadow: 0 8px 32px rgba(0,0,0,0.9); min-width: 280px;\">';
        
        // T√≠tulo
        html += '<div style=\"color: #00e5ff; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 4px; text-align: center; text-shadow: 0 0 10px rgba(0,229,255,0.5);\">' + config.title + '</div>';
        html += '<div style=\"color: #8b92a0; font-size: 11px; text-align: center; margin-bottom: 12px;\">' + config.subtitle + '</div>';
        
        // Barra de color
        html += '<div style=\"height: 20px; background: ' + gradient + '; border-radius: 4px; border: 1px solid #00e5ff; margin-bottom: 8px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);\"></div>';
        
        // Etiquetas
        html += '<div style=\"display: flex; justify-content: space-between; font-size: 11px; color: #e0e6ed;\">';
        config.labels.forEach(function(label) {
          html += '<span>' + label + '</span>';
        });
        html += '</div>';
        
        html += '</div>';
        div.innerHTML = html;
      }
      
      // Inicializar
      updateLegend('Crecimiento PIB');
      
      // Actualizar al cambiar capa
      map.on('baselayerchange', function(e) {
        updateLegend(e.name);
      });
      
      // Estilizar control de capas
      setTimeout(function() {
        var ctrl = document.querySelector('.leaflet-control-layers');
        if (ctrl) {
          ctrl.style.background = 'linear-gradient(135deg, #0a0e1a, #12161f)';
          ctrl.style.border = '2px solid rgba(0, 229, 255, 0.4)';
          ctrl.style.borderRadius = '10px';
          ctrl.style.padding = '18px';
          ctrl.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.9)';
        }
        
        var base = document.querySelector('.leaflet-control-layers-base');
        if (base && !document.getElementById('sel-title')) {
          var title = document.createElement('div');
          title.id = 'sel-title';
          title.innerHTML = '<strong style=\"color: #00e5ff; font-size: 13px; text-transform: uppercase; letter-spacing: 1.5px; text-shadow: 0 0 10px rgba(0,229,255,0.5);\">üìä SELECCIONA VARIABLE</strong>';
          title.style.marginBottom = '12px';
          title.style.paddingBottom = '10px';
          title.style.borderBottom = '2px solid rgba(0, 229, 255, 0.3)';
          base.insertBefore(title, base.firstChild);
        }
        
        var labels = document.querySelectorAll('.leaflet-control-layers-base label');
        labels.forEach(function(label, idx) {
          label.style.color = '#e0e6ed';
          label.style.fontSize = '13px';
          label.style.fontWeight = '600';
          label.style.padding = '9px 12px';
          label.style.margin = '4px 0';
          label.style.display = 'block';
          label.style.borderRadius = '6px';
          label.style.cursor = 'pointer';
          label.style.transition = 'all 0.3s';
          
          var input = label.querySelector('input');
          if (input) {
            input.style.accentColor = '#00e5ff';
            if (idx === 0) {
              label.style.background = 'rgba(0, 229, 255, 0.15)';
              label.style.color = '#00e5ff';
            }
          }
          
          label.addEventListener('mouseenter', function() {
            this.style.background = 'rgba(0, 229, 255, 0.1)';
            this.style.color = '#00e5ff';
          });
          
          label.addEventListener('mouseleave', function() {
            if (!this.querySelector('input').checked) {
              this.style.background = 'transparent';
              this.style.color = '#e0e6ed';
            }
          });
        });
        
        var inputs = document.querySelectorAll('.leaflet-control-layers-base input');
        inputs.forEach(function(input) {
          input.addEventListener('change', function() {
            labels.forEach(function(l) {
              l.style.background = 'transparent';
              l.style.color = '#e0e6ed';
            });
            if (this.checked) {
              this.parentElement.style.background = 'rgba(0, 229, 255, 0.15)';
              this.parentElement.style.color = '#00e5ff';
            }
          });
        });
      }, 100);
    }
  ")

mapa
```


En crecimiento PIB, se observa segregaci√≥n clara: Europa y Am√©rica del Norte tienden a tonos amarillo-verde (crecimiento moderado), mientras muchas naciones africanas muestran tonos negros o rojo oscuro (estancamiento). Asia exhibe m√°xima variabilidad: gigantes como India y Bangladesh en verde (crecimiento din√°mico), mientras Jap√≥n mantiene tonos amarillos (crecimiento moderado). En acceso a electricidad, la brecha digital-energ√©tica es evidente: Europa, Am√©rica del Norte y gran parte de Asia en amarillo (acceso universal), mientras amplias regiones de √Åfrica central permanecen en azul oscuro. Am√©rica Latina exhibe transici√≥n: colores intermedios reflejando acceso extendido pero no universal. En crecimiento poblacional, se observa un patr√≥n opuesto al desarrollo econ√≥mico: Europa y Jap√≥n dominan tonos azules (declive demogr√°fico), mientras √Åfrica muestra naranjas y rojos intensos (presi√≥n poblacional extrema), y Am√©rica Latina ocupa posiciones intermedias. Esta disociaci√≥n geogr√°fica entre prosperidad econ√≥mica, acceso de servicios b√°sicos y din√°mica demogr√°fica anticipa que el an√°lisis multivariado revelar√° si estas dimensiones operan de forma integrada o representan trayectorias divergentes del desarrollo.

------------------------------------------------------------------------

## Visualizaciones Exploratorias

# Resultados del modelo

## Analisis de componentes principales (ACP)

### Matriz de correlaciones

Antes de aplicar el An√°lisis de Componentes Principales, es fundamental examinar la estructura de correlaciones entre las 17 variables para identificar redundancias potenciales y validar la pertinencia de la reducci√≥n de dimensionalidad. La matriz de correlaci√≥n de Pearson revela las asociaciones lineales entre pares de variables, proporcionando una visi√≥n exploratoria de c√≥mo las dimensiones del desarrollo se interrelacionan. (Jolliffe, 2002).

```{r matriz-correlaciones-cyber, fig.height=9, fig.width=14, out.width="100%"}
datos_analisis <- Base_2022 %>%
  select(-Codigo) %>%
  column_to_rownames("Pais")

matriz_cor <- cor(datos_analisis, use = "complete.obs")

# Nombres completos para mejor legibilidad
nombres_completos <- c(
  "PIB_per" = "PIB per c√°pita",
  "Poblacion" = "Poblaci√≥n total",
  "Esperanza vida" = "Esperanza de vida",
  "Acceso electricidad" = "Acceso electricidad",
  "Area boscosa" = "√Årea boscosa",
  "Suscripciones movil" = "Suscripciones m√≥viles",
  "Crecimiento PIB" = "Crecimiento PIB",
  "Mortalidad infantil" = "Mortalidad infantil",
  "Inversion extranjera" = "Inversi√≥n extranjera",
  "Gasto salud" = "Gasto en salud",
  "Uso internet" = "Uso de internet",
  "Importaciones" = "Importaciones",
  "Exportaciones" = "Exportaciones",
  "Tierra cultivable" = "Tierra cultivable",
  "Crecimiento poblacion" = "Crecimiento poblaci√≥n",
  "Industria" = "Industria",
  "Remesas" = "Remesas"
)

# Aplicar nombres completos
rownames(matriz_cor) <- nombres_completos[rownames(matriz_cor)]
colnames(matriz_cor) <- nombres_completos[colnames(matriz_cor)]

# Crear heatmap interactivo con tema cyber
heatmap_interactivo <- plot_ly(
  x = colnames(matriz_cor),
  y = rownames(matriz_cor),
  z = matriz_cor,
  type = "heatmap",
  colors = colorRamp(c("#ff1744", "#0a0e1a", "#00e5ff")),  # Rojo cyber - Negro - Cyan cyber
  hoverinfo = "text",
  text = matrix(
    paste(
      "<b>", rep(colnames(matriz_cor), each = nrow(matriz_cor)), "</b><br>",
      "vs <b>", rep(rownames(matriz_cor), times = ncol(matriz_cor)), "</b><br>",
      "Correlaci√≥n: <b style='color:#00e5ff'>", round(c(matriz_cor), 3), "</b>"
    ),
    nrow = nrow(matriz_cor),
    ncol = ncol(matriz_cor)
  ),
  colorbar = list(
    title = list(
      text = "<b>Correlaci√≥n</b>",
      font = list(color = "#e0e6ed", size = 12)
    ),
    tickfont = list(color = "#8b92a0", size = 10),
    thickness = 15,
    len = 0.8
  )
) %>%
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:20px;'>üåê Matriz de Correlaciones Multidimensional</b><br>
             <span style='color:#8b92a0; font-size:13px;'>17 Variables de Desarrollo Global | A√±o 2022</span>",
      x = 0.05,
      y = 0.95,
      font = list(size = 14)
    ),
    xaxis = list(
      title = "",
      tickangle = -45,
      tickfont = list(size = 10, color = "#8b92a0"),
      showgrid = FALSE,
      zeroline = FALSE
    ),
    yaxis = list(
      title = "",
      tickfont = list(size = 10, color = "#8b92a0"),
      showgrid = FALSE,
      zeroline = FALSE
    ),
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed'),
    margin = list(l = 180, r = 50, b = 180, t = 120),
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 11, family = "Arial")
    ),
    annotations = list(
      list(
        x = 0.5,
        y = -0.18,
        text = "<span style='color:#8b92a0; font-size:11px;'>üîç Haz clic y arrastra para zoom ‚Ä¢ üìä Pasa el cursor para ver valores exactos</span>",
        showarrow = FALSE,
        xref = "paper",
        yref = "paper",
        font = list(size = 11)
      )
    )
  ) %>%
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "matriz_correlaciones_cyber",
      width = 1400,
      height = 1000
    )
  )

heatmap_interactivo

matriz_cor_long <- matriz_cor %>%
  as.data.frame() %>%
  rownames_to_column("Variable1") %>%
  pivot_longer(
    cols = -Variable1,
    names_to = "Variable2",
    values_to = "Correlacion"
  ) %>%
  filter(Variable1 != Variable2) %>%
  mutate(Correlacion = round(Correlacion, 3))

nombres_abreviados <- c(
  "PIB per c√°pita" = "PIB pc",
  "Poblaci√≥n total" = "Poblaci√≥n",
  "Esperanza de vida" = "Esp. vida",
  "Acceso electricidad" = "Electricidad",
  "√Årea boscosa" = "Bosques",
  "Suscripciones m√≥viles" = "M√≥vil",
  "Crecimiento PIB" = "Crec. PIB",
  "Mortalidad infantil" = "Mort. inf.",
  "Inversi√≥n extranjera" = "IED",
  "Gasto en salud" = "Salud",
  "Uso de internet" = "Internet",
  "Importaciones" = "Import.",
  "Exportaciones" = "Export.",
  "Tierra cultivable" = "Cultivable",
  "Crecimiento poblaci√≥n" = "Crec. pob.",
  "Industria" = "Industria",
  "Remesas" = "Remesas"
)

cor_significativas <- matriz_cor_long %>%
  mutate(
    Variable1_abr = nombres_abreviados[Variable1],
    Variable2_abr = nombres_abreviados[Variable2]
  ) %>%
  filter(abs(Correlacion) > 0.5) %>%
  arrange(desc(abs(Correlacion))) %>%
  select(Variable1_abr, Variable2_abr, Correlacion) %>%
  distinct()

tabla_cor <- cor_significativas %>%
  gt() %>%
  tab_header(
    title = md("**üîó Correlaciones Significativas entre Variables**"),
    subtitle = "Relaciones con |r| > 0.5 entre indicadores de desarrollo global"
  ) %>%
  cols_label(
    Variable1_abr = md("**Variable 1**"),
    Variable2_abr = md("**Variable 2**"),
    Correlacion = md("**Correlaci√≥n (r)**")
  ) %>%
  cols_align(
    align = "center",
    columns = everything()
  ) %>%
  fmt_number(
    columns = Correlacion,
    decimals = 3
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium", color = "#000000"),
      cell_fill(color = "#00e5ff")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "#00e5ff",
      weight = px(2)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "#00e5ff",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Variable1_abr, Variable2_abr))
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#0a0e1a"),
      cell_text(color = "#e0e6ed")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = cell_text(weight = "bold", color = "#00e5ff"),
    locations = cells_body(columns = c(Variable1_abr, Variable2_abr))
  ) %>%
  tab_style(
    style = cell_fill(color = "rgba(0, 230, 118, 0.15)"),
    locations = cells_body(
      rows = Correlacion > 0.7
    )
  ) %>%
  tab_style(
    style = cell_fill(color = "rgba(255, 23, 68, 0.15)"),
    locations = cells_body(
      rows = Correlacion < -0.7
    )
  ) %>%
  tab_style(
    style = cell_text(color = "#00e676"),
    locations = cells_body(
      rows = Correlacion > 0.7,
      columns = Correlacion
    )
  ) %>%
  tab_style(
    style = cell_text(color = "#ff1744"),
    locations = cells_body(
      rows = Correlacion < -0.7,
      columns = Correlacion
    )
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(90),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "solid",
    column_labels.border.top.color = "#00e5ff",
    column_labels.border.top.width = px(3),
    column_labels.border.bottom.style = "solid",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "#00e5ff",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    table_body.hlines.style = "solid",
    table_body.hlines.color = "#00e5ff",
    table_body.hlines.width = px(1),
    table.background.color = "#0a0e1a",
    data_row.padding = px(10),
    heading.title.font.size = 18,
    heading.subtitle.font.size = 14,
    heading.padding = px(12),
    heading.border.bottom.style = "solid",
    heading.border.bottom.width = px(2),
    heading.border.bottom.color = "#00e5ff",
    footnotes.padding = px(10),
    footnotes.font.size = 12,
    source_notes.font.size = 12,
    source_notes.padding = px(10)
  ) %>%
  tab_source_note(
    source_note = md("**Fuente:** Elaboraci√≥n propia con base en World Bank (2023)")
  ) %>%
  tab_footnote(
    footnote = "üíö Correlaciones positivas fuertes (r > 0.7) indican relaciones directas significativas",
    locations = cells_body(rows = 1)
  ) %>%
  tab_footnote(
    footnote = "‚ù§Ô∏è Correlaciones negativas fuertes (r < -0.7) indican relaciones inversas significativas",
    locations = cells_body(rows = nrow(cor_significativas))
  )

tabla_cor

```

La matriz de correlaci√≥n entre todas las variables de desarrollo es fundamental porque exhibe patrones predecibles: variables econ√≥micas tienden a correlacionarse positivamente entre s√≠ (PIB per c√°pita, crecimiento del PIB, inversi√≥n extranjera), variables de bienestar social correlacionan positivamente (esperanza de vida, acceso a electricidad, uso de internet), y existe una correlaci√≥n positiva sustancial entre estas dos dimensiones generales (Hastie et al., 2009). Adicionalmente, se observan correlaciones negativas entre indicadores de rezago (mortalidad infantil, tierra cultivable) y variables de desarrollo avanzado, reflejando que pa√≠ses con mayor riqueza y bienestar exhiben menores tasas de mortalidad y menor dependencia agr√≠cola. La presencia de correlaciones altas (superiores a 0.7) entre m√∫ltiples pares de variables justifica plenamente la aplicaci√≥n del ACP: la reducci√≥n dimensional elimina redundancia sin perder informaci√≥n esencial (Jolliffe, 2002; Hastie et al., 2009).

### ACP

El An√°lisis de Componentes Principales fue aplicado al conjunto de 17 variables estandarizadas para identificar las dimensiones latentes subyacentes de variabilidad en el desarrollo internacional. El procedimiento consiste en la descomposici√≥n espectral de la matriz de covarianza estandarizada, identificando vectores propios (componentes) ordenados seg√∫n sus valores propios (autovalores) en orden descendente. Cada componente principal es una combinaci√≥n lineal ortogonal de las variables originales, dise√±ada para capturar la m√°xima varianza posible de manera sucesiva (Jolliffe, 2002; Hastie et al., 2009).

```{r ACP}


acp_temp <- dudi.pca(datos_analisis, center = TRUE, scale = TRUE, scannf = FALSE, nf = ncol(datos_analisis))

varianza_acum <- cumsum(acp_temp$eig) / sum(acp_temp$eig) * 100

n_componentes <- which(varianza_acum >= 70)[1]

acp_resultado <- dudi.pca(
  df = datos_analisis,
  center = TRUE,
  scale = TRUE,
  scannf = FALSE,
  nf = n_componentes
)

factores <- acp_resultado$li

```


```{r Tabla varianza}

varianza_df <- data.frame(
  Componente = factor(1:length(acp_resultado$eig)),
  Varianza = acp_resultado$eig / sum(acp_resultado$eig) * 100,
  VarianzaAcum = varianza_acum
) %>%  gt() %>%
  tab_header(
    title = md("**Tabla 5**"),
    subtitle = "Varianza Explicada por Componentes Principales"
  ) %>%
  cols_label(
    Componente = md("**Componente**"),
    Varianza = md("**Varianza (%)**"),
    VarianzaAcum = md("**Varianza Acumulada (%)**")
  ) %>%
  cols_align(
    align = "left",
    columns = everything()
  ) %>%
  fmt_number(
    columns = c(Varianza, VarianzaAcum),
    decimals = 2
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold", size = "medium"),
      cell_fill(color = "white")
    ),
    locations = cells_column_labels()
  ) %>%
  tab_style(
    style = cell_borders(
      sides = c("top", "bottom"),
      color = "black",
      weight = px(1)
    ),
    locations = list(
      cells_column_labels(),
      cells_body()
    )
  ) %>%
  tab_style(
    style = cell_borders(
      sides = "right",
      color = "gray80",
      weight = px(1)
    ),
    locations = cells_body(columns = c(Componente, Varianza))
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(columns = Componente)
  ) %>%
  tab_style(
    style = cell_text(size = "small"),
    locations = cells_body(columns = c(Varianza, VarianzaAcum))
  ) %>%
  tab_options(
    table.font.names = "Arial",
    table.width = pct(100),
    table.border.top.style = "none",
    table.border.bottom.style = "none",
    column_labels.border.top.style = "none",
    column_labels.border.bottom.width = px(2),
    column_labels.border.bottom.color = "black",
    table_body.border.bottom.style = "none",
    table_body.border.top.style = "none",
    data_row.padding = px(8),
    heading.title.font.size = 14,
    heading.subtitle.font.size = 12,
    heading.padding = px(4),
    footnotes.padding = px(4)
  ) %>%
  tab_source_note(
    source_note = md("**Fuentes:** Elaboraci√≥n propia con base en los resultados del ACP")
  ) %>%
  tab_footnote(
    footnote = "Porcentaje de varianza explicada individualmente por cada componente principal",
    locations = cells_body(
      rows = 1,
      columns = Varianza
    )
  ) %>%
  tab_footnote(
    footnote = "Porcentaje acumulado de varianza explicada por los componentes hasta el actual",
    locations = cells_body(
      rows = 1,
      columns = VarianzaAcum
    )
  ) %>%
  tab_footnote(
    footnote = "Los componentes principales se ordenan de mayor a menor varianza explicada",
    locations = cells_title(groups = "subtitle")
  )

varianza_df 

varianza_df <- data.frame(
  Componente = paste0("PC", 1:length(acp_resultado$eig)),
  Varianza = acp_resultado$eig / sum(acp_resultado$eig) * 100,
  VarianzaAcum = varianza_acum
)

pc1_var <- round(varianza_df$Varianza[1], 1)
pc2_var <- round(varianza_df$Varianza[2], 1)
pc3_var <- round(varianza_df$Varianza[3], 1)
pc4_var <- round(varianza_df$Varianza[4], 1)
pc5_var <- round(varianza_df$Varianza[5], 1)
pc6_var <- round(varianza_df$Varianza[6], 1)

pc1_acum <- round(varianza_df$VarianzaAcum[1], 1)
pc2_acum <- round(varianza_df$VarianzaAcum[2], 1)
pc3_acum <- round(varianza_df$VarianzaAcum[3], 1)
pc4_acum <- round(varianza_df$VarianzaAcum[4], 1)
pc5_acum <- round(varianza_df$VarianzaAcum[5], 1)
pc6_acum <- round(varianza_df$VarianzaAcum[6], 1)


```

En este an√°lisis, el primer componente (**PC1**) captur√≥ un **`r pc1_var`%** de la varianza total, lo que indica que existe una dimensi√≥n principal que diferencia fundamentalmente a los pa√≠ses. Los componentes posteriores capturan variabilidad subsidiaria: el segundo componente (**PC2**) explica **`r pc2_var`%** (acumulando **`r pc2_acum`%**), el tercero (**PC3**) **`r pc3_var`%** (acumulando **`r pc3_acum`%**), el cuarto (**PC4**) **`r pc4_var`%** (acumulando **`r pc4_acum`%**).

### Grafico de sedimentacion

El gr√°fico de sedimentaci√≥n visualiza el concepto del "codo" (elbow) introducido por Kaiser (1960). La curva de los eigenvalores (representada como barras) exhibe un descenso pronunciado en los primeros componentes, indicando que capturan varianza sustancial. A partir de cierto componente, la pendiente se aplana significativamente, entrando en un r√©gimen donde componentes posteriores explican proporciones cada vez menores de varianza residual (Hastie et al., 2009).


```{r sedimentacion-cyber, fig.height=7, fig.width=12, out.width="100%"}
res.pca <- prcomp(datos_analisis, scale = TRUE)

eig.val <- get_eigenvalue(res.pca)

n_comp <- min(10, nrow(eig.val))

eig_df <- data.frame(
  Componente = factor(1:n_comp),
  Varianza = eig.val[1:n_comp, 2]
)

g <- ggplot(eig_df, aes(x = Componente, y = Varianza)) +
  geom_bar(stat = "identity", fill = "#00e5ff", color = "#00e5ff", alpha = 0.8) +
  geom_line(aes(group = 1), color = "#00e5ff", size = 1) +
  geom_point(color = "#00e5ff", size = 2) +
  geom_text(aes(label = round(Varianza, 1)), color = "#ffffff", vjust = -0.4, fontface = "bold", size = 4) +
  theme_cyber() +
  labs(
    title = "Varianza Explicada por Componente Principal",
    subtitle = "Autovalores del an√°lisis de componentes principales",
    x = "Componentes Principales",
    y = "Porcentaje de Varianza Explicada (%)"
  ) +
  theme(
    plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#00e5ff", margin = margin(b = 10)),
    plot.subtitle = element_text(size = 13, hjust = 0.5, color = "#8b92a0", margin = margin(b = 15)),
    axis.title = element_text(face = "bold", size = 14, color = "#e0e6ed"),
    axis.title.x = element_text(margin = margin(t = 10)),
    axis.title.y = element_text(margin = margin(r = 10)),
    axis.text = element_text(size = 11, color = "#8b92a0"),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "#12161f", size = 0.5)
  ) +
  ylim(0, max(eig_df$Varianza) + 5)

g
```

```{r, include=FALSE}
res.var <- get_pca_var(res.pca)
res.pca$coord          
res.var$contrib        
res.var$cos2  
```


El punto donde esta curvatura cambia de pronunciada a plana (el "codo") indica aproximadamente el n√∫mero de componentes que retienen informaci√≥n relevante; componentes posteriores al codo tienden a capturar principalmente ruido estad√≠stico (Jolliffe, 2002). En este an√°lisis, la l√≠nea verde punteada marca el umbral del 70%, y la intersecci√≥n de la l√≠nea morada acumulada con este umbral define el n√∫mero final de componentes 6 que ser√° utilizado para la clusterizaci√≥n posterior.

### Contribuci√≥n de Variables a Componentes Principales

La comprensi√≥n de c√≥mo cada variable original contribuye a la definici√≥n de los componentes principales es esencial para interpretar las dimensiones latentes descubiertas. La contribuci√≥n de una variable a un componente cuantifica el grado en el cual esa variable particular "explica" o "define" la direcci√≥n de ese componente en el espacio multidimensional original. Matem√°ticamente, la contribuci√≥n se expresa como porcentaje de la varianza del componente que puede atribuirse a cada variable (Hastie et al., 2009; Jolliffe, 2002).

Adicionalmente, la calidad de representaci√≥n (cos¬≤) de una variable en un componente indica qu√© proporci√≥n de la variabilidad total de esa variable es capturada por el componente. Un cos¬≤ cercano a 1 significa que la variable est√° casi completamente explicada por ese componente; un cos¬≤ cercano a 0 significa que la variable requiere componentes posteriores para ser bien representada (Jolliffe, 2002). Estas dos medidas‚Äîcontribuci√≥n y $cos^2$‚Äîson complementarias: la primera explica la importancia relativa de una variable en definir un componente; la segunda explica qu√© tan bien ese componente explica la variable (Hastie et al., 2009).

```{r contribucion}

contribuciones <- as.data.frame(acp_resultado$co)
contribuciones$Variable <- rownames(contribuciones)

cos2_df <- as.data.frame(acp_resultado$co^2)
cos2_df$Variable <- rownames(cos2_df)

crear_tabla_contribucion <- function(componente_num, contrib_df, cos2_df, titulo, tabla_num) {
  comp_data <- contrib_df %>%
    select(Variable, paste0("Comp", componente_num)) %>%
    rename(Loading = paste0("Comp", componente_num))
  
  cos2_data <- cos2_df %>%
    select(Variable, paste0("Comp", componente_num)) %>%
    rename(Cos2 = paste0("Comp", componente_num))
  
  comp_data <- comp_data %>%
    left_join(cos2_data, by = "Variable") %>%
    mutate(LoadingAbs = abs(Loading)) %>%
    arrange(desc(LoadingAbs)) %>%
    select(-LoadingAbs) %>%
    mutate(
      Loading = round(Loading, 4),
      Cos2 = round(Cos2, 4)
    )
  
  descripciones <- c(
    "PIB_per" = "PIB per c√°pita (US$)",
    "Poblacion" = "Poblaci√≥n total",
    "Esperanza vida" = "Esperanza de vida al nacer (a√±os)",
    "Acceso electricidad" = "Acceso a electricidad (% poblaci√≥n)",
    "Area boscosa" = "√Årea boscosa (% territorio)",
    "Suscripciones movil" = "Suscripciones m√≥viles (cada 100 hab.)",
    "Crecimiento PIB" = "Crecimiento del PIB (% anual)",
    "Mortalidad infantil" = "Mortalidad infantil (cada 1,000 nac.)",
    "Inversion extranjera" = "Inversi√≥n extranjera (% PIB)",
    "Gasto salud" = "Gasto en salud (% PIB)",
    "Uso internet" = "Uso de internet (% poblaci√≥n)",
    "Importaciones" = "Importaciones (% PIB)",
    "Exportaciones" = "Exportaciones (% PIB)",
    "Tierra cultivable" = "Tierra cultivable (% territorio)",
    "Crecimiento poblacion" = "Crecimiento poblacional (% anual)",
    "Industria" = "Industria (% PIB)",
    "Remesas" = "Remesas recibidas (% PIB)"
  )
  
  comp_data <- comp_data %>%
    mutate(
      Descripcion = descripciones[Variable],
      Interpretacion = paste0(
        "Loading: ", Loading, 
        " | Cos¬≤: ", Cos2,
        case_when(
          abs(Loading) >= 0.3 ~ " (Contribuci√≥n muy fuerte)",
          abs(Loading) >= 0.2 ~ " (Contribuci√≥n fuerte)", 
          abs(Loading) >= 0.1 ~ " (Contribuci√≥n moderada)",
          abs(Loading) >= 0.05 ~ " (Contribuci√≥n d√©bil)",
          TRUE ~ " (Contribuci√≥n muy d√©bil)"
        )
      )
    ) %>%
    select(Variable, Descripcion, Interpretacion)
  
  tabla <- comp_data %>%
    gt() %>%
    tab_header(
      title = md(paste0("**Tabla ", tabla_num, "**")),
      subtitle = titulo
    ) %>%
    cols_label(
      Variable = md("**Variable**"),
      Descripcion = md("**Descripci√≥n**"),
      Interpretacion = md("**Interpretaci√≥n**")
    ) %>%
    cols_align(
      align = "left",
      columns = everything()
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold", size = "medium"),
        cell_fill(color = "white")
      ),
      locations = cells_column_labels()
    ) %>%
    tab_style(
      style = cell_borders(
        sides = c("top", "bottom"),
        color = "black",
        weight = px(1)
      ),
      locations = list(
        cells_column_labels(),
        cells_body()
      )
    ) %>%
    tab_style(
      style = cell_borders(
        sides = "right",
        color = "gray80",
        weight = px(1)
      ),
      locations = cells_body(columns = c(Variable, Descripcion))
    ) %>%
    tab_style(
      style = cell_text(weight = "bold"),
      locations = cells_body(columns = Variable)
    ) %>%
    tab_style(
      style = cell_text(size = "small"),
      locations = cells_body(columns = c(Descripcion, Interpretacion))
    ) %>%
    tab_options(
      table.font.names = "Arial",
      table.width = pct(100),
      table.border.top.style = "none",
      table.border.bottom.style = "none",
      column_labels.border.top.style = "none",
      column_labels.border.bottom.width = px(2),
      column_labels.border.bottom.color = "black",
      table_body.border.bottom.style = "none",
      table_body.border.top.style = "none",
      data_row.padding = px(8),
      heading.title.font.size = 14,
      heading.subtitle.font.size = 12,
      heading.padding = px(4),
      footnotes.padding = px(4)
    ) %>%
    tab_source_note(
      source_note = md("**Fuentes:** Elaboraci√≥n propia con base en los resultados del ACP")
    ) %>%
    tab_footnote(
      footnote = "Loading: contribuci√≥n de la variable al componente (valores absolutos >0.3 indican contribuci√≥n fuerte)",
      locations = cells_title(groups = "subtitle")
    ) %>%
    tab_footnote(
      footnote = "Cos¬≤: calidad de representaci√≥n de la variable en el componente (valores cercanos a 1 indican mejor representaci√≥n)",
      locations = cells_body(
        rows = 1,
        columns = Interpretacion
      )
    )
  
  return(tabla)
}


tabla_pc1 <- crear_tabla_contribucion(1, contribuciones, cos2_df,
                                     "Contribuci√≥n de Variables al Componente Principal 1 (24.3% de varianza)",
                                     6)
tabla_pc2 <- crear_tabla_contribucion(2, contribuciones, cos2_df,
                                     "Contribuci√≥n de Variables al Componente Principal 2 (13.5% de varianza)", 
                                     7)
tabla_pc3 <- crear_tabla_contribucion(3, contribuciones, cos2_df,
                                     "Contribuci√≥n de Variables al Componente Principal 3 (9.1% de varianza)",
                                     8)
tabla_pc4 <- crear_tabla_contribucion(4, contribuciones, cos2_df,
                                     "Contribuci√≥n de Variables al Componente Principal 4 (7.5% de varianza)",
                                     9)

tabla_pc1
tabla_pc2
tabla_pc3
tabla_pc4
```

### An√°lisis Multivariado: Interpretaci√≥n de Componentes y Pa√≠ses

Una vez identificados los componentes principales y cuantificadas las contribuciones de cada variable, es fundamental realizar un an√°lisis multivariado que permita interpretar simult√°neamente las relaciones entre pa√≠ses y variables en el espacio reducido de componentes principales. Este an√°lisis se fundamenta en visualizaciones bidimensionales que proyectan tanto pa√≠ses (individuos) como variables sobre los planos definidos por pares de componentes principales, revelando patrones de similitud, agrupamientos naturales y caracter√≠sticas diferenciadoras entre grupos de pa√≠ses (Jolliffe, 2002; Hastie et al., 2009).

```{r individuos DIM 1 Y DIM 2, fig.height=8, fig.width=14, out.width="100%"}
ind_data <- get_pca_ind(res.pca)

ind_df <- data.frame(
  Pais = rownames(ind_data$coord),
  Dim1 = ind_data$coord[, 1],
  Dim2 = ind_data$coord[, 2],
  Dim3 = ind_data$coord[, 3],
  Dim4 = ind_data$coord[, 4],
  Contrib1 = ind_data$contrib[, 1],
  Contrib2 = ind_data$contrib[, 2],
  Contrib3 = ind_data$contrib[, 3],
  Contrib4 = ind_data$contrib[, 4],
  Cos2_1 = ind_data$cos2[, 1],
  Cos2_2 = ind_data$cos2[, 2],
  Cos2_3 = ind_data$cos2[, 3],
  Cos2_4 = ind_data$cos2[, 4]
)

# Crear paleta cyber para las contribuciones
cyber_color_scale <- colorRampPalette(c("#0084ff", "#00e5ff", "#a259ff", "#ff1744"))(100)

p1 <- plot_ly(ind_df,
              x = ~Dim1, 
              y = ~Dim2,
              color = ~Contrib1,
              colors = cyber_color_scale,
              text = ~paste("<b style='color:#00e5ff; font-size:14px;'>", Pais, "</b><br>",
                            "<span style='color:#8b92a0;'>COORDENADAS PCA:</span><br>",
                            "‚îú‚îÄ Dim 1: <b style='color:#00e676;'>", round(Dim1, 3), "</b><br>",
                            "‚îú‚îÄ Dim 2: <b style='color:#00e5ff;'>", round(Dim2, 3), "</b><br>",
                            "<br><span style='color:#8b92a0;'>CONTRIBUCI√ìN:</span><br>",
                            "‚îú‚îÄ Dim 1: <b style='color:#ffd600;'>", round(Contrib1, 2), "%</b><br>",
                            "‚îú‚îÄ Dim 2: <b style='color:#a259ff;'>", round(Contrib2, 2), "%</b><br>",
                            "<br><span style='color:#8b92a0;'>CALIDAD REPRESENTACI√ìN (Cos¬≤):</span><br>",
                            "‚îú‚îÄ Dim 1: <b style='color:#00e676;'>", round(Cos2_1, 3), "</b><br>",
                            "‚îî‚îÄ Dim 2: <b style='color:#0084ff;'>", round(Cos2_2, 3), "</b>"),
              type = "scatter",
              mode = "markers",
              marker = list(
                size = 12, 
                opacity = 0.85, 
                line = list(width = 1.5, color = "#ffffff"),
                symbol = 'circle'
              ),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:20px;'>An√°lisis de Componentes Principales</b><br>
             <span style='color:#8b92a0; font-size:14px;'>Individuos: Dimensi√≥n 1 vs Dimensi√≥n 2 | Coloreado por Contribuci√≥n a Dim 1</span>",
      x = 0.5,
      xanchor = 'center',
      y = 0.95
    ),
    xaxis = list(
      title = "<b style='font-size:14px;'>Dimensi√≥n 1</b>",
      zeroline = TRUE, 
      zerolinecolor = "rgba(0, 229, 255, 0.3)",
      zerolinewidth = 2,
      gridcolor = '#12161f',
      showgrid = TRUE,
      tickfont = list(color = '#8b92a0', size = 12),
      titlefont = list(color = '#e0e6ed', size = 14)
    ),
    yaxis = list(
      title = "<b style='font-size:14px;'>Dimensi√≥n 2</b>",
      zeroline = TRUE, 
      zerolinecolor = "rgba(0, 229, 255, 0.3)",
      zerolinewidth = 2,
      gridcolor = '#12161f',
      showgrid = TRUE,
      tickfont = list(color = '#8b92a0', size = 12),
      titlefont = list(color = '#e0e6ed', size = 14)
    ),
    hovermode = "closest",
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 12),
    margin = list(l = 80, r = 50, b = 80, t = 100),
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    coloraxis = list(
      colorbar = list(
        title = list(
          text = "<b>Contribuci√≥n<br>Dim 1 (%)</b>",
          font = list(size = 12, color = "#e0e6ed")
        ),
        tickfont = list(color = '#8b92a0', size = 11),
        thickness = 20,
        len = 0.75
      )
    ),
    annotations = list(
      list(
        x = 0.5, 
        y = -0.12,
        xref = "paper", 
        yref = "paper",
        text = "<span style='color:#8b92a0; font-size:11px;'>Cada punto representa un pa√≠s. Colores indican contribuci√≥n a la Dimensi√≥n 1. Hover para detalles.</span>",
        showarrow = FALSE,
        xanchor = "center",
        align = "center"
      )
    )
  ) %>%
  
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "pca_individuos_dim1_dim2",
      width = 1200,
      height = 800
    )
  )

p1
```
Se puede observar que Qatar tiene una contribuci√≥n alta en la dimension 2, la cual es de 11.66%, es algo esperable sabiendo que el pa√≠s √°rabe tiene un gran comercio.
Mientras que San Marino contribuye en la dimensi√≥n 2 con un 0.3%, contrariamente de su aporte en la dimensi√≥n 1 el cual es 3.14%, lo cual refiere a qu√© este pa√≠s, tiene una baja tasa econ√≥mica mientras que en factores como esperanza de vida es muy fuerte.

Al contrario podemos ver pa√≠ses como Niger el cual la dimensi√≥n 2 tiene un aporte de 0,64%, lo cual nos da a pensar que este pa√≠s tiene deficiencia en lo econ√≥mico

```{r individuos DIM 3 Y DIM 4, fig.height=8, fig.width=14, out.width="100%"}
p2 <- plot_ly(ind_df,
              x = ~Dim3, 
              y = ~Dim4,
              color = ~Contrib3,
              colors = cyber_color_scale,
              text = ~paste("<b style='color:#00e5ff; font-size:14px;'>", Pais, "</b><br>",
                            "<span style='color:#8b92a0;'>COORDENADAS PCA:</span><br>",
                            "‚îú‚îÄ Dim 3: <b style='color:#00e676;'>", round(Dim3, 3), "</b><br>",
                            "‚îú‚îÄ Dim 4: <b style='color:#00e5ff;'>", round(Dim4, 3), "</b><br>",
                            "<br><span style='color:#8b92a0;'>CONTRIBUCI√ìN:</span><br>",
                            "‚îú‚îÄ Dim 3: <b style='color:#ffd600;'>", round(Contrib3, 2), "%</b><br>",
                            "‚îú‚îÄ Dim 4: <b style='color:#a259ff;'>", round(Contrib4, 2), "%</b><br>",
                            "<br><span style='color:#8b92a0;'>CALIDAD REPRESENTACI√ìN (Cos¬≤):</span><br>",
                            "‚îú‚îÄ Dim 3: <b style='color:#00e676;'>", round(Cos2_3, 3), "</b><br>",
                            "‚îî‚îÄ Dim 4: <b style='color:#0084ff;'>", round(Cos2_4, 3), "</b>"),
              type = "scatter",
              mode = "markers",
              marker = list(
                size = 12, 
                opacity = 0.85, 
                line = list(width = 1.5, color = "#ffffff"),
                symbol = 'circle'
              ),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  layout(
    title = list(
      text = "<b style='color:#00e5ff; font-size:20px;'>An√°lisis de Componentes Principales</b><br>
             <span style='color:#8b92a0; font-size:14px;'>Individuos: Dimensi√≥n 3 vs Dimensi√≥n 4 | Coloreado por Contribuci√≥n a Dim 3</span>",
      x = 0.5,
      xanchor = 'center',
      y = 0.95
    ),
    xaxis = list(
      title = "<b style='font-size:14px;'>Dimensi√≥n 3</b>",
      zeroline = TRUE, 
      zerolinecolor = "rgba(0, 229, 255, 0.3)",
      zerolinewidth = 2,
      gridcolor = '#12161f',
      showgrid = TRUE,
      tickfont = list(color = '#8b92a0', size = 12),
      titlefont = list(color = '#e0e6ed', size = 14)
    ),
    yaxis = list(
      title = "<b style='font-size:14px;'>Dimensi√≥n 4</b>",
      zeroline = TRUE, 
      zerolinecolor = "rgba(0, 229, 255, 0.3)",
      zerolinewidth = 2,
      gridcolor = '#12161f',
      showgrid = TRUE,
      tickfont = list(color = '#8b92a0', size = 12),
      titlefont = list(color = '#e0e6ed', size = 14)
    ),
    hovermode = "closest",
    plot_bgcolor = '#000000',
    paper_bgcolor = '#0a0e1a',
    font = list(family = "Arial, sans-serif", color = '#e0e6ed', size = 12),
    margin = list(l = 80, r = 50, b = 80, t = 100),
    hoverlabel = list(
      bgcolor = "rgba(10, 14, 26, 0.95)",
      bordercolor = "#00e5ff",
      font = list(color = "#e0e6ed", size = 12, family = "Arial")
    ),
    coloraxis = list(
      colorbar = list(
        title = list(
          text = "<b>Contribuci√≥n<br>Dim 3 (%)</b>",
          font = list(size = 12, color = "#e0e6ed")
        ),
        tickfont = list(color = '#8b92a0', size = 11),
        thickness = 20,
        len = 0.75
      )
    ),
    annotations = list(
      list(
        x = 0.5, 
        y = -0.12,
        xref = "paper", 
        yref = "paper",
        text = "<span style='color:#8b92a0; font-size:11px;'>Cada punto representa un pa√≠s. Colores indican contribuci√≥n a la Dimensi√≥n 3. Hover para detalles.</span>",
        showarrow = FALSE,
        xanchor = "center",
        align = "center"
      )
    )
  ) %>%
  
  config(
    responsive = TRUE,
    displayModeBar = TRUE,
    displaylogo = FALSE,
    modeBarButtonsToRemove = list('lasso2d', 'select2d'),
    toImageButtonOptions = list(
      format = "png",
      filename = "pca_individuos_dim3_dim4",
      width = 1200,
      height = 800
    )
  )

p2
```

Al observar el grafico podemos identificar algunos datos, casos como la India donde su aporte en la dimensi√≥n 4 es de 18,65% lo cual nos demuestra su gran tasa poblacional y de tierra cultivable.
Timor-leste tiene un aporte en la dimensi√≥n 4 de un 8.49% el cual refiere que tiene poca tendencia de uso de internet y un alta √°rea boscosa.
Otro caso a referir Djibouti tiene dos valores importantes en la dimensi√≥n 3 tiene un aporte de 10.69% y en la 4 de 0,28%, lo cual refiere que es uno de los paises que menos exporta y m√°s importa.

### Representaci√≥n de Variables en el Plano de Componentes Principales

El c√≠rculo de correlaciones es una herramienta fundamental para interpretar las dimensiones latentes capturadas por PC1 y PC2. Cada una de las 17 variables originales se representa como un vector (flecha) proyectado desde el origen hacia el plano bidimensional definido por los dos primeros componentes principales. La longitud de cada flecha indica la calidad de representaci√≥n de esa variable: flechas largas (pr√≥ximas al c√≠rculo unitario de referencia) indican variables bien representadas en PC1-PC2, mientras que flechas cortas indican que la variable requiere componentes posteriores para ser completamente explicada (Jolliffe, 2002; Hastie et al., 2009).

La direcci√≥n de cada flecha‚Äîes decir, el √°ngulo que forma con los ejes PC1 y PC2‚Äîindica c√≥mo esa variable se correlaciona con los componentes. Las variables posicionadas en la direcci√≥n positiva del eje PC1 (hacia la derecha del gr√°fico) son aquellas que correlacionan positivamente con PC1 y, por lo tanto, caracterizan el polo derecho del eje.

```{r Variables DIM 1 Y DIM 2}

var_data <- get_pca_var(res.pca)

var_df <- data.frame(
  Variable = rownames(var_data$coord),
  Dim1 = var_data$coord[, 1],
  Dim2 = var_data$coord[, 2],
  Dim3 = var_data$coord[, 3],
  Dim4 = var_data$coord[, 4],
  Dim5 = var_data$coord[, 5],
  Dim6 = var_data$coord[, 6],
  Contrib1 = var_data$contrib[, 1],
  Contrib2 = var_data$contrib[, 2],
  Contrib3 = var_data$contrib[, 3],
  Contrib4 = var_data$contrib[, 4],
  Contrib5 = var_data$contrib[, 5],
  Contrib6 = var_data$contrib[, 6],
  Cos2_1 = var_data$cos2[, 1],
  Cos2_2 = var_data$cos2[, 2],
  Cos2_3 = var_data$cos2[, 3],
  Cos2_4 = var_data$cos2[, 4],
  Cos2_5 = var_data$cos2[, 5],
  Cos2_6 = var_data$cos2[, 6]
)


p1 <- plot_ly(var_df,
              x = ~Dim1, 
              y = ~Dim2,
              color = ~Contrib1,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Variable, "</b><br>",
                            "Dim 1:", round(Dim1, 3), "<br>",
                            "Dim 2:", round(Dim2, 3), "<br>",
                            "<b>Contribuci√≥n Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                            "<b>Contribuci√≥n Dim 2:</b> ", round(Contrib2, 2), "%<br>",
                            "Cos2 Dim 1:", round(Cos2_1, 3), "<br>",
                            "Cos2 Dim 2:", round(Cos2_2, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 12, opacity = 0.8, line = list(width = 2, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  add_segments(x = 0, xend = ~Dim1, y = 0, yend = ~Dim2,
               line = list(color = "rgba(100, 100, 100, 0.3)", width = 1),
               showlegend = FALSE, hoverinfo = "skip") %>%
  
  layout(
    title = list(
      text = "Variables: Dimensi√≥n 1 vs Dimensi√≥n 2<br><sub>Coloreado por Contribuci√≥n Dim 1</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensi√≥n 1", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensi√≥n 2", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p1
```
Observamos en el gr√°fico que las variables que m√°s contribuyen a la dimensi√≥n 1 son esperanza de vida positivamente (17.03%), uso de internet positivamente (16.88%) y mortalidad infantil negativamente (16.63%)
A la dimensi√≥n 2 son la indutria negativamente (27.37%), el crecimiento poblacional negativamente (18.23%) y las remesas positivamente (13.15%)


```{r Variables DIM 3 Y DIM 4}
p2 <- plot_ly(var_df,
              x = ~Dim3, 
              y = ~Dim4,
              color = ~Contrib3,
              colors = colorRampPalette(c("#00AFBB", "#E7B800", "#FC4E07"))(100),
              text = ~paste("<b>", Variable, "</b><br>",
                            "Dim 3:", round(Dim3, 3), "<br>",
                            "Dim 4:", round(Dim4, 3), "<br>",
                            "<b>Contribuci√≥n Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                            "<b>Contribuci√≥n Dim 4:</b> ", round(Contrib4, 2), "%<br>",
                            "Cos2 Dim 3:", round(Cos2_3, 3), "<br>",
                            "Cos2 Dim 4:", round(Cos2_4, 3)),
              type = "scatter",
              mode = "markers",
              marker = list(size = 12, opacity = 0.8, line = list(width = 2, color = "white")),
              hovertemplate = '%{text}<extra></extra>') %>%
  
  add_segments(x = 0, xend = ~Dim3, y = 0, yend = ~Dim4,
               line = list(color = "rgba(100, 100, 100, 0.3)", width = 1),
               showlegend = FALSE, hoverinfo = "skip") %>%
  
  layout(
    title = list(
      text = "Variables: Dimensi√≥n 3 vs Dimensi√≥n 4<br><sub>Coloreado por Contribuci√≥n Dim 3</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensi√≥n 3", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensi√≥n 4", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white"
  )

p2
```

A la dimensi√≥n 3 las variables que m√°s contribuyen son las importaciones negativamente (26.78%), las exportaciones negativamente (26.43%) y la inversi√≥n extranjera negativamente (13.2%).
En la dimensi√≥n 4 las variables que m√°s contribuyen son el area boscosa negativamente (29.47%), la tierra cultivable positivamente (26.32%)y la poblaci√≥n positivamente (19.51%).

### An√°lisis Integrado de Variables y Pa√≠ses

El an√°lisis combinado de las variables y los pa√≠ses en el espacio reducido de los componentes principales permite identificar patrones de asociaci√≥n estructural que trascienden el an√°lisis univariable. La metodolog√≠a del biplot permite vincular directamente las posiciones espaciales de los pa√≠ses con las magnitudes observadas en las variables originales, estableciendo relaciones interpretativas que evidencian c√≥mo las caracter√≠sticas multidimensionales de desarrollo se manifiestan diferencialmente en distintos grupos de pa√≠ses (Jolliffe, 2002; Hastie et al., 2009).

Para comprender la l√≥gica interpretativa del biplot, es fundamental reconocer que la posici√≥n de un pa√≠s en relaci√≥n a la direcci√≥n de una flecha de variable indica el valor relativo de ese pa√≠s en esa variable espec√≠fica. Pa√≠ses ubicados en la misma direcci√≥n que una flecha exhiben valores altos en esa variable; pa√≠ses ubicados en direcci√≥n opuesta exhiben valores bajos; pa√≠ses ubicados perpendicularmente (formando √°ngulos de \~$90¬∞$) exhiben valores cercanos a la media global. Esta propiedad geom√©trica del biplot permite realizar diagn√≥sticos cuantitativos directamente desde la visualizaci√≥n gr√°fica, sin necesidad de consultar la base de datos original, siempre que la calidad de representaci√≥n ($cos¬≤$) sea suficientemente alta (Jolliffe, 2002).

```{r Paises y variables DIM 1 Y DIM 2}
acp_prcomp <- prcomp(datos_analisis, center = TRUE, scale. = TRUE)
ind_data <- get_pca_ind(acp_prcomp)
var_data <- get_pca_var(acp_prcomp)


ind_df <- data.frame(
  Pais = rownames(ind_data$coord),
  Dim1 = ind_data$coord[, 1],
  Dim2 = ind_data$coord[, 2],
  Dim3 = ind_data$coord[, 3],
  Dim4 = ind_data$coord[, 4],
  Contrib1 = ind_data$contrib[, 1],
  Contrib2 = ind_data$contrib[, 2],
  Contrib3 = ind_data$contrib[, 3],
  Contrib4 = ind_data$contrib[, 4]
)

var_df <- data.frame(
  Variable = rownames(var_data$coord),
  Dim1 = var_data$coord[, 1] * 3,
  Dim2 = var_data$coord[, 2] * 3,
  Dim3 = var_data$coord[, 3] * 3,
  Dim4 = var_data$coord[, 4] * 3,
  Contrib1 = var_data$contrib[, 1],
  Contrib2 = var_data$contrib[, 2],
  Contrib3 = var_data$contrib[, 3],
  Contrib4 = var_data$contrib[, 4]
)

p1 <- plot_ly() %>%
  
  add_segments(
    data = var_df,
    x = 0, xend = ~Dim1, y = 0, yend = ~Dim2,
    line = list(color = "#2E9FDF", width = 2),
    showlegend = FALSE, hoverinfo = "skip"
  ) %>%
  
  add_trace(
    data = var_df,
    x = ~Dim1, y = ~Dim2,
    text = ~paste("<b>VARIABLE: ", Variable, "</b><br>",
                  "Dim 1:", round(Dim1/3, 3), "<br>",
                  "Dim 2:", round(Dim2/3, 3), "<br>",
                  "<b>Contribuci√≥n Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                  "<b>Contribuci√≥n Dim 2:</b> ", round(Contrib2, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 10, color = "#2E9FDF", opacity = 0.8, line = list(width = 2, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Variables"
  ) %>%
  
  add_trace(
    data = ind_df,
    x = ~Dim1, y = ~Dim2,
    text = ~paste("<b>PA√çS: ", Pais, "</b><br>",
                  "Dim 1:", round(Dim1, 3), "<br>",
                  "Dim 2:", round(Dim2, 3), "<br>",
                  "<b>Contribuci√≥n Dim 1:</b> ", round(Contrib1, 2), "%<br>",
                  "<b>Contribuci√≥n Dim 2:</b> ", round(Contrib2, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 8, color = "#696969", opacity = 0.6, line = list(width = 1, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Pa√≠ses"
  ) %>%
  
  layout(
    title = list(
      text = "Biplot: Dimensi√≥n 1 vs Dimensi√≥n 2<br><sub>Azul = Variables | Gris = Pa√≠ses</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensi√≥n 1", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensi√≥n 2", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    legend = list(x = 0.02, y = 0.98)
  )

p1

```

Senegal y Burkina Faso se alinean con la flecha de mortalidad infantil, confirmando valores altos en esa variable. Egipto se alinea con crecimiento poblacional, indicando tasa de crecimiento demogr√°fico elevada. Corea del Sur y Nueva Zelanda se alinean con exportaciones, indicando econom√≠as muy orientadas a comercio externo. Suiza se alinea con esperanza de vida, confirmando longevidad excepcional.

En direcci√≥n opuesta: pa√≠ses desarrollados europeos se oponen a flechas de mortalidad y rezago, reflejando valores bajos en estos indicadores negativos. Honduras y Rep√∫blica Kirguisa se alinean con remesas, indicando dependencia cr√≠tica de transferencias de migrantes.
```{r Paises y variables DIM 3 Y DIM 4}
p2 <- plot_ly() %>%
  
  add_segments(
    data = var_df,
    x = 0, xend = ~Dim3, y = 0, yend = ~Dim4,
    line = list(color = "#2E9FDF", width = 2),
    showlegend = FALSE, hoverinfo = "skip"
  ) %>%
  
  add_trace(
    data = var_df,
    x = ~Dim3, y = ~Dim4,
    text = ~paste("<b>VARIABLE: ", Variable, "</b><br>",
                  "Dim 3:", round(Dim3/3, 3), "<br>",
                  "Dim 4:", round(Dim4/3, 3), "<br>",
                  "<b>Contribuci√≥n Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                  "<b>Contribuci√≥n Dim 4:</b> ", round(Contrib4, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 10, color = "#2E9FDF", opacity = 0.8, line = list(width = 2, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Variables"
  ) %>%
  
  add_trace(
    data = ind_df,
    x = ~Dim3, y = ~Dim4,
    text = ~paste("<b>PA√çS: ", Pais, "</b><br>",
                  "Dim 3:", round(Dim3, 3), "<br>",
                  "Dim 4:", round(Dim4, 3), "<br>",
                  "<b>Contribuci√≥n Dim 3:</b> ", round(Contrib3, 2), "%<br>",
                  "<b>Contribuci√≥n Dim 4:</b> ", round(Contrib4, 2), "%"),
    type = "scatter",
    mode = "markers",
    marker = list(size = 8, color = "#696969", opacity = 0.6, line = list(width = 1, color = "white")),
    hovertemplate = '%{text}<extra></extra>',
    name = "Pa√≠ses"
  ) %>%
  
  layout(
    title = list(
      text = "Biplot: Dimensi√≥n 3 vs Dimensi√≥n 4<br><sub>Azul = Variables | Gris = Pa√≠ses</sub>",
      font = list(size = 16, color = "#2C5F8D")
    ),
    xaxis = list(title = "Dimensi√≥n 3", zeroline = TRUE, zerolinecolor = "gray"),
    yaxis = list(title = "Dimensi√≥n 4", zeroline = TRUE, zerolinecolor = "gray"),
    hovermode = "closest",
    plot_bgcolor = "white",
    paper_bgcolor = "white",
    legend = list(x = 0.02, y = 0.98)
  )

p2
```

Guinea se posiciona en la direcci√≥n de crecimiento poblacional, indicando valores altos en esta variable. Kuwait y Djibouti se alinean con importaciones, indicando ratios elevados. Senegal e Irlanda se alinean con exportaciones, indicando orientaci√≥n exportadora. Burkina Faso y Qatar se alinean con mortalidad infantil, indicando valores en esta variable. Macedonia del Norte se alinea con PIB per c√°pita, indicando ingreso por habitante en esa direcci√≥n.

### Caracterizacion de los componentes principales

```{r caracterizacion dimensiones}

dimensiones_tabla <- tribble(
  ~`Dimensi√≥n`, ~`Descripci√≥n`, ~`Variables`, ~`Ejemplo de Pa√≠ses`,
  "Dimensi√≥n 1", "Nivel de desarrollo humano y tecnol√≥gico ", 
  "Uso.internet, Esperanza.vida, Mortalidad.infantil", 
  "Burundi (Poca, Poca, Mucha); Australia (Mucha, Mucha, Poca); Cambodia (Media, Media, Media)",
  
  "Dimensi√≥n 2", "Industrializaci√≥n y crecimiento demogr√°fico", 
  "Industria, Crecimiento.poblacion, Remesas", 
  "China (Mucha, Media, Poca); Comoros (Poca, Poca, Mucha); Algeria (Mucha, Mucha, Poca)",
  
  "Dimensi√≥n 3", "Comercio internacional", 
  "Importaciones, Exportaciones, Inversi√≥n.Extranjera", 
  "Malta (Mucha, Mucha, Mucha); Djibouti (Mucha, Mucha, Media); San Marino (Mucha, Mucha, Media)",
  
  "Dimensi√≥n 4", "Uso del suelo y demograf√≠a ", 
  "√Årea.boscosa, Tierra.cultivable, Poblaci√≥n", 
  "India (Poca, Mucha, Mucha); Timor Leste (Media, Poca, -); China (Poca, Poca, Mucha)",
)
dimensiones_tabla %>%
  knitr::kable(
    caption = "Interpretaci√≥n de las Dimensiones obtenidas del An√°lisis de Componentes Principales (ACP)",
    col.names = c("Dimensi√≥n", "Descripci√≥n", "Variables Asociadas", "Ejemplo de Pa√≠ses"),
    align = c("c", "l", "l", "l"),
    format = "html",
    escape = FALSE
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = FALSE,
    position = "center",
    font_size = 13
  ) %>%
  row_spec(0, bold = TRUE, color = "white", background = "#2E86AB") %>%
  column_spec(1, bold = TRUE, width = "8em") %>%
  column_spec(2, width = "22em") %>%
  column_spec(3, width = "16em") %>%
  column_spec(4, width = "18em")


```

------------------------------------------------------------------------

# Clusterizaci√≥n

## Determinaci√≥n del N√∫mero √ìptimo de Clusters

```{r n-clusters}
# M√©todo del codo
```

## Aplicaci√≥n del M√©todo de Ward

```{r ward}
# Clustering Ward
```

## Visualizaci√≥n de Clusters

```{r viz-clusters}
# Visualizaci√≥n
```

------------------------------------------------------------------------

# Resultados e Interpretaci√≥n

## Hallazgos Principales

Los resultados revelan patrones importantes en el desarrollo de los pa√≠ses analizados.

## Patrones Observados

Se identifican tendencias claras seg√∫n las caracter√≠sticas de desarrollo econ√≥mico y social.

------------------------------------------------------------------------

# Conclusiones

## Conclusiones del Estudio

1.  **Reducci√≥n de Dimensionalidad:** El ACP logr√≥ simplificar efectivamente los datos
2.  **Segmentaci√≥n:** Los clusters identificados muestran agrupaciones coherentes
3.  **Implicaciones:** Los resultados tienen aplicaciones pr√°cticas para pol√≠ticas p√∫blicas

## Limitaciones y Trabajo Futuro

-   An√°lisis transversal limitado a un per√≠odo espec√≠fico
-   Recomendaci√≥n de an√°lisis longitudinal futuro
-   Incorporaci√≥n de variables adicionales

------------------------------------------------------------------------

# Bibliograf√≠a

1.  **World Bank.** (2024). *World Development Indicators*
2.  **Jolliffe, I. T., & Cadima, J.** (2016). Principal component analysis: A review
3.  **Hastie, T., et al.** (2009). *The Elements of Statistical Learning*
4.  **James, G., et al.** (2013). *An Introduction to Statistical Learning with R*
5.  **Ward, J. H.** (1963). Hierarchical grouping to optimize an objective function

------------------------------------------------------------------------

::: footer
<strong>Universidad del Valle</strong> \| <em>Facultad de Ingenier√≠a</em> \| Gesti√≥n de Datos<br> Profesor: Orlando Joaqui Barandica \| `r format(Sys.Date(), '%Y')`
:::
